var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(F){var A=0;return function(){return A<F.length?{done:!1,value:F[A++]}:{done:!0}}};$jscomp.arrayIterator=function(F){return{next:$jscomp.arrayIteratorImpl(F)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(F,A,E){if(F==Array.prototype||F==Object.prototype)return F;F[A]=E.value;return F};$jscomp.getGlobal=function(F){F=["object"==typeof globalThis&&globalThis,F,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var A=0;A<F.length;++A){var E=F[A];if(E&&E.Math==Math)return E}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(F,A){var E=$jscomp.propertyToPolyfillSymbol[A];if(null==E)return F[A];E=F[E];return void 0!==E?E:F[A]};
$jscomp.polyfill=function(F,A,E,r){A&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(F,A,E,r):$jscomp.polyfillUnisolated(F,A,E,r))};$jscomp.polyfillUnisolated=function(F,A,E,r){E=$jscomp.global;F=F.split(".");for(r=0;r<F.length-1;r++){var n=F[r];if(!(n in E))return;E=E[n]}F=F[F.length-1];r=E[F];A=A(r);A!=r&&null!=A&&$jscomp.defineProperty(E,F,{configurable:!0,writable:!0,value:A})};
$jscomp.polyfillIsolated=function(F,A,E,r){var n=F.split(".");F=1===n.length;r=n[0];r=!F&&r in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<n.length-1;h++){var y=n[h];if(!(y in r))return;r=r[y]}n=n[n.length-1];E=$jscomp.IS_SYMBOL_NATIVE&&"es6"===E?r[n]:null;A=A(E);null!=A&&(F?$jscomp.defineProperty($jscomp.polyfills,n,{configurable:!0,writable:!0,value:A}):A!==E&&(void 0===$jscomp.propertyToPolyfillSymbol[n]&&($jscomp.propertyToPolyfillSymbol[n]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(n):
$jscomp.POLYFILL_PREFIX+n),$jscomp.defineProperty(r,$jscomp.propertyToPolyfillSymbol[n],{configurable:!0,writable:!0,value:A})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(F){if(F)return F;var A=function(n,h){this.$jscomp$symbol$id_=n;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};A.prototype.toString=function(){return this.$jscomp$symbol$id_};var E=0,r=function(n){if(this instanceof r)throw new TypeError("Symbol is not a constructor");return new A("jscomp_symbol_"+(n||"")+"_"+E++,n)};return r},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var A="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),E=0;E<A.length;E++){var r=$jscomp.global[A[E]];"function"===typeof r&&"function"!=typeof r.prototype[F]&&$jscomp.defineProperty(r.prototype,F,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return F},"es6",
"es3");$jscomp.iteratorPrototype=function(F){F={next:F};F[Symbol.iterator]=function(){return this};return F};
(function(F,A){"object"===typeof exports&&"object"===typeof module?module.exports=A():"function"===typeof define&&define.amd?define("WaveSurfer",[],A):"object"===typeof exports?exports.WaveSurfer=A():F.WaveSurfer=A()})(window,function(){return function(F){function A(r){if(E[r])return E[r].exports;var n=E[r]={i:r,l:!1,exports:{}};F[r].call(n.exports,n,n.exports,A);n.l=!0;return n.exports}var E={};A.m=F;A.c=E;A.d=function(r,n,h){A.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:h})};A.r=function(r){"undefined"!==
typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});Object.defineProperty(r,"__esModule",{value:!0})};A.t=function(r,n){n&1&&(r=A(r));if(n&8||n&4&&"object"===typeof r&&r&&r.__esModule)return r;var h=Object.create(null);A.r(h);Object.defineProperty(h,"default",{enumerable:!0,value:r});if(n&2&&"string"!=typeof r)for(var y in r)A.d(h,y,function(t){return r[t]}.bind(null,y));return h};A.n=function(r){var n=r&&r.__esModule?function(){return r["default"]}:function(){return r};
A.d(n,"a",n);return n};A.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)};A.p="";return A(A.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(F,A){F.exports=function(E,r,n){function h(){var g=Date.now()-c;g<r&&0<=g?y=setTimeout(h,r-g):(y=null,n||(l=E.apply(v,t),v=t=null))}var y,t,v,c,l;null==r&&(r=100);var d=function(){v=this;t=arguments;c=Date.now();var g=n&&!y;y||(y=setTimeout(h,r));g&&(l=E.apply(v,t),v=t=null);return l};d.clear=function(){y&&(clearTimeout(y),
y=null)};d.flush=function(){y&&(l=E.apply(v,t),v=t=null,clearTimeout(y),y=null)};return d}},"./src/drawer.js":function(F,A,E){function r(y,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);y.prototype=Object.create(t&&t.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(y,t):y.__proto__=t)}Object.defineProperty(A,"__esModule",{value:!0});var n=function(){function y(t,
v){for(var c=0;c<v.length;c++){var l=v[c];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(t,l.key,l)}}return function(t,v,c){v&&y(t.prototype,v);c&&y(t,c);return t}}(),h=function(y){if(y&&y.__esModule)return y;var t={};if(null!=y)for(var v in y)Object.prototype.hasOwnProperty.call(y,v)&&(t[v]=y[v]);t["default"]=y;return t}(E("./src/util/index.js"));E=function(y){function t(v,c){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");
var l=(t.__proto__||Object.getPrototypeOf(t)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");l=!l||"object"!==typeof l&&"function"!==typeof l?this:l;l.container=v;l.params=c;l.width=0;l.height=c.height*l.params.pixelRatio;l.lastPos=0;l.wrapper=null;return l}r(t,y);n(t,[{key:"style",value:function(v,c){return h.style(v,c)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,
{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"});this.setupWrapperEvents()}},{key:"handleEvent",value:function(v,c){!c&&v.preventDefault();var l=v.targetTouches&&v.targetTouches[0]?v.targetTouches[0].clientX:v.clientX,d=this._bbox,g=this.width,p=this.getWidth();!this.params.fillParent&&
g<p?(l=(l=(l-d.left)*this.params.pixelRatio)||0,1<l&&(l=1)):l=(l-d.left)/this.width||0;return l}},{key:"setupWrapperEvents",value:function(){var v=this;this.wrapper.addEventListener("click",function(c){v.params.interact&&v.fireEvent("click",c,v.handleEvent(c))});this.wrapper.addEventListener("touchstart",function(c){v.params.interact&&v.fireEvent("touchstart",c)});this.wrapper.addEventListener("touchmove",function(c){v.params.interact&&v.fireEvent("touchmove",c)});this.wrapper.addEventListener("touchend",
function(c){v.params.interact&&v.fireEvent("touchend",c)});this.wrapper.addEventListener("scroll",function(c){return v.fireEvent("scroll",c)});this.wrapper.addEventListener("wheel",function(c){return v.fireEvent("wheel",c)})}},{key:"drawPeaks",value:function(v,c,l,d,g,p){var q=this;requestAnimationFrame(function(){q.shift=p;q.setWidth(c)||q.clearWave();q.drawWave(v,0,l,d,g)})}},{key:"drawSpectre",value:function(v,c,l,d,g,p,q){var e=this;e.setWidth(c)||e.clearWave();var a=[[0,0,0,1],[.011764705882352941,
0,0,1],[.023529411764705882,0,0,1],[.03529411764705882,0,0,1],[.047058823529411764,0,0,1],[.058823529411764705,0,0,1],[.07058823529411765,0,0,1],[.08235294117647059,0,0,1],[.09411764705882353,0,0,1],[.10588235294117647,0,0,1],[.11764705882352941,0,0,1],[.12941176470588237,0,0,1],[.1411764705882353,0,0,1],[.15294117647058825,0,0,1],[.16470588235294117,0,0,1],[.17647058823529413,0,0,1],[.18823529411764706,0,0,1],[.2,0,0,1],[.21176470588235294,0,0,1],[.2235294117647059,0,0,1],[.23529411764705882,0,0,
1],[.24705882352941178,0,0,1],[.25882352941176473,0,0,1],[.27058823529411763,0,0,1],[.2823529411764706,0,0,1],[.29411764705882354,0,0,1],[.3058823529411765,0,0,1],[.3176470588235294,0,0,1],[.32941176470588235,0,0,1],[.3411764705882353,0,0,1],[.35294117647058826,0,0,1],[.36470588235294116,0,0,1],[.3764705882352941,0,0,1],[.38823529411764707,0,0,1],[.4,0,0,1],[.4117647058823529,0,0,1],[.4235294117647059,0,0,1],[.43529411764705883,0,0,1],[.4470588235294118,0,0,1],[.4549019607843137,0,0,1],[.4666666666666667,
0,0,1],[.47843137254901963,0,0,1],[.49019607843137253,0,0,1],[.5019607843137255,0,0,1],[.5137254901960784,0,0,1],[.5254901960784314,0,0,1],[.5372549019607843,0,0,1],[.5490196078431373,0,0,1],[.5607843137254902,0,0,1],[.5725490196078431,0,0,1],[.5843137254901961,0,0,1],[.596078431372549,0,0,1],[.6078431372549019,0,0,1],[.6196078431372549,0,0,1],[.6313725490196078,0,0,1],[.6431372549019608,0,0,1],[.6549019607843137,0,0,1],[.6666666666666666,0,0,1],[.6784313725490196,0,0,1],[.6901960784313725,0,0,1],
[.7019607843137254,0,0,1],[.7137254901960784,0,0,1],[.7254901960784313,0,0,1],[.7372549019607844,0,0,1],[.7490196078431373,0,0,1],[.7607843137254902,0,0,1],[.7725490196078432,0,0,1],[.7843137254901961,0,0,1],[.796078431372549,0,0,1],[.807843137254902,0,0,1],[.8196078431372549,0,0,1],[.8313725490196079,0,0,1],[.8431372549019608,0,0,1],[.8549019607843137,0,0,1],[.8666666666666667,0,0,1],[.8784313725490196,0,0,1],[.8901960784313725,0,0,1],[.9019607843137255,0,0,1],[.9019607843137255,.011764705882352941,
0,1],[.9058823529411765,.023529411764705882,0,1],[.9058823529411765,.03137254901960784,0,1],[.9058823529411765,.043137254901960784,0,1],[.9098039215686274,.054901960784313725,0,1],[.9098039215686274,.06666666666666667,0,1],[.9098039215686274,.07450980392156863,0,1],[.9137254901960784,.08627450980392157,0,1],[.9137254901960784,.09803921568627451,0,1],[.9137254901960784,.10980392156862745,0,1],[.9176470588235294,.11764705882352941,0,1],[.9176470588235294,.12941176470588237,0,1],[.9176470588235294,.1411764705882353,
0,1],[.9215686274509803,.15294117647058825,0,1],[.9215686274509803,.1607843137254902,0,1],[.9215686274509803,.17254901960784313,0,1],[.9254901960784314,.1843137254901961,0,1],[.9254901960784314,.19607843137254902,0,1],[.9254901960784314,.20784313725490197,0,1],[.9294117647058824,.21568627450980393,0,1],[.9294117647058824,.22745098039215686,0,1],[.9294117647058824,.23921568627450981,0,1],[.9333333333333333,.25098039215686274,0,1],[.9333333333333333,.25882352941176473,0,1],[.9333333333333333,.27058823529411763,
0,1],[.9372549019607843,.2823529411764706,0,1],[.9372549019607843,.29411764705882354,0,1],[.9372549019607843,.30196078431372547,0,1],[.9411764705882353,.3137254901960784,0,1],[.9411764705882353,.3254901960784314,0,1],[.9411764705882353,.33725490196078434,0,1],[.9450980392156862,.34509803921568627,0,1],[.9450980392156862,.3568627450980392,0,1],[.9450980392156862,.3686274509803922,0,1],[.9490196078431372,.3803921568627451,0,1],[.9490196078431372,.38823529411764707,0,1],[.9490196078431372,.4,0,1],[.9529411764705882,
.4117647058823529,0,1],[.9529411764705882,.4235294117647059,0,1],[.9529411764705882,.43529411764705883,0,1],[.9529411764705882,.44313725490196076,0,1],[.9568627450980393,.4549019607843137,0,1],[.9568627450980393,.4666666666666667,0,1],[.9568627450980393,.47843137254901963,0,1],[.9607843137254902,.48627450980392156,0,1],[.9607843137254902,.4980392156862745,0,1],[.9607843137254902,.5098039215686274,0,1],[.9647058823529412,.5215686274509804,0,1],[.9647058823529412,.5294117647058824,0,1],[.9647058823529412,
.5411764705882353,0,1],[.9686274509803922,.5529411764705883,0,1],[.9686274509803922,.5647058823529412,0,1],[.9686274509803922,.5725490196078431,0,1],[.9725490196078431,.5843137254901961,0,1],[.9725490196078431,.596078431372549,0,1],[.9725490196078431,.6078431372549019,0,1],[.9764705882352941,.6196078431372549,0,1],[.9764705882352941,.6274509803921569,0,1],[.9764705882352941,.6392156862745098,0,1],[.9803921568627451,.6509803921568628,0,1],[.9803921568627451,.6627450980392157,0,1],[.9803921568627451,
.6705882352941176,0,1],[.984313725490196,.6823529411764706,0,1],[.984313725490196,.6941176470588235,0,1],[.984313725490196,.7058823529411765,0,1],[.9882352941176471,.7137254901960784,0,1],[.9882352941176471,.7254901960784313,0,1],[.9882352941176471,.7372549019607844,0,1],[.9921568627450981,.7490196078431373,0,1],[.9921568627450981,.7568627450980392,0,1],[.9921568627450981,.7686274509803922,0,1],[.996078431372549,.7803921568627451,0,1],[.996078431372549,.792156862745098,0,1],[.996078431372549,.8,0,
1],[1,.8117647058823529,0,1],[1,.8235294117647058,0,1],[1,.8235294117647058,.011764705882352941,1],[1,.8274509803921568,.0196078431372549,1],[1,.8274509803921568,.03137254901960784,1],[1,.8313725490196079,.0392156862745098,1],[1,.8313725490196079,.050980392156862744,1],[1,.8352941176470589,.058823529411764705,1],[1,.8352941176470589,.07058823529411765,1],[1,.8392156862745098,.0784313725490196,1],[1,.8392156862745098,.09019607843137255,1],[1,.8392156862745098,.09803921568627451,1],[1,.8431372549019608,
.10980392156862745,1],[1,.8431372549019608,.11764705882352941,1],[1,.8470588235294118,.12941176470588237,1],[1,.8470588235294118,.13725490196078433,1],[1,.8509803921568627,.14901960784313725,1],[1,.8509803921568627,.1568627450980392,1],[1,.8549019607843137,.16862745098039217,1],[1,.8549019607843137,.17647058823529413,1],[1,.8549019607843137,.18823529411764706,1],[1,.8588235294117647,.19607843137254902,1],[1,.8588235294117647,.20784313725490197,1],[1,.8627450980392157,.21568627450980393,1],[1,.8627450980392157,
.22745098039215686,1],[1,.8666666666666667,.23529411764705882,1],[1,.8666666666666667,.24705882352941178,1],[1,.8666666666666667,.2549019607843137,1],[1,.8705882352941177,.26666666666666666,1],[1,.8705882352941177,.27450980392156865,1],[1,.8745098039215686,.28627450980392155,1],[1,.8745098039215686,.29411764705882354,1],[1,.8784313725490196,.3058823529411765,1],[1,.8784313725490196,.3137254901960784,1],[1,.8823529411764706,.3254901960784314,1],[1,.8823529411764706,.3333333333333333,1],[1,.8823529411764706,
.34509803921568627,1],[1,.8862745098039215,.35294117647058826,1],[1,.8862745098039215,.36470588235294116,1],[1,.8901960784313725,.37254901960784315,1],[1,.8901960784313725,.3843137254901961,1],[1,.8941176470588236,.39215686274509803,1],[1,.8941176470588236,.403921568627451,1],[1,.8980392156862745,.4117647058823529,1],[1,.8980392156862745,.4235294117647059,1],[1,.8980392156862745,.43137254901960786,1],[1,.9019607843137255,.44313725490196076,1],[1,.9019607843137255,.45098039215686275,1],[1,.9058823529411765,
.4627450980392157,1],[1,.9058823529411765,.47058823529411764,1],[1,.9098039215686274,.4823529411764706,1],[1,.9098039215686274,.49019607843137253,1],[1,.9137254901960784,.5019607843137255,1],[1,.9137254901960784,.5098039215686274,1],[1,.9137254901960784,.5215686274509804,1],[1,.9176470588235294,.5294117647058824,1],[1,.9176470588235294,.5411764705882353,1],[1,.9215686274509803,.5490196078431373,1],[1,.9215686274509803,.5607843137254902,1],[1,.9254901960784314,.5686274509803921,1],[1,.9254901960784314,
.5803921568627451,1],[1,.9254901960784314,.5882352941176471,1],[1,.9294117647058824,.6,1],[1,.9294117647058824,.6078431372549019,1],[1,.9333333333333333,.6196078431372549,1],[1,.9333333333333333,.6274509803921569,1],[1,.9372549019607843,.6392156862745098,1],[1,.9372549019607843,.6470588235294118,1],[1,.9411764705882353,.6588235294117647,1],[1,.9411764705882353,.6666666666666666,1],[1,.9411764705882353,.6784313725490196,1],[1,.9450980392156862,.6862745098039216,1],[1,.9450980392156862,.6980392156862745,
1],[1,.9490196078431372,.7058823529411765,1],[1,.9490196078431372,.7176470588235294,1],[1,.9529411764705882,.7254901960784313,1],[1,.9529411764705882,.7372549019607844,1],[1,.9568627450980393,.7450980392156863,1],[1,.9568627450980393,.7568627450980392,1],[1,.9568627450980393,.7647058823529411,1],[1,.9607843137254902,.7764705882352941,1],[1,.9607843137254902,.7843137254901961,1],[1,.9647058823529412,.796078431372549,1],[1,.9647058823529412,.803921568627451,1],[1,.9686274509803922,.8156862745098039,
1],[1,.9686274509803922,.8235294117647058,1],[1,.9725490196078431,.8352941176470589,1],[1,.9725490196078431,.8431372549019608,1],[1,.9725490196078431,.8549019607843137,1],[1,.9764705882352941,.8627450980392157,1],[1,.9764705882352941,.8745098039215686,1],[1,.9803921568627451,.8823529411764706,1],[1,.9803921568627451,.8941176470588236,1],[1,.984313725490196,.9019607843137255,1],[1,.984313725490196,.9137254901960784,1],[1,.984313725490196,.9215686274509803,1],[1,.9882352941176471,.9333333333333333,
1],[1,.9882352941176471,.9411764705882353,1],[1,.9921568627450981,.9529411764705882,1],[1,.9921568627450981,.9607843137254902,1],[1,.996078431372549,.9725490196078431,1],[1,.996078431372549,.9803921568627451,1],[1,1,.9921568627450981,1],[1,1,1,1]],b=this.height,f=function(u){var w=e.width,x=u.length,z=x/w,C=[];p<l+g&&(g=p-l);var B=l/p,D=0;0!==B&&(D=x*B>>0);B=g/p;1!==B&&(z=(x-((1-B)*x>>0))/w);for(x=0;x<w;++x)C[x]=u[D+x*z>>0];return C}(v),m,k;this.canvases.forEach(function(u){var w=0;f[0]&&(w=f[0].length-
1);e.imagedata||(e.imagedata=u.waveCtx.createImageData(e.width,b));for(m=0;m<f.length;m++)for(k=0;k<f[m].length;k++){var x=a[f[m][k]],z=4*((w-k)*e.width+m);e.imagedata.data[z]=255*x[0];e.imagedata.data[z+1]=255*x[1];e.imagedata.data[z+2]=255*x[2];e.imagedata.data[z+3]=255*x[3]}u.waveCtx.putImageData(e.imagedata,0,0)})}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(v){this.recenterOnPosition(this.wrapper.scrollWidth*v,!0)}},{key:"recenterOnPosition",
value:function(v,c){var l=this.wrapper.scrollLeft,d=~~(this.wrapper.clientWidth/2),g=this.wrapper.scrollWidth-this.wrapper.clientWidth,p=v-d,q=p-l;0!=g&&(!c&&-d<=q&&q<d&&(q=Math.max(-5,Math.min(5,q)),p=l+q),p=Math.max(0,Math.min(g,p)),p!=l&&(this.wrapper.scrollLeft=p))}},{key:"getScrollX",value:function(){var v=this.params.pixelRatio,c=Math.round(this.wrapper.scrollLeft*v);this.params.scrollParent&&(v=~~(this.wrapper.scrollWidth*v-this.getWidth()),c=Math.min(v,Math.max(0,c)));return c}},{key:"getWidth",
value:function(){return this._width}},{key:"setWidth",value:function(v){if(this.width==v)return!1;this.width=v;this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"});this.updateSize();return!0}},{key:"setHeight",value:function(v){if(v==this.height)return!1;this.height=v;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize();return!0}},{key:"progress",value:function(v,
c,l){0==v?this.updateProgress(-1):this.updateProgress(1/this.params.pixelRatio*Math.round((v-c)*l*this.width))}},{key:"destroy",value:function(){this.unAll();this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(v,c,l,d){}},{key:"drawWave",value:function(v,c,l,d){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(v){}}]);
return t}(h.Observer);A["default"]=E;F.exports=A["default"]},"./src/drawer.multicanvas.js":function(F,A,E){function r(t,v){if("function"!==typeof v&&null!==v)throw new TypeError("Super expression must either be null or a function, not "+typeof v);t.prototype=Object.create(v&&v.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});v&&(Object.setPrototypeOf?Object.setPrototypeOf(t,v):t.__proto__=v)}Object.defineProperty(A,"__esModule",{value:!0});var n=function(){function t(v,
c){for(var l=0;l<c.length;l++){var d=c[l];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(v,d.key,d)}}return function(v,c,l){c&&t(v.prototype,c);l&&t(v,l);return v}}(),h=E("./src/drawer.js");h=h&&h.__esModule?h:{"default":h};var y=function(t){if(t&&t.__esModule)return t;var v={};if(null!=t)for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(v[c]=t[c]);v["default"]=t;return v}(E("./src/util/index.js"));E=function(t){function v(c,l){if(!(this instanceof
v))throw new TypeError("Cannot call a class as a function");var d=(v.__proto__||Object.getPrototypeOf(v)).call(this,c,l);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.maxCanvasWidth=l.maxCanvasWidth;d.maxCanvasElementWidth=Math.round(l.maxCanvasWidth/l.pixelRatio);d.hasProgressCanvas=!1;d.halfPixel=.5/l.pixelRatio;d.canvases=[];d.progressWave=null;d.CursorMarker=null;return d}r(v,t);n(v,[{key:"init",
value:function(){this.createWrapper();this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{}));this.progressWave.id="pk_prgwv";this.addCanvas();this.CursorMarker=document.createElement("div");this.CursorMarker.className="pk_wave_cursor";this.wrapper.appendChild(this.CursorMarker)}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},
{key:"updateSize",value:function(){for(var c=this;1>this.canvases.length;)this.addCanvas();for(;1<this.canvases.length;)this.removeCanvas();this.canvases.forEach(function(l,d){var g=c.maxCanvasWidth+2*Math.ceil(c.params.pixelRatio/2);d==c.canvases.length-1&&(g=c.width-c.maxCanvasWidth*(c.canvases.length-1));c.updateDimensions(l,g,c.height);c.clearWaveForEntry(l)})}},{key:"addCanvas",value:function(){var c={},l=this.maxCanvasElementWidth*this.canvases.length;c.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),
{position:"absolute",zIndex:2,left:l+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}));c.waveCtx=c.wave.getContext("2d",{alpha:!1,antialias:!1});c.waveCtx.font="12px Arial lighter";this.hasProgressCanvas&&(c.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:l+"px",top:0,bottom:0,height:"100%"})),c.progressCtx=c.progress.getContext("2d",{alpha:!1,antialias:!1}));this.canvases.push(c)}},{key:"removeCanvas",value:function(){var c=this.canvases.pop();
c.wave.parentElement.removeChild(c.wave);this.hasProgressCanvas&&c.progress.parentElement.removeChild(c.progress)}},{key:"updateDimensions",value:function(c,l,d){var g=Math.round(l/this.params.pixelRatio),p=Math.round(this.width/this.params.pixelRatio);c.start=c.waveCtx.canvas.offsetLeft/p||0;c.end=c.start+g/p;c.waveCtx.canvas.width=l;c.waveCtx.canvas.height=d;this.style(c.waveCtx.canvas,{width:g+"px"});this.style(this.progressWave,{display:"block"});this.hasProgressCanvas&&(c.progressCtx.canvas.width=
l,c.progressCtx.canvas.height=d,this.style(c.progressCtx.canvas,{width:g+"px"}))}},{key:"clearWave",value:function(){var c=this;this.canvases.forEach(function(l){return c.clearWaveForEntry(l)})}},{key:"clearWaveForEntry",value:function(c){this.shiftClear=!0;c.waveCtx.fillStyle="#000";c.waveCtx.fillRect(0,0,c.waveCtx.canvas.width,c.waveCtx.canvas.height);c.waveCtx.fillStyle="#99c2c6"}},{key:"drawBars",value:function(c,l,d,g){var p=this;return this.prepareDraw(c,l,d,g,function(q){var e=q.absmax,a=q.hasMinVals,
b=q.offsetY,f=q.halfH;q=q.peaks;p.params.timeline&&(b+=20,f-=10);if(void 0!==d){a=a?2:1;var m=p.params.barWidth*p.params.pixelRatio,k=m+(null===p.params.barGap?Math.max(p.params.pixelRatio,~~(m/2)):Math.max(p.params.pixelRatio,p.params.barGap*p.params.pixelRatio)),u=q.length/a/p.width,w;for(w=d;w<g;w+=k){var x=Math.round((q[Math.floor(w*u*a)]||0)/e*f);p.fillRect(w+p.halfPixel,f-x+b,m+p.halfPixel,2*x)}}})}},{key:"drawWave",value:function(c,l,d,g,p){var q=this;return this.prepareDraw(c,l,d,g,function(e){var a=
e.absmax,b=e.hasMinVals,f=e.offsetY,m=e.halfH;e=e.peaks;q.params.timeline&&(f+=20,m-=10);if(!b){b=[];var k=e.length,u;for(u=0;u<k;u++)b[2*u]=e[u],b[2*u+1]=-e[u];e=b}void 0!==d&&q.drawLine(q.params.limits,q.params.timeline,e,a,m,f,d,g);q.fillRect(0,m+f-q.halfPixel,q.width,q.halfPixel,q.params.timeline?10:0)},p)}},{key:"drawLine",value:function(c,l,d,g,p,q,e,a){var b=this;this.canvases.forEach(function(f){b.drawLineToContext(c,l,f,f.waveCtx,d,g,p,q,e,a)})}},{key:"drawLineToContext",value:function(c,
l,d,g,p,q,e,a,b,f){if(g){var m=p.length/2,k=this.params.fillParent&&this.width!=m?this.width/m:1,u=Math.round(m*d.start);d=Math.round(m*d.end)+1;if(!(u>f||d<b)){b=Math.min(u,b);f=Math.max(d,f);g.beginPath();g.moveTo((b-u)*k+this.halfPixel,e+a);d=0;30<a&&(d=1);g.fillStyle=this.params.ActiveChannels[d]?this.params.waveColor:this.params.waveDisabledColor;d=f;p.length<=2*d&&(d=p.length/2>>0);for(f=b;f<d;++f)m=Math.round(p[2*f]/q*e),m=Math.min(m,e),g.lineTo((f-u)*k+this.halfPixel,e-m+a);for(f=d-1;f>=b;--f)d=
Math.round(p[2*f+1]/q*e),d=Math.max(d,-e),g.lineTo((f-u)*k+this.halfPixel,e-d+a);g.closePath();g.fill();c&&(g.fillStyle="#fff",f=10*e/100>>0,p=1/q*e-e,q=f+a-p,q>a&&g.fillRect(0,q,this.width,.5),q=2*e-f+a+p,q<2*e+a&&g.fillRect(0,q,this.width,.5),g.fillStyle=this.params.waveColor);if(l&&(g.fillStyle="#fff",f=PKAudioEditor.engine.wavesurfer.LeftProgress,l=PKAudioEditor.engine.wavesurfer.getDuration(),a=PKAudioEditor.engine.wavesurfer.ZoomFactor,e=PKAudioEditor.engine.wavesurfer.drawer.width,1<=a)){e*=
a;a=f/l*e;q=0;c=e/l;g.textAlign="center";g.fillStyle="#111";g.fillRect(0,0,this.width,24);g.fillStyle="#aaa";g.strokeStyle="#aaa";60>c?c=60:160<c&&(c/=(c/160>>0)+1);for(f=p=0;f<10*l&&!(q-a>e-2);++f){if(-2<=q-a&&q-a<e-2){d=q/e*l;k=3;p=d-p;1>p?k=1:60>p&&(k=2);p=d;u=g;b=u.fillText;m=d>>0;var w=d-m;10>m?m="00:0"+m:60>m?m="00:"+m:(d=m/60>>0,m%=60,m=(10>d?"0":"")+d+":"+(10>m?"0"+m:m));k=1===k?m+":"+(w+"").substr(2,2):m;b.call(u,k,q-a,12)}q+=c}g.beginPath();for(f=q=0;f<10*l&&!(q-a>e-2);++f)-2<=q-a&&q-a<
e-2&&(g.moveTo(q-a,16),g.lineTo(q-a,24)),q+=c;q=c/2;for(f=0;f<10*l&&!(q-a>e-2);++f)-2<=q-a&&q-a<e-2&&(g.moveTo(q-a,19),g.lineTo(q-a,24)),q+=c;g.stroke()}this.RCB&&this.RCB();g.fillStyle=this.params.waveColor}}}},{key:"fillRect",value:function(c,l,d,g,p){var q=Math.min(Math.ceil((c+d)/this.maxCanvasWidth)+1,this.canvases.length),e,a=!1;for(e=Math.floor(c/this.maxCanvasWidth);e<q;e++){var b=this.canvases[e],f=e*this.maxCanvasWidth,m=Math.max(c,e*this.maxCanvasWidth),k=l,u=Math.min(c+d,e*this.maxCanvasWidth+
b.waveCtx.canvas.width),w=l+g;m<u&&(this.setFillStyles(b),a||(this.fillRectToContext(b.waveCtx,0,this.height/2+p,this.width,.25),a=!0),this.fillRectToContext(b.waveCtx,m-f,k,u-m,w-k))}}},{key:"prepareDraw",value:function(c,l,d,g,p,q){var e=this;return function(){if(c[0]instanceof Array){var a=c;if(e.params.splitChannels)return e.setHeight(e.params.height*e.params.pixelRatio),a.forEach(function(u,w){return e.prepareDraw(u,w,d,g,p,q)});c=a[0]}a=1/e.params.barHeight;a*=e.params.verticalZoom;if(e.params.normalize){a=
y.max(c);var b=y.min(c);a=-b>a?-b:a}b=[].some.call(c,function(u){return 0>u});var f=e.params.height/2*e.params.pixelRatio,m=f*l||0,k=f/2;1===q&&(k=f);return p({absmax:a,hasMinVals:b,height:f,offsetY:m,halfH:k,peaks:c})}()}},{key:"fillRectToContext",value:function(c,l,d,g,p){c&&c.fillRect(l,d,g,p)}},{key:"setFillStyles",value:function(c){c.waveCtx.fillStyle=this.params.waveColor;this.hasProgressCanvas&&(c.progressCtx.fillStyle=this.params.progressColor)}},{key:"getImage",value:function(c,l){var d=
this.canvases.map(function(g){return g.wave.toDataURL(c,l)});return 1<d.length?d:d[0]}},{key:"updateProgress",value:function(c){this.progressWave.style.transform="translate3d("+c+"px,0,0)"}}]);return v}(h["default"]);A["default"]=E;F.exports=A["default"]},"./src/mediaelement.js":function(F,A,E){function r(v,c){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?v:c}function n(v,c){if("function"!==typeof c&&
null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);v.prototype=Object.create(c&&c.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(v,c):v.__proto__=c)}Object.defineProperty(A,"__esModule",{value:!0});var h=function(){function v(c,l){for(var d=0;d<l.length;d++){var g=l[d];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(c,g.key,
g)}}return function(c,l,d){l&&v(c.prototype,l);d&&v(c,d);return c}}(),y=function g(c,l,d){null===c&&(c=Function.prototype);var p=Object.getOwnPropertyDescriptor(c,l);if(void 0===p){if(c=Object.getPrototypeOf(c),null!==c)return g(c,l,d)}else{if("value"in p)return p.value;l=p.get;return void 0===l?void 0:l.call(d)}},t=E("./src/webaudio.js");t=t&&t.__esModule?t:{"default":t};(function(c){if(c&&c.__esModule)return c;var l={};if(null!=c)for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(l[d]=c[d]);
l["default"]=c;return l})(E("./src/util/index.js"));E=function(c){function l(d){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");var g=r(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,d));g.params=d;g.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0};g.mediaType=d.mediaType.toLowerCase();g.elementPosition=d.elementPosition;g.peaks=null;g.playbackRate=1;g.volume=1;g.buffer=null;g.onPlayEnd=null;return g}n(l,
c);h(l,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate);this.createTimer()}},{key:"createTimer",value:function(){var d=this;this.on("play",function p(){d.isPaused()||(d.fireEvent("audioprocess",d.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(p))});this.on("pause",function(){d.fireEvent("audioprocess",d.getCurrentTime())})}},{key:"load",value:function(d,g,p,q){var e=document.createElement(this.mediaType);e.controls=this.params.mediaControls;
e.autoplay=this.params.autoplay||!1;e.preload=null==q?"auto":q;e.src=d;e.style.width="100%";(d=g.querySelector(this.mediaType))&&g.removeChild(d);g.appendChild(e);this._load(e,p)}},{key:"loadElt",value:function(d,g){d.controls=this.params.mediaControls;d.autoplay=this.params.autoplay||!1;this._load(d,g)}},{key:"_load",value:function(d,g){var p=this;"function"==typeof d.load&&d.load();d.addEventListener("error",function(){p.fireEvent("error","Error loading media element")});d.addEventListener("canplay",
function(){p.fireEvent("canplay")});d.addEventListener("ended",function(){p.fireEvent("finish")});d.addEventListener("play",function(){p.fireEvent("play")});d.addEventListener("pause",function(){p.fireEvent("pause")});this.media=d;this.peaks=g;this.buffer=this.onPlayEnd=null;this.setPlaybackRate(this.playbackRate);this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;
var d=(this.buffer||this.media).duration;Infinity<=d&&(d=this.media.seekable.end(0));return d}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(d){this.playbackRate=d||1;this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(d){null!=
d&&(this.media.currentTime=d);this.clearPlayEnd()}},{key:"play",value:function(d,g){this.seekTo(d);var p=this.media.play();g&&this.setPlayEnd(g);return p}},{key:"pause",value:function(){var d=void 0;this.media&&(d=this.media.pause());this.clearPlayEnd();return d}},{key:"setPlayEnd",value:function(d){var g=this;this._onPlayEnd=function(p){p>=d&&(g.pause(),g.seekTo(d))};this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),
this._onPlayEnd=null)}},{key:"getPeaks",value:function(d,g,p){return this.buffer?y(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"getPeaks",this).call(this,d,g,p):this.peaks||[]}},{key:"setSinkId",value:function(d){return d?this.media.setSinkId?this.media.setSinkId(d):Promise.reject(Error("setSinkId is not supported in your browser")):Promise.reject(Error("Invalid deviceId: "+d))}},{key:"getVolume",value:function(){return this.volume||this.media.volume}},{key:"setVolume",value:function(d){this.volume=
d;this.media.volume=this.volume}},{key:"destroy",value:function(){this.pause();this.unAll();this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media);this.media=null}}]);return l}(t["default"]);A["default"]=E;F.exports=A["default"]},"./src/peakcache.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});var r=function(){function n(h,y){for(var t=0;t<y.length;t++){var v=y[t];v.enumerable=v.enumerable||!1;v.configurable=!0;
"value"in v&&(v.writable=!0);Object.defineProperty(h,v.key,v)}}return function(h,y,t){y&&n(h.prototype,y);t&&n(h,t);return h}}();E=function(){function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.clearPeakCache()}r(n,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[];this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(h,y,t){h!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=h);h=[];for(var v=0;v<this.peakCacheRanges.length&&
this.peakCacheRanges[v]<y;)v++;for(0==v%2&&h.push(y);v<this.peakCacheRanges.length&&this.peakCacheRanges[v]<=t;)h.push(this.peakCacheRanges[v]),v++;0==v%2&&h.push(t);h=h.filter(function(c,l,d){return 0==l?c!=d[l+1]:l==d.length-1?c!=d[l-1]:c!=d[l-1]&&c!=d[l+1]});this.peakCacheRanges=this.peakCacheRanges.concat(h);this.peakCacheRanges=this.peakCacheRanges.sort(function(c,l){return c-l}).filter(function(c,l,d){return 0==l?c!=d[l+1]:l==d.length-1?c!=d[l-1]:c!=d[l-1]&&c!=d[l+1]});y=[];for(v=0;v<h.length;v+=
2)y.push([h[v],h[v+1]]);return y}},{key:"getCacheRanges",value:function(){var h=[],y;for(y=0;y<this.peakCacheRanges.length;y+=2)h.push([this.peakCacheRanges[y],this.peakCacheRanges[y+1]]);return h}}]);return n}();A["default"]=E;F.exports=A["default"]},"./src/util/ajax.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(n){var h=new r["default"],y=new XMLHttpRequest,t=!1;y.open(n.method||"GET",n.url,!0);y.responseType=n.responseType||"json";n.xhr&&(n.xhr.requestHeaders&&
n.xhr.requestHeaders.forEach(function(v){y.setRequestHeader(v.key,v.value)}),n.xhr.withCredentials&&(y.withCredentials=!0));y.addEventListener("progress",function(v){h.fireEvent("progress",v);v.lengthComputable&&v.loaded==v.total&&(t=!0)});y.addEventListener("load",function(v){t||h.fireEvent("progress",v);h.fireEvent("load",v);200==y.status||206==y.status?h.fireEvent("success",y.response,v):h.fireEvent("error",v)});y.addEventListener("error",function(v){return h.fireEvent("error",v)});y.send();h.xhr=
y;return h};var r=(E=E("./src/util/observer.js"))&&E.__esModule?E:{"default":E};F.exports=A["default"]},"./src/util/extend.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(r){for(var n=arguments.length,h=Array(1<n?n-1:0),y=1;y<n;y++)h[y-1]=arguments[y];h.forEach(function(t){Object.keys(t).forEach(function(v){r[v]=t[v]})});return r};F.exports=A["default"]},"./src/util/frame.js":function(F,A,E){},"./src/util/get-id.js":function(F,A,E){Object.defineProperty(A,
"__esModule",{value:!0});A["default"]=function(){return"wavesurfer_"+Math.random().toString(32).substring(2)};F.exports=A["default"]},"./src/util/index.js":function(F,A,E){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(A,"__esModule",{value:!0});var n=E("./src/util/ajax.js");Object.defineProperty(A,"ajax",{enumerable:!0,get:function(){return r(n)["default"]}});var h=E("./src/util/get-id.js");Object.defineProperty(A,"getId",{enumerable:!0,get:function(){return r(h)["default"]}});
var y=E("./src/util/max.js");Object.defineProperty(A,"max",{enumerable:!0,get:function(){return r(y)["default"]}});var t=E("./src/util/min.js");Object.defineProperty(A,"min",{enumerable:!0,get:function(){return r(t)["default"]}});var v=E("./src/util/observer.js");Object.defineProperty(A,"Observer",{enumerable:!0,get:function(){return r(v)["default"]}});var c=E("./src/util/extend.js");Object.defineProperty(A,"extend",{enumerable:!0,get:function(){return r(c)["default"]}});var l=E("./src/util/style.js");
Object.defineProperty(A,"style",{enumerable:!0,get:function(){return r(l)["default"]}});var d=E("./src/util/request-animation-frame.js");Object.defineProperty(A,"requestAnimationFrame",{enumerable:!0,get:function(){return r(d)["default"]}});var g=E("./src/util/frame.js");Object.defineProperty(A,"frame",{enumerable:!0,get:function(){return r(g)["default"]}});var p=E("./node_modules/debounce/index.js");Object.defineProperty(A,"debounce",{enumerable:!0,get:function(){return r(p)["default"]}});var q=
E("./src/util/prevent-click.js");Object.defineProperty(A,"preventClick",{enumerable:!0,get:function(){return r(q)["default"]}})},"./src/util/max.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(r){var n=-Infinity;Object.keys(r).forEach(function(h){r[h]>n&&(n=r[h])});return n};F.exports=A["default"]},"./src/util/min.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(r){var n=Number(Infinity);Object.keys(r).forEach(function(h){r[h]<
n&&(n=r[h])});return n};F.exports=A["default"]},"./src/util/observer.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});var r=function(){function n(h,y){for(var t=0;t<y.length;t++){var v=y[t];v.enumerable=v.enumerable||!1;v.configurable=!0;"value"in v&&(v.writable=!0);Object.defineProperty(h,v.key,v)}}return function(h,y,t){y&&n(h.prototype,y);t&&n(h,t);return h}}();E=function(){function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.handlers=
null}r(n,[{key:"on",value:function(h,y){var t=this;this.handlers||(this.handlers={});var v=this.handlers[h];v||(v=this.handlers[h]=[]);v.push(y);return{name:h,callback:y,un:function(c,l){return t.un(c,l)}}}},{key:"un",value:function(h,y){if(this.handlers){var t=this.handlers[h],v;if(t)if(y)for(v=t.length-1;0<=v;v--)t[v]==y&&t.splice(v,1);else t.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(h,y){var t=this;return this.on(h,function c(){for(var l=arguments.length,
d=Array(l),g=0;g<l;g++)d[g]=arguments[g];y.apply(t,d);setTimeout(function(){t.un(h,c)},0)})}},{key:"fireEvent",value:function(h,y,t){this.handlers&&(h=this.handlers[h])&&h.forEach(function(v){v(y,t)})}}]);return n}();A["default"]=E;F.exports=A["default"]},"./src/util/prevent-click.js":function(F,A,E){function r(n){n.stopPropagation();document.body.removeEventListener("click",r,!0)}Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(n){document.body.addEventListener("click",r,!0)};
F.exports=A["default"]},"./src/util/request-animation-frame.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(r,n){return setTimeout(r,1E3/60)}).bind(window);F.exports=A["default"]},"./src/util/style.js":function(F,A,E){Object.defineProperty(A,"__esModule",{value:!0});A["default"]=function(r,n){Object.keys(n).forEach(function(h){r.style[h]!==
n[h]&&(r.style[h]=n[h])});return r};F.exports=A["default"]},"./src/wavesurfer.js":function(F,A,E){function r(q){return q&&q.__esModule?q:{"default":q}}function n(q,e){if(!q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?q:e}function h(q,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);q.prototype=Object.create(e&&e.prototype,{constructor:{value:q,
enumerable:!1,writable:!0,configurable:!0}});e&&(Object.setPrototypeOf?Object.setPrototypeOf(q,e):q.__proto__=e)}function y(q,e){if(!(q instanceof e))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(A,"__esModule",{value:!0});var t=function(){function q(e,a){for(var b=0;b<a.length;b++){var f=a[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(e,f.key,f)}}return function(e,a,b){a&&q(e.prototype,a);b&&q(e,b);return e}}(),
v=function(q){if(q&&q.__esModule)return q;var e={};if(null!=q)for(var a in q)Object.prototype.hasOwnProperty.call(q,a)&&(e[a]=q[a]);e["default"]=q;return e}(E("./src/util/index.js")),c=E("./src/drawer.multicanvas.js"),l=r(c);c=E("./src/webaudio.js");var d=r(c);c=E("./src/mediaelement.js");var g=r(c);E=E("./src/peakcache.js");var p=r(E);(function(){function q(e,a){y(this,q)}t(q,[{key:"create",value:function(e){}}]);t(q,[{key:"init",value:function(){}},{key:"destroy",value:function(){}}]);return q})();
E=function(q){function e(a){y(this,e);var b=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));b.defaultParams={audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#ff8c35",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4E3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||
screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"rgba(201,199,229,0.24)",removeMediaElementOnDestroy:!0,renderer:l["default"],responsive:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#99c2c6",waveDisabledColor:"#505253",xhr:{},limits:1,timeline:1,verticalZoom:1};b.backends={MediaElement:g["default"],WebAudio:d["default"]};b.util=v;b.params=v.extend({},b.defaultParams,a);b.container="string"==typeof a.container?document.querySelector(b.params.container):b.params.container;
if(!b.container)throw Error("Container element not found");b.mediaContainer=null==b.params.mediaContainer?b.container:"string"==typeof b.params.mediaContainer?document.querySelector(b.params.mediaContainer):b.params.mediaContainer;if(!b.mediaContainer)throw Error("Media Container element not found");if(1>=b.params.maxCanvasWidth)throw Error("maxCanvasWidth must be greater than 1");if(1==b.params.maxCanvasWidth%2)throw Error("maxCanvasWidth must be an even number");b.savedVolume=0;b.isMuted=!1;b.tmpEvents=
[];b.currentAjax=null;b.bid={};b.arraybuffer=null;b.drawer=null;b.backend=null;b.peakCache=null;if("function"!==typeof b.params.renderer)throw Error("Renderer parameter is invalid");b.Drawer=b.params.renderer;b.Backend=b.backends[b.params.backend];b.initialisedPluginList={};b.isDestroyed=!1;b.isReady=!1;var f=0;b._onResize=v.debounce(function(){f==b.drawer.wrapper.clientWidth||b.params.scrollParent||(f=b.drawer.wrapper.clientWidth,b.drawer.fireEvent("redraw"))},"number"===typeof b.params.responsive?
b.params.responsive:100);b.ActiveMarker=0;b.FollowCursor=1;b.Interacting=0;b.ActiveChannels=[1,1];b.SelectedChannelsLen=2;b.LeftProgress=0;b.ZoomFactor=1;b.VisibleDuration=0;return n(b,b)}h(e,q);t(e,null,[{key:"create",value:function(a){return(new e(a)).init()}}]);t(e,[{key:"init",value:function(){this.registerPlugins(this.params.plugins);this.createDrawer();this.createBackend();this.createPeakCache();return this}},{key:"registerPlugins",value:function(a){var b=this;a.forEach(function(f){return b.addPlugin(f)});
a.forEach(function(f){f.deferInit||b.initPlugin(f.name)});this.fireEvent("plugins-registered",a);return this}},{key:"addPlugin",value:function(a){var b=this;if(!a.name)throw Error("Plugin does not have a name!");if(!a.instance)throw Error("Plugin "+a.name+" does not have an instance property!");a.staticProps&&Object.keys(a.staticProps).forEach(function(m){b[m]=a.staticProps[m]});var f=a.instance;Object.getOwnPropertyNames(v.Observer.prototype).forEach(function(m){f.prototype[m]=v.Observer.prototype[m]});
this[a.name]=new f(a.params||{},this);this.fireEvent("plugin-added",a.name);return this}},{key:"initPlugin",value:function(a){if(!this[a])throw Error("Plugin "+a+" has not been added yet!");this.initialisedPluginList[a]&&this.destroyPlugin(a);this[a].init();this.initialisedPluginList[a]=!0;this.fireEvent("plugin-initialised",a);return this}},{key:"destroyPlugin",value:function(a){if(!this[a])throw Error("Plugin "+a+" has not been added yet and cannot be destroyed!");if(!this.initialisedPluginList[a])throw Error("Plugin "+
a+" is not active and cannot be destroyed!");if("function"!==typeof this[a].destroy)throw Error("Plugin "+a+" does not have a destroy function!");this[a].destroy();delete this.initialisedPluginList[a];this.fireEvent("plugin-destroyed",a);return this}},{key:"destroyAllPlugins",value:function(){var a=this;Object.keys(this.initialisedPluginList).forEach(function(b){return a.destroyPlugin(b)})}},{key:"createDrawer",value:function(){var a=this;this.params.ActiveChannels=this.ActiveChannels;this.drawer=
new this.Drawer(this.container,this.params);this.drawer.init();this.fireEvent("drawer-created",this.drawer);this.drawer.on("resize",function(){a.drawer._width=Math.round(a.drawer.container.clientWidth*a.drawer.params.pixelRatio);a.drawer._bbox=a.drawer.wrapper.getBoundingClientRect()});this.on("resize",function(){a.drawer.fireEvent("resize")});!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0));this.drawer.on("redraw",
function(){a.drawBuffer();a.drawer.progress(a.backend.getPlayedPercents(),a.LeftProgress/a.getDuration(),a.ZoomFactor)});if("ontouchstart"in document.documentElement){var b=0,f=0,m=0,k=0;this.drawer.on("touchstart",function(w){w.touches&&1===w.touches.length&&(b=w.touches[0].pageX,f=w.touches[0].pageY)});this.drawer.on("touchmove",function(w){w.touches&&1===w.touches.length&&(m=w.touches[0].pageX,k=w.touches[0].pageY)});this.drawer.on("touchend",function(w){0!==b&&0!==f&&(0===m&&0===k||20>Math.abs(m-
b)&&20>Math.abs(k-f)?setTimeout(function(){var x=a.drawer._bbox,z=a.drawer.width,C=a.drawer.getWidth(),B=b-(window.pageXOffset||document.documentElement.scrollLeft);!a.drawer.params.fillParent&&z<C?(x=(x=(B-x.left)*a.drawer.params.pixelRatio)||0,1<x&&(x=1)):x=(B-x.left)/z||0;x=(x*a.VisibleDuration+a.LeftProgress)/a.getDuration();0<=x&&1>=x&&a.seekTo(x);k=m=f=b=0;a.regions&&a.regions.clear()},24):k=m=f=b=0)})}this.drawer.on("click",function(w,x){var z=w.timeStamp;setTimeout(function(){var C=(x*a.VisibleDuration+
a.LeftProgress)/a.getDuration();0<=C&&1>=C&&a.seekTo(C,z)},36)});this.ResetZoom=function(){a.ZoomFactor=1;a.LeftProgress=0;a.params.verticalZoom=1;a.ForceDraw();a.fireEvent("DidZoom")};this.SetZoomVertical=function(w,x){var z=a.params.verticalZoom;a.params.verticalZoom=.1>a.params.verticalZoom?a.params.verticalZoom+w/24:.3>a.params.verticalZoom?a.params.verticalZoom+w/20:.5>a.params.verticalZoom?a.params.verticalZoom+w/16:.8>a.params.verticalZoom?a.params.verticalZoom+w/12:1>a.params.verticalZoom?
a.params.verticalZoom+w/8:a.params.verticalZoom+w/4;.1>=a.params.verticalZoom&&(a.params.verticalZoom=.1);1>z&&1<a.params.verticalZoom?a.params.verticalZoom=1:1<z&&1>a.params.verticalZoom&&(a.params.verticalZoom=1);a.ForceDraw();a.fireEvent("DidZoom",x)};this.SetZoom=function(w,x,z,C){var B=!1,D=a.VisibleDuration;1>a.backend.buffer.length/(a.drawer.width*(a.ZoomFactor-x/Math.abs(x))>>0)||(w||(w=.5),0>x?(a.ZoomFactor=a.ZoomFactor!=a.ZoomFactor>>0?(a.ZoomFactor>>0)+1:a.ZoomFactor+1,a.LeftProgress+=
D/a.ZoomFactor*w):1<a.ZoomFactor&&(a.ZoomFactor!=a.ZoomFactor>>0?a.ZoomFactor>>=0:(6<a.ZoomFactor&&(C||(B=!0)),--a.ZoomFactor),a.LeftProgress=1===a.ZoomFactor?0:a.LeftProgress-D/a.ZoomFactor*w),a.ForceDraw(),a.fireEvent("DidZoom",z),B&&this.SetZoom(w,x,z,!0))};var u=0;this.drawer.on("wheel",function(w){w.preventDefault();w.stopPropagation();if(a.isReady&&0!=w.deltaY){var x=w.timeStamp;46>x-u||(u=x,a.SetZoom((w.clientX-a.drawer._bbox.left)/a.drawer.width,w.deltaY,w))}});this.drawer.on("scroll",function(w){a.params.partialRender&&
a.drawBuffer();a.fireEvent("scroll",w)})}},{key:"ZoomifyValue",value:function(a){return(a*this.VisibleDuration+this.LeftProgress)/this.getDuration()}},{key:"UnZoomifyValue",value:function(a){return(a-this.LeftProgress)*this.ZoomFactor}},{key:"UnzoomifyPixelValue",value:function(a){return(a-this.LeftProgress/this.getDuration()*this.drawer.width)*this.ZoomFactor}},{key:"DrawTemp",value:function(a,b){this.backend.extraPeaks=b;this.backend.extraOffset=a;this.drawBuffer(1);var f=this.backend.getPlayedPercents(),
m=this.getDuration();m=this.LeftProgress/m;this.drawer.CursorMarker.style.transform="translate("+1/this.drawer.params.pixelRatio*Math.round((this.ActiveMarker-m)*this.ZoomFactor*this.drawer.width)+"px,0)";this.drawer.progress(f,m,this.ZoomFactor)}},{key:"ForceDraw",value:function(){this.drawBuffer();var a=this.backend.getPlayedPercents(),b=this.getDuration();b=this.LeftProgress/b;this.drawer.CursorMarker.style.transform="translate("+1/this.drawer.params.pixelRatio*Math.round((this.ActiveMarker-b)*
this.ZoomFactor*this.drawer.width)+"px,0)";this.drawer.progress(a,b,this.ZoomFactor)}},{key:"getWaveEl",value:function(){return this.drawer.canvases[0].wave}},{key:"createBackend",value:function(){var a=this;this.backend&&this.backend.destroy();"AudioElement"==this.params.backend&&(this.params.backend="MediaElement");"WebAudio"!=this.params.backend||this.Backend.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement");this.backend=new this.Backend(this.params);this.backend.init();
this.fireEvent("backend-created",this.backend);this.backend.on("finish",function(){return a.fireEvent("finish")});this.backend.on("play",function(){return a.fireEvent("play")});this.backend.on("pause",function(m){"end"===m&&a.stop();return a.fireEvent("pause")});var b=this;this.CursorCenter=function(){var m=b.getDuration(),k=b.backend.getPlayedPercents(),u=b.drawer.width*b.ZoomFactor,w=~~(b.drawer.width/2),x=k*u,z=x-w,C=b.LeftProgress/m*u+w>>0;z=C+w>x&&C+w<u?50<(k-b.LeftProgress/m)*b.ZoomFactor*100>>
0?z-Math.max(0,z-C+w-4*b.ZoomFactor/2):Math.max(0,Math.min(u-2*w,z)):Math.max(0,Math.min(u-2*w,z));k=z/u;b.LeftProgress=k*m;b.fireEvent("cursorcenter",k);document.hidden||b.ForceDraw()};var f=0;b.backend.on("audioprocess",function(m,k){var u=b.backend.getPlayedPercents();if(1<b.ZoomFactor&&b.FollowCursor&&!b.Interacting){if(50<k-f){f=k;var w=b.getDuration(),x=b.drawer.width*b.ZoomFactor,z=~~(b.drawer.width/2),C=u*x,B=C-z,D=b.LeftProgress/w*x+z>>0;D<=C&&C<=D+z?(B=D+z>C&&D+z<x?99<(u-b.LeftProgress/
w)*b.ZoomFactor*100>>0?B-Math.max(0,B-D+z-4*b.ZoomFactor/2):Math.max(0,Math.min(x-2*z,B)):Math.max(0,Math.min(x-2*z,B)),u=B/x,b.LeftProgress=u*w,b.fireEvent("cursorcenter",u),document.hidden||b.ForceDraw()):b.drawer.progress(u,b.LeftProgress/b.getDuration(),b.ZoomFactor)}}else b.drawer.progress(u,b.LeftProgress/b.getDuration(),b.ZoomFactor);b.fireEvent("audioprocess",m,k)})}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new p["default"])}},{key:"getDuration",
value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(a){a>=this.getDuration()?this.seekTo(1):this.seekTo(a/this.getDuration())}},{key:"play",value:function(a,b){var f=this;this.fireEvent("interaction",function(){return f.play(a,b)});return this.backend.play(a,b)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?
this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(a){this.skip(-a||-this.params.skipLength)}},{key:"skipForward",value:function(a){this.skip(a||this.params.skipLength)}},{key:"skip",value:function(a){var b=this.getDuration()||1,f=this.getCurrentTime()||0;f=Math.max(0,Math.min(b,f+(a||0)));this.seekAndCenter(f/b)}},{key:"seekAndCenter",value:function(a){this.seekTo(a);this.drawer.recenter(a)}},{key:"seekTo",value:function(a,
b){var f=this;if("number"!==typeof a||!isFinite(a)||0>a||1<a)return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.ActiveMarker=a;this.fireEvent("interaction",function(){return f.seekTo(a)});var m=this.backend.isPaused();m||this.backend.pause();var k=this.getDuration();if(this.VisibleDuration/k+this.LeftProgress/k>a&&a>this.LeftProgress/k){var u=this.LeftProgress/k;k=(a-u)*this.ZoomFactor;var w=1/this.drawer.params.pixelRatio;k=Math.round(k*this.drawer.width)*
w;this.drawer.CursorMarker.style.transform="translate("+k+"px,0)";this.drawer.progress(a,u,this.ZoomFactor)}else u=this.LeftProgress/k,0==k/this.VisibleDuration*(a-u)?this.drawer.CursorMarker.style.transform="translate(1px,0)":(k=(a-u)*this.ZoomFactor,w=1/this.drawer.params.pixelRatio,k=Math.round(k*this.drawer.width)*w,this.drawer.CursorMarker.style.transform="translate("+k+"px,0)"),this.drawer.progress(0);this.backend.seekTo(a*this.getDuration());m||this.backend.play();this.fireEvent("seek",a,b)}},
{key:"stop",value:function(){this.pause();this.seekTo(this.ActiveMarker,window.performance.now()+100);this.drawer.progress(this.ActiveMarker,this.LeftProgress/this.getDuration(),this.ZoomFactor)}},{key:"setSinkId",value:function(a){return this.backend.setSinkId(a)}},{key:"setVolume",value:function(a){this.backend.setVolume(a);this.fireEvent("volume",a)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"getLoudness",value:function(){return this.backend.getLoudness()}},{key:"setPlaybackRate",
value:function(a){this.backend.setPlaybackRate(a)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(a){a!==this.isMuted&&(a?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)));this.fireEvent("mute",this.isMuted)}},
{key:"getMute",value:function(){return this.isMuted}},{key:"isReady",value:function(){return this.isReady}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(a){this.params.waveColor=a;
this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(a){this.params.progressColor=a;this.drawBuffer()}},{key:"setCursorColor",value:function(a){this.params.cursorColor=a}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(a){this.params.height=a;this.drawer.setHeight(a*this.params.pixelRatio);this.isReady&&this.drawBuffer()}},{key:"drawBuffer",value:function(a){this.VisibleDuration=
1===this.ZoomFactor?this.getDuration():this.getDuration()/this.ZoomFactor;var b=this.drawer.getWidth(),f=b*this.ZoomFactor>>0,m=void 0;m=this.backend.getPeaks(b,this.LeftProgress,f,a);this.drawer.drawPeaks(m,b,0,f,m.length,this.backend.shift);if(0<=this.backend.extraPeakStart){var k=this;requestAnimationFrame(function(){k.drawer.canvases[0].waveCtx.fillStyle="rgba(255,60,40,0.2)";k.drawer.canvases[0].waveCtx.fillRect(k.backend.extraPeakStart,0,k.backend.extraPeakEnd-k.backend.extraPeakStart,k.drawer.canvases[0].wave.height)})}this.fireEvent("redraw",
m,b)}},{key:"zoom",value:function(a){}},{key:"loadArrayBuffer",value:function(a){var b=this;this.decodeArrayBuffer(a,function(f){b.isDestroyed||b.loadDecodedBuffer(f)})}},{key:"loadDecodedBuffer",value:function(a){this.backend.splitPeaks=[];this.backend.mergedPeaks=[];this.createPeakCache();this.backend.load(a);this.drawBuffer(1);this.fireEvent("ready");this.isReady=!0}},{key:"loadBlob",value:function(a){var b=this,f=new FileReader;f.addEventListener("progress",function(m){return b.onProgress(m)});
f.addEventListener("load",function(m){return b.loadArrayBuffer(m.target.result)});f.addEventListener("error",function(){return b.fireEvent("error","Error reading file")});f.readAsArrayBuffer(a);this.empty()}},{key:"load",value:function(a,b,f,m){this.empty();if(f){var k={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(f),"Peaks are not provided":!b,"Backend is not of type MediaElement":"MediaElement"!==this.params.backend,"Url is not of type string":"string"!==
typeof a},u=Object.keys(k).filter(function(w){return k[w]});u.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+u.join("\n\t- ")),f=null)}switch(this.params.backend){case "WebAudio":return this.loadBuffer(a,b,m);case "MediaElement":return this.loadMediaElement(a,b,f,m)}}},{key:"loadBuffer",value:function(a,b,f){var m=this,k=function(u){u&&m.tmpEvents.push(m.once("ready",u));return m.getArrayBuffer(a,function(w){return m.loadArrayBuffer(w)})};if(b)this.backend.setPeaks(b,
f),this.drawBuffer(1),this.tmpEvents.push(this.once("interaction",k));else return k()}},{key:"loadMediaElement",value:function(a,b,f,m){var k=this,u=a;"string"===typeof a?this.backend.load(u,this.mediaContainer,b,f):(this.backend.loadElt(a,b),u=a.src);this.tmpEvents.push(this.backend.once("canplay",function(){k.drawBuffer(1);k.fireEvent("ready");k.isReady=!0}),this.backend.once("error",function(w){return k.fireEvent("error",w)}));b&&this.backend.setPeaks(b,m);b&&!this.params.forceDecode||!this.backend.supportsWebAudio()||
this.getArrayBuffer(u,function(w){k.decodeArrayBuffer(w,function(x){k.backend.buffer=x;k.backend.setPeaks(null);k.drawBuffer(1);k.fireEvent("waveform-ready")})})}},{key:"decodeArrayBuffer",value:function(a,b){var f=this,m="q"+(999999*Math.random()>>0);this.bid[m]=1;this.bid.curr=m;var k=this.getDuration();this.backend.decodeArrayBuffer(a,function(u){if(!f.isDestroyed&&f.bid[m]){var w=!1;f.backend.buffer&&f.backend._add&&(w=!0);b(u);f.arraybuffer=a;w&&setTimeout(function(){f.regions.add({start:k,end:f.getDuration()-
.01,id:"t"})},48)}},function(){return f.fireEvent("error","Error decoding audiobuffer. Did you make sure to supply a valid audio file? ")})}},{key:"getArrayBuffer",value:function(a,b){var f=this,m=v.ajax({url:a,responseType:"arraybuffer",xhr:this.params.xhr});this.currentAjax=m;this.tmpEvents.push(m.on("progress",function(k){f.onProgress(k)}),m.on("success",function(k,u){b(k);f.currentAjax=null}),m.on("error",function(k){f.fireEvent("error","Could not load remote URL. Make sure the url exists, is a valid audio file,<br />  or that is supports Cross Origin requests (Access-Control-Allow-Origin header) <br />"+
k.target.statusText);f.currentAjax=null;PKAudioEditor.fireEvent("RequestResize")}));return m}},{key:"onProgress",value:function(a){this.fireEvent("loading",Math.round(100*(a.lengthComputable?a.loaded/a.total:a.loaded/(a.loaded+1E6))),a.target)}},{key:"exportPCM",value:function(a,b,f,m){b=b||1E4;f=f||!1;a=this.backend.getPeaks(a||1024,m||0);a=[].map.call(a,function(k){return Math.round(k*b)/b});a=JSON.stringify(a);f||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(a));return a}},
{key:"exportImage",value:function(a,b){a||(a="image/png");b||(b=1);return this.drawer.getImage(a,b)}},{key:"cancelBufferLoad",value:function(){return this.bid&&this.bid.curr?(this.bid[this.bid.curr]=null,!0):!1}},{key:"cancelAjax",value:function(){return this.currentAjax?(this.currentAjax.xhr.abort(),this.currentAjax=null,!0):!1}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(a){return a.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource());
this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0,2)}},{key:"destroy",value:function(){this.destroyAllPlugins();this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0));this.backend.destroy();this.drawer.destroy();this.isDestroyed=!0;
this.arraybuffer=null}}]);return e}(v.Observer);E.util=v;A["default"]=E;Array.prototype.copyWithin||(Array.prototype.copyWithin=function(q,e,a){if(null==this)throw new TypeError("this is null or not defined");var b=Object(this),f=b.length>>>0;q>>=0;q=0>q?Math.max(f+q,0):Math.min(q,f);e>>=0;e=0>e?Math.max(f+e,0):Math.min(e,f);a=void 0===a?f:a>>0;f=Math.min((0>a?Math.max(f+a,0):Math.min(a,f))-e,f-q);a=1;e<q&&q<e+f&&(a=-1,e+=f-1,q+=f-1);for(;0<f;)e in b?b[q]=b[e]:delete b[q],e+=a,q+=a,f--;return b});
F.exports=A["default"]},"./src/webaudio.js":function(F,A,E){function r(v,c,l){c in v?Object.defineProperty(v,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):v[c]=l;return v}function n(v,c){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?v:c}function h(v,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);v.prototype=Object.create(c&&
c.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(v,c):v.__proto__=c)}Object.defineProperty(A,"__esModule",{value:!0});var y=function(){function v(c,l){for(var d=0;d<l.length;d++){var g=l[d];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(c,g.key,g)}}return function(c,l,d){l&&v(c.prototype,l);d&&v(c,d);return c}}();E=function(v){if(v&&v.__esModule)return v;var c={};if(null!=
v)for(var l in v)Object.prototype.hasOwnProperty.call(v,l)&&(c[l]=v[l]);c["default"]=v;return c}(E("./src/util/index.js"));var t=-1<navigator.userAgent.toLowerCase().indexOf("safari/");E=function(v){function c(l){var d,g;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var p=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));p.audioContext=null;p.offlineAudioContext=null;p.stateBehaviors=(d={},r(d,"playing",{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var q=
this.getDuration();return this.getCurrentTime()/q||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),r(d,"paused",{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var q=this.getDuration();return this.getCurrentTime()/q||0},getCurrentTime:function(){return this.startPosition}}),r(d,"finished",{init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),
d);p.params=l;p.ac=l.audioContext||p.getAudioContext();p.lastPlay=p.ac.currentTime;p.startPosition=0;p.scheduledPause=null;p.states=(g={},r(g,"playing",Object.create(p.stateBehaviors.playing)),r(g,"paused",Object.create(p.stateBehaviors.paused)),r(g,"finished",Object.create(p.stateBehaviors.finished)),g);p.analyser=null;p.buffer=null;p.filters=[];p.gainNode1=null;p.gainNode2=null;p.splitterNode=null;p.mergedPeaks=null;p.offlineAc=null;p.peaks=null;p.playbackRate=1;p.analyser=null;p.scriptNode=null;
p.source=null;p.splitPeaks=[];p.state=null;p.explicitDuration=null;p.FreqArr=new Uint8Array(512);return p}h(c,v);y(c,[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new (window.AudioContext||window.webkitAudioContext));return window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(l){window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=
new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,l));return window.WaveSurferOfflineAudioContext}}]);y(c,[{key:"init",value:function(){this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState("paused");this.setPlaybackRate(this.params.audioRate);this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(l){l&&l.disconnect()}),this.filters=null,this.analyser.connect(this.mergerNode))}},{key:"setState",
value:function(l){this.state!==this.states[l]&&(this.state=this.states[l],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var l=arguments.length,d=Array(l),g=0;g<l;g++)d[g]=arguments[g];this.setFilters(d)}},{key:"setFilters",value:function(l){this.disconnectFilters();l&&l.length&&(this.filters=l,this.analyser.disconnect(),l.reduce(function(d,g){d.connect(g);return g},this.analyser).connect(this.gainNode1))}},{key:"createScriptNode",value:function(){this.scriptNode=this.ac.createScriptProcessor?
this.ac.createScriptProcessor(c.scriptBufferSize):this.ac.createJavaScriptNode(c.scriptBufferSize);this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var l=this;this.scriptNode.onaudioprocess=function(d){if(l.states.playing){for(var g=l.getCurrentTime(),p=l.buffer,q=g*p.sampleRate>>0,e=[0,0],a,b=0;b<p.numberOfChannels;++b){a=0;for(var f=p.getChannelData(b),m=0;512>m;m+=4){var k=Math.abs(f[q+m]);k>a&&(a=k)}e[b]=20*Math.log10(a)+.001}l.peak_frequency=e;l.logFrequencies&&
l.analyser.getByteFrequencyData(l.FreqArr);g>=l.getDuration()?(l.setState("finished"),l.states.playing=null,l.fireEvent("pause","end")):g>=l.scheduledPause?l.pause():l.state===l.states.playing&&l.fireEvent("audioprocess",g,d.timeStamp);l.peak_frequency=null}}}},{key:"removeOnAudioProcess",value:function(){t||(this.scriptNode.onaudioprocess=null)}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser();this.analyser.fftSize=1024;this.analyser.connect(this.splitterNode)}},
{key:"SetNumberOfChannels",value:function(l){this.splitterNode.disconnect(0);this.splitterNode.disconnect(1);1===l?(this.splitterNode.connect(this.gainNode1,0),this.splitterNode.connect(this.gainNode2,0)):2===l&&(this.splitterNode.connect(this.gainNode1,1),this.splitterNode.connect(this.gainNode2,0))}},{key:"createVolumeNode",value:function(){this.splitterNode=this.ac.createChannelSplitter(2);this.mergerNode=this.ac.createChannelMerger(2);this.ac.createGain?(this.gainNode1=this.ac.createGain(),this.gainNode2=
this.ac.createGain()):(this.gainNode1=this.ac.createGainNode(),this.gainNode2=this.ac.createGainNode());this.splitterNode.connect(this.gainNode1,1);this.splitterNode.connect(this.gainNode2,0);this.gainNode1.connect(this.mergerNode,0,1);this.gainNode2.connect(this.mergerNode,0,0);this.mergerNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(l){if(l){var d=new window.Audio;if(!d.setSinkId)return Promise.reject(Error("setSinkId is not supported in your browser"));d.autoplay=!0;var g=
this.ac.createMediaStreamDestination();this.gainNode1.disconnect();this.gainNode1.connect(g);this.gainNode2.disconnect();this.gainNode2.connect(g);this.mergerNode.disconnect();this.mergerNode.connect(g);this.splitterNode.disconnect();this.splitterNode.connect(g);d.src=URL.createObjectURL(g.stream);return d.setSinkId(l)}return Promise.reject(Error("Invalid deviceId: "+l))}},{key:"setVolume",value:function(l){this.gainNode1.gain.setValueAtTime(l,this.ac.currentTime);this.gainNode2.gain.setValueAtTime(l,
this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode1.gain.value}},{key:"getLoudness",value:function(){return this.peak_frequency}},{key:"decodeArrayBuffer",value:function(l,d,g){PKAudioEditor.engine.ID3(l);this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(44100));(l=this.offlineAc.decodeAudioData(l,function(p){return d(p)},g))&&l["catch"](function(p){console.log("couldn't load audio")})}},{key:"setPeaks",value:function(l,d){this.explicitDuration=d;this.peaks=l}},
{key:"setLength",value:function(l){if(!this.mergedPeaks||2*l!=this.mergedPeaks.length){this.splitPeaks=[];this.mergedPeaks=[];var d=this.buffer?this.buffer.numberOfChannels:1,g;for(g=0;g<d;g++)this.splitPeaks[g]=[],this.splitPeaks[g][2*(l-1)]=0,this.splitPeaks[g][2*(l-1)+1]=0;this.mergedPeaks[2*(l-1)]=0;this.mergedPeaks[2*(l-1)+1]=0}}},{key:"getSpectre",value:function(l,d,g,p,q){}},{key:"getPeaks",value:function(l,d,g,p){d*=this.buffer.sampleRate;g=g||l-1;this.setLength(l);this.buffer.length||(this.buffer=
this.createBuffer(1,4096,this.sampleRate).buffer);var q=this.buffer.length/g,e=~~(q/10)||1;32<e?e=32:6>e&&(e=6);var a=this.buffer.numberOfChannels,b=0;this.shift=0;if(this.splitPeaks&&!p&&g==this.peaksEnd){var f=(this.peaksStart-d)/q;if(0===f)return this.shift=999999999,this.splitPeaks;f=Math.round(f);d=this.peaksStart-f*q;this.shift=f*=2;for(p=0;p<a;++p){var m=this.splitPeaks[p];if(0>f)m.copyWithin(0,-f),b=l+f;else if(0<f)m.copyWithin(f,0,m.length-f),l=f/2>>0;else return this.splitPeaks}}for(p=0;p<
a;++p){m=this.splitPeaks[p];var k=this.buffer.getChannelData(p);for(f=b;f<=l;++f){for(var u=d+f*q>>0,w=u+q>>0,x=0,z=0;u<w;u+=e){var C=k[u];C>z?z=C:C<x&&(x=C)}m[2*f]=z;m[2*f+1]=x}}this.extraPeakEnd=this.extraPeakStart=-1;if(this.extraPeaks&&(l=this.extraOffset/q>>0,d<=this.extraOffset&&g>l)){l=(this.extraOffset-d)/q>>0;b=this.extraPeaks.length;k=this.extraPeaks[0].length;var B=l+k*b/q>>0;this.extraPeakStart=l;this.extraPeakEnd=B;for(p=0;p<a;++p){m=this.splitPeaks[p];var D=0;for(f=l;f<=B;++f){u=D*q>>
0;w=u+q>>0;z=x=0;for(++D;u<w;u+=e){C=u/k;if(C>=b)break;C=this.extraPeaks[C>>0][u%k];C>z&&(z=C);C<x&&(x=C)}m[2*f]=z;m[2*f+1]=x}}}this.peaksStart=d;this.peaksEnd=g;return this.splitPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause();this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode1.disconnect();
this.gainNode2.disconnect();this.mergerNode.disconnect();this.splitterNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();this.params.closeAudioContext&&("function"===typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}},{key:"load",value:function(l){if(this.buffer&&this._add){var d=this.buffer,g=this.buffer.duration,p=this.ac.createBuffer(this.buffer.numberOfChannels,
this.buffer.length+l.length,this.buffer.sampleRate);g=g/1*d.sampleRate>>0;for(var q=0;q<d.numberOfChannels;++q){var e=d.getChannelData(q),a=p.getChannelData(q);var b=1===l.numberOfChannels?l.getChannelData(0):l.getChannelData(q);0<g&&a.set(e.slice(0,g));a.set(b,g);g<d.length+l.length&&a.set(e.slice(g),g+b.length)}this.lastPlay=this.ac.currentTime;this.buffer=p}else this.lastPlay=this.ac.currentTime,this.buffer=l;this.peaks=null;this.createSource();this.source.start(0,0,0);this.source.stop(0);this.createSource()}},
{key:"createSource",value:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime);this.source.buffer=this.buffer;this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states.playing}},{key:"getDuration",value:function(){return this.buffer?this.buffer.duration:
this.explicitDuration?this.explicitDuration:0}},{key:"seekTo",value:function(l,d){if(this.buffer)return this.scheduledPause=null,null==l&&(l=this.getCurrentTime(),l>=this.getDuration()&&(l=0)),null==d&&(d=this.getDuration()),this.startPosition=l,this.lastPlay=this.ac.currentTime,this.state===this.states.finished&&this.setState("paused"),{start:l,end:d}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(l,d){if(this.buffer){this.createSource();
var g=this.seekTo(l,d);l=g.start;this.scheduledPause=d=g.end;this.source.start(0,l,d-l);"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume();this.states.playing||r(this.states,"playing",Object.create(this.stateBehaviors.playing));this.setState("playing");this.fireEvent("play")}}},{key:"pause",value:function(){this.state!==this.states.paused&&(this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState("paused"),this.fireEvent("pause"))}},
{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(l){l=l||1;this.isPaused()?this.playbackRate=l:(this.pause(),this.playbackRate=l,this.play())}}]);return c}(E.Observer);E.scriptBufferSize=256;A["default"]=E;F.exports=A["default"]}})});
(function(F,A){"object"===typeof exports&&"object"===typeof module?module.exports=A():"function"===typeof define&&define.amd?define("regions",[],A):"object"===typeof exports?exports.regions=A():(F.WaveSurfer=F.WaveSurfer||{},F.WaveSurfer.regions=A())})(window,function(){return function(F){function A(r){if(E[r])return E[r].exports;var n=E[r]={i:r,l:!1,exports:{}};F[r].call(n.exports,n,n.exports,A);n.l=!0;return n.exports}var E={};A.m=F;A.c=E;A.d=function(r,n,h){A.o(r,n)||Object.defineProperty(r,n,
{enumerable:!0,get:h})};A.r=function(r){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});Object.defineProperty(r,"__esModule",{value:!0})};A.t=function(r,n){n&1&&(r=A(r));if(n&8||n&4&&"object"===typeof r&&r&&r.__esModule)return r;var h=Object.create(null);A.r(h);Object.defineProperty(h,"default",{enumerable:!0,value:r});if(n&2&&"string"!=typeof r)for(var y in r)A.d(h,y,function(t){return r[t]}.bind(null,y));return h};A.n=function(r){var n=
r&&r.__esModule?function(){return r["default"]}:function(){return r};A.d(n,"a",n);return n};A.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)};A.p="localhost:8080/dist/plugin/";return A(A.s="./src/plugin/regions.js")}({"./src/plugin/regions.js":function(F,A,E){function r(y,t){if(!(y instanceof t))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(A,"__esModule",{value:!0});var n=function(){function y(t,v){for(var c=0;c<v.length;c++){var l=v[c];l.enumerable=
l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(t,l.key,l)}}return function(t,v,c){v&&y(t.prototype,v);c&&y(t,c);return t}}(),h=function(){function y(t,v){var c=this;r(this,y);this.wavesurfer=v;this.wrapper=v.drawer.wrapper;this.util=v.util;this.style=this.util.style;this.id=null==t.id?v.util.getId():t.id;this.start=Number(t.start)||0;this.end=null==t.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(t.end);this.resize=void 0===t.resize?
!0:!!t.resize;this.drag=void 0===t.drag?!0:!!t.drag;this.loop=!!t.loop;this.color=t.color||"rgba(30, 30, 162, 0.51)";this.data=t.data||{};this.attributes=t.attributes||{};this.direction=t.direction||2;this.maxLength=t.maxLength;this.minLength=t.minLength;this._onRedraw=function(){return c.updateRender()};this.scroll=!1!==t.scroll&&v.params.scrollParent;this.scrollSpeed=t.scrollSpeed||1;this.scrollThreshold=t.scrollThreshold||28;this.bindInOut();this.render();this.wavesurfer.on("zoom",this._onRedraw);
this.wavesurfer.on("redraw",this._onRedraw);this.wavesurfer.fireEvent("region-created",this)}n(y,[{key:"update",value:function(t){null!=t.start&&(this.start=Number(t.start));null!=t.end&&(this.end=Number(t.end));null!=t.loop&&(this.loop=!!t.loop);null!=t.color&&(this.color=t.color);null!=t.data&&(this.data=t.data);null!=t.resize&&(this.resize=!!t.resize);null!=t.drag&&(this.drag=!!t.drag);null!=t.maxLength&&(this.maxLength=Number(t.maxLength));null!=t.minLength&&(this.minLength=Number(t.minLength));
null!=t.attributes&&(this.attributes=t.attributes);this.updateRender();this.fireEvent("update");this.wavesurfer.fireEvent("region-updated",this)}},{key:"remove",value:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this._onRedraw),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-removed",this))}},{key:"play",value:function(){this.wavesurfer.play(this.start,this.end);this.fireEvent("play");
this.wavesurfer.fireEvent("region-play",this)}},{key:"playLoop",value:function(){var t=this;this.play();this.once("out",function(){return t.playLoop()})}},{key:"render",value:function(){var t=document.createElement("region");t.className="wavesurfer-region";t.title=this.formatTime(this.start,this.end);t.setAttribute("data-id",this.id);for(var v in this.attributes)t.setAttribute("data-region-"+v,this.attributes[v]);this.style(t,{position:"absolute",zIndex:2,height:"100%",top:"0px"});if(this.resize){v=
t.appendChild(document.createElement("handle"));var c=t.appendChild(document.createElement("handle"));v.className="wavesurfer-handle wavesurfer-handle-start";c.className="wavesurfer-handle wavesurfer-handle-end";var l={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(v,l);this.style(c,l);this.style(c,{left:"100%"})}this.element=this.wrapper.appendChild(t);this.updateRender();this.bindEvents(t)}},{key:"formatTime",value:function(t,v){return(t==
v?[t]:[t,v]).map(function(c){return[Math.floor(c%3600/60),("00"+Math.floor(c%60)).slice(-2)].join(":")}).join("-")}},{key:"getWidth",value:function(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio}},{key:"updateRender",value:function(){var t=this.wavesurfer.getDuration(),v=this.getWidth();0>this.start&&(this.start=0,this.end-=this.start);this.end>t&&(this.end=t,this.start=t-(this.end-this.start));null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end));
null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end));if(null!=this.element){var c=this.start/t*v;t=this.end/t*v-c;this.style(this.element,{left:this.wavesurfer.UnzoomifyPixelValue(c)+"px",width:t*this.wavesurfer.ZoomFactor+"px",cursor:this.drag?"move":"default"});for(var l in this.attributes)this.element.setAttribute("data-region-"+l,this.attributes[l]);this.element.title=this.formatTime(this.start,this.end)}}},{key:"bindInOut",value:function(){var t=this;this.firedOut=this.firedIn=
!1;var v=function(c){!t.firedOut&&t.firedIn&&(t.start>=Math.round(1E3*c)/1E3||t.end<=c+.0028)&&(t.firedOut=!0,t.firedIn=!1,t.fireEvent("out"),t.wavesurfer.fireEvent("region-out",t));!t.firedIn&&t.start<=c&&t.end>c&&(t.firedIn=!0,t.firedOut=!1,t.fireEvent("in"),t.wavesurfer.fireEvent("region-in",t))};this.wavesurfer.backend.on("audioprocess",v);this.on("remove",function(){t.wavesurfer.backend.un("audioprocess",v)});this.on("out",function(){t.loop?t.wavesurfer.play(t.start):(t.wavesurfer.seekTo(t.start/
t.wavesurfer.getDuration()),t.wavesurfer.stop())})}},{key:"bindEvents",value:function(){var t=this;this.element.addEventListener("mouseenter",function(v){t.fireEvent("mouseenter",v);t.wavesurfer.fireEvent("region-mouseenter",t,v)});this.element.addEventListener("mouseleave",function(v){t.fireEvent("mouseleave",v);t.wavesurfer.fireEvent("region-mouseleave",t,v)});this.element.addEventListener("click",function(v){v.preventDefault();t.fireEvent("click",v);t.wavesurfer.fireEvent("region-click",t,v)});
this.element.addEventListener("dblclick",function(v){v.stopPropagation();v.preventDefault();t.fireEvent("dblclick",v);t.wavesurfer.fireEvent("region-dblclick",t,v)});(this.drag||this.resize)&&function(){var v=t.wavesurfer.getDuration(),c=t.scrollSpeed,l=t.scrollThreshold,d=void 0,g=void 0,p=void 0,q=void 0,e=!1,a=void 0,b=void 0,f=function C(x,z){if(a&&(p||q)){var B=c,D=t.wavesurfer.drawer.wrapper.getBoundingClientRect();-1===z?(D=Math.abs(D.left-x.clientX)-10,0<D&&(B*=D/2)):1===z&&(D=Math.abs(x.clientX-
D.right)-10,0<D&&(B*=D/2));B=B*a/t.wavesurfer.getDuration();t.wavesurfer.LeftProgress+=B;0>t.wavesurfer.LeftProgress?t.wavesurfer.LeftProgress=0:t.wavesurfer.LeftProgress+t.wavesurfer.VisibleDuration>t.wavesurfer.getDuration()&&(t.wavesurfer.LeftProgress=t.wavesurfer.getDuration()-t.wavesurfer.VisibleDuration);t.wavesurfer.ForceDraw();B=t.wavesurfer.ZoomifyValue(t.wavesurfer.drawer.handleEvent(x))*v;D=B-d;d=B;p?t.onDrag(D):t.onResize(D,q);t.wavesurfer.fireEvent("DidZoom");window.requestAnimationFrame(function(){C(x,
z)})}},m=function(x){if(!(x.touches&&1<x.touches.length)&&3!==x.which){g=x.targetTouches?x.targetTouches[0].identifier:null;t.wavesurfer.Interacting|=1;x.stopPropagation();var z=new Event("killCTX",{bubbles:!0});document.body.dispatchEvent(z);d=t.wavesurfer.ZoomifyValue(t.wavesurfer.drawer.handleEvent(x,!0))*v;b=t.wrapper.getBoundingClientRect();"handle"==x.target.tagName.toLowerCase()?x.target.classList.contains("wavesurfer-handle-start")?q="start":x.target.classList.contains("wavesurfer-handle-end")&&
(q="end"):PKAudioEditor.ui.KeyHandler.keyMap[16]?2===t.direction?(q="end",t.update({start:t.start,end:d})):(q="start",t.update({start:d,end:t.end})):(p=!0,q=!1)}},k=function(x){if(!(x.touches&&1<x.touches.length)&&3!==x.which){t.wavesurfer.Interacting&=-2;if(p||q)p=!1,a=null,q=!1;e&&(e=!1,t.util.preventClick(),t.fireEvent("update-end",x),t.wavesurfer.fireEvent("region-update-end",t,x))}},u=function(x){if(!(x.touches&&1<x.touches.length||3===x.which||x.targetTouches&&x.targetTouches[0].identifier!=
g)&&(p||q)){var z=d,C=t.wavesurfer.ZoomifyValue(t.wavesurfer.drawer.handleEvent(x))*v,B=C-d;d=C;t.drag&&p&&(e=e||!!B,t.onDrag(B));t.resize&&q&&(e=e||!!B,q=t.onResize(B,q));if(1<t.wavesurfer.ZoomFactor){if(p){B=t.element.getBoundingClientRect();var D=B.left-b.left;C<z&&0<=D?a=-1:C>z&&D+B.width<=b.right&&(a=1);if(-1===a&&D>l||1===a&&D+B.width<b.right-l)a=null}else z=x.clientX-b.left,a=z<=l?-1:z>=b.right-b.left-l?1:null;a&&f(x,a)}}};t.element.addEventListener("mousedown",m);t.element.addEventListener("touchstart",
m);t.wrapper.addEventListener("mousemove",u);t.wrapper.addEventListener("touchmove",u);document.body.addEventListener("mouseup",k);document.body.addEventListener("touchend",k);t.on("remove",function(){document.body.removeEventListener("mouseup",k);document.body.removeEventListener("touchend",k);t.wrapper.removeEventListener("mousemove",u);t.wrapper.removeEventListener("touchmove",u);document.body.removeEventListener("pointerup",k);t.wrapper.removeEventListener("pointermove",u)});t.wavesurfer.on("destroy",
function(){document.body.removeEventListener("pointerup",k);document.body.removeEventListener("mouseup",k);document.body.removeEventListener("touchend",k)})}()}},{key:"onDrag",value:function(t){var v=this.wavesurfer.getDuration();this.end+t>v||0>this.start+t||this.update({start:this.start+t,end:this.end+t})}},{key:"onResize",value:function(t,v){"start"==v?this.start+t>this.end?(v="end",this.update({start:this.end,end:this.start+t})):this.update({start:Math.min(this.start+t,this.end),end:Math.max(this.start+
t,this.end)}):this.start>this.end+t?(v="start",this.update({start:this.start+t,end:this.start})):this.update({start:Math.min(this.end+t,this.start),end:Math.max(this.end+t,this.start)});return v}}]);return y}();E=function(){function y(t,v){var c=this;r(this,y);this.params=t;this.wavesurfer=v;this.util=v.util;Object.getOwnPropertyNames(this.util.Observer.prototype).forEach(function(l){h.prototype[l]=c.util.Observer.prototype[l]});this.wavesurfer.Region=h;this.list={};this._onReady=function(){c.wrapper=
c.wavesurfer.drawer.wrapper;c.params.regions&&c.params.regions.forEach(function(l){c.add(l)});c.params.dragSelection&&(c.disableDragSelection(),c.enableDragSelection(c.params))}}n(y,null,[{key:"create",value:function(t){return{name:"regions",deferInit:t&&t.deferInit?t.deferInit:!1,params:t,staticProps:{initRegions:function(){console.warn('Deprecated initRegions! Use wavesurfer.initPlugins("regions") instead!');this.initPlugin("regions")},addRegion:function(v){this.initialisedPluginList.regions||this.initPlugin("regions");
return this.regions.add(v)},clearRegions:function(){this.regions&&this.regions.clear()},enableDragSelection:function(v){this.initialisedPluginList.regions||this.initPlugin("regions");this.regions.enableDragSelection(v)},disableDragSelection:function(){this.regions.disableDragSelection()}},instance:y}}}]);n(y,[{key:"init",value:function(){this.wavesurfer.isReady&&this._onReady();this.wavesurfer.on("ready",this._onReady)}},{key:"destroy",value:function(){this.wavesurfer.un("ready",this._onReady);this.disableDragSelection();
this.clear()}},{key:"add",value:function(t){var v=this;this.list[0]&&this.clear();var c=new this.wavesurfer.Region(t,this.wavesurfer);this.list[0]=c;c.on("remove",function(){delete v.list[0]});"t"===t.id&&this.wavesurfer.fireEvent("region-update-end",c,null);return c}},{key:"clear",value:function(){var t=this;Object.keys(this.list).forEach(function(v){t.list[v].remove()})}},{key:"enableDragSelection",value:function(t){var v=this,c=t.slop||2,l=t.scrollSpeed||1,d=t.scrollThreshold||28,g=void 0,p=this.wavesurfer.getDuration(),
q=void 0,e=void 0,a=void 0,b=0,f=void 0,m=void 0,k=function G(B,D){if(e&&f){var K=l,H=v.wavesurfer.drawer.wrapper.getBoundingClientRect();-1===D?(H=Math.abs(H.left-B.clientX)-10,0<H&&(K*=H/2)):1===D&&(H=Math.abs(B.clientX-H.right)-10,0<H&&(K*=H/2));K=K*f/v.wavesurfer.getDuration();v.wavesurfer.LeftProgress+=K;0>v.wavesurfer.LeftProgress?v.wavesurfer.LeftProgress=0:v.wavesurfer.LeftProgress+v.wavesurfer.VisibleDuration>v.wavesurfer.getDuration()&&(v.wavesurfer.LeftProgress=v.wavesurfer.getDuration()-
v.wavesurfer.VisibleDuration);v.wavesurfer.ForceDraw();H=v.wavesurfer.ZoomifyValue(v.wavesurfer.drawer.handleEvent(B));e.update({start:Math.min(H*p,q*p),end:Math.max(H*p,q*p)});v.wavesurfer.fireEvent("DidZoom");0<Math.abs(K)&&window.requestAnimationFrame(function(){G(B,D)})}},u=null,w=function(B){u=null;if(B.touches&&(B.preventDefault(),1<B.touches.length))return;if(3===B.which)u={x:B.pageX,y:B.pageY};else if(v.wavesurfer.Interacting|=1,p=v.wavesurfer.getDuration(),a=B.targetTouches?B.targetTouches[0].identifier:
null,m=v.wrapper.getBoundingClientRect(),g=!0,q=v.wavesurfer.ZoomifyValue(v.wavesurfer.drawer.handleEvent(B,!0)),f=e=null,document.body.addEventListener("mousemove",z),document.body.addEventListener("touchmove",z),PKAudioEditor.ui.KeyHandler.keyMap[16]){var D=v.wavesurfer.ActiveMarker;B.stopPropagation();B.preventDefault();e=v.wavesurfer.regions.list[0];var G=2,K=v.wavesurfer.getDuration();B=v.wavesurfer.drawer.handleEvent(B);B=v.wavesurfer.ZoomifyValue(B);B<D&&(e&&e.start?(D=B,B=e.end/K):(G=D,D=
B,B=G),G=1);e?(e.update({start:D*K,end:B*K}),e.direction=G,q=1===G?B:D):(v.wavesurfer.regions.add({start:D*K,end:B*K,id:"t",direction:G}),e=v.wavesurfer.regions.list[0],e.direction=G,q=1===G?B:D,setTimeout(function(){PKAudioEditor.fireEvent("RequestSeekTo",D)},20))}};this.wrapper.addEventListener("mousedown",w);this.wrapper.addEventListener("touchstart",w);this.on("disable-drag-selection",function(){v.wrapper.removeEventListener("touchstart",w);v.wrapper.removeEventListener("mousedown",w);v.wrapper.removeEventListener("pointerdown",
w)});var x=function(B){if(!(B.touches&&1<B.touches.length))if(3===B.which){if(u){if(3>Math.abs(u.x-B.pageX)&&7>Math.abs(u.y-B.pageY)){var D=document.createEvent("Event");D.initEvent("pk_ctxmn",!0,!0);D.pageX=B.pageX;D.pageY=B.pageY;B.target.dispatchEvent(D)}u=null}}else v.wavesurfer.Interacting&=-2,g&&(document.body.removeEventListener("mousemove",z),document.body.removeEventListener("touchmove",z)),g=!1,b=0,f=null,e&&(v.util.preventClick(),e.fireEvent("update-end",B),v.wavesurfer.fireEvent("region-update-end",
e,B)),e=null};this.wrapper.addEventListener("mouseup",x);this.wrapper.addEventListener("touchend",x);document.body.addEventListener("mouseup",x);document.body.addEventListener("touchend",x);this.on("disable-drag-selection",function(){document.body.removeEventListener("mouseup",x);document.body.removeEventListener("touchend",x);v.wrapper.removeEventListener("touchend",x);v.wrapper.removeEventListener("mouseup",x)});var z=function(B){if(g&&3!==B.which&&!(++b<=c||B.touches&&1<B.touches.length||B.targetTouches&&
B.targetTouches[0].identifier!=a)){e||(e=v.add(t||{}));var D=v.wavesurfer.ZoomifyValue(v.wavesurfer.drawer.handleEvent(B));e.update({start:Math.min(D*p,q*p),end:Math.max(D*p,q*p)});1<v.wavesurfer.ZoomFactor&&(D=B.clientX-m.left,(f=D<=d?-1:D>=m.right-m.left-d?1:null)&&k(B,f))}};this.on("disable-drag-selection",function(){document.body.removeEventListener("mousemove",z);document.body.removeEventListener("touchmove",z)})}},{key:"disableDragSelection",value:function(){this.fireEvent("disable-drag-selection")}},
{key:"getCurrentRegion",value:function(){var t=this,v=this.wavesurfer.getCurrentTime(),c=null;Object.keys(this.list).forEach(function(l){l=t.list[l];l.start<=v&&l.end>=v&&(!c||l.end-l.start<c.end-c.start)&&(c=l)});return c}}]);return y}();A["default"]=E;F.exports=A["default"]}})});
(function(F,A){F.OneUp=function(E,r,n){var h=A.createElement("div"),y="pk_oneup pk_noselect";h.style.cssText="margin-top:20px;opacity:0";n&&(y=y+" "+n);h.className=y;h.innerHTML=E||"";A.body.appendChild(h);setTimeout(function(){h.style.cssText="margin-top:0px;opacity:1";setTimeout(function(){h.style.cssText="margin-top:-20px;opacity:0";setTimeout(function(){h.parentNode.removeChild(h);h=null},330)},r||720)},25)}})(window,document);
(function(F,A){var E=-1;!F.PKAudioList&&(F.PKAudioList=[]);F.PKAudioEditor=new function(){var r=this;r.el=null;r.id=++E;r._deps={};F.PKAudioList[r.id]=r;var n={};r.fireEvent=function(h,y,t){h=n[h];if(!h)return!1;for(var v=h.length;0<v--;)h[v]&&h[v](y,t)};r.listenFor=function(h,y){n[h]?n[h].unshift(y):n[h]=[y]};r.stopListeningFor=function(h,y){var t=n[h];if(!t)return!1;for(var v=t.length;0<v--;)if(t[v]&&t[v]===y){t[v]=null;break}};r.stopListeningForName=function(h){if(!n[h])return!1;n[h]=null};r.init=
function(h){if(h=A.getElementById(h)){r.el=h;r.ui=new r._deps.ui(r);r._deps.uifx(r);r.engine=new r._deps.engine(r);r.state=new r._deps.state(4,r);r.rec=new r._deps.rec(r);r.fls=new r._deps.fls(r);if(F.location.href.split("local=")[1]){var y=F.location.href.split("local=")[1];r.fls.Init(function(){r.fls.GetSession(y,function(t){t&&t.id===y&&r.engine.LoadDB(t)})})}return r}console.log("invalid element")};r.isMobile=/iphone|ipod|ipad|android/.test(navigator.userAgent.toLowerCase())};PKAudioList.push(F.PKAudioEditor)})(window,
document);
(function(F,A,E){E._deps.keyhandler=function(){var r=this;r.keyMap={};r.callbacks={};r.singleCallbacks={};r.addCallback=function(n,h,y){r.callbacks[n]={keys:y,callback:h}};r.addSingleCallback=function(n,h,y){r.singleCallbacks[n]={key:y,callback:h}};r.removeCallback=function(n){r.callbacks[n]=null};A.addEventListener("keydown",function(n){r.keyDown(n.keyCode,n)});r.keyDown=function(n,h){r.keyMap[n]=1;for(var y in r.callbacks){var t=r.callbacks[y];if(t){for(var v=t.keys.length,c=!0;0<v--;)if(!r.keyMap[t.keys[v]]){c=!1;
break}c&&t.callback&&t.callback(n,r.keyMap,h)}}};r.keyUp=function(n){r.keyMap[n]=0};r.keyPress=function(n,h){for(var y in r.singleCallbacks){var t=r.singleCallbacks[y];t&&t.key===n&&t.callback&&t.callback(h)}};A.addEventListener("keyup",function(n){r.keyUp(n.keyCode)});A.addEventListener("keypress",function(n){r.keyPress(n.keyCode,n)});F.addEventListener("blur",function(n){r.keyMap={}},!1);A.addEventListener("contextmenu",function(n){n.preventDefault()},!1)}})(window,document,PKAudioEditor);
(function(F,A,E){var r=[],n={},h=0,y=["mousedown","touchup"],t=function(g,p){if(g&&0!==r.length){var q=g.target||g.srcElement;if(!q||-1===q.className.indexOf("_action")||p){for(q=r.length;q--;){for(var e=r[q],a=e.currentMenu.getElementsByTagName("*"),b=a.length;b--;)a[b].parentNode.removeChild(a[b]);e.currentMenu.removeEventListener(y,v);A.body.removeChild(e.currentMenu);e.currentMenu=null}r=[]}}},v=function(g){g.stopPropagation()},c=function(g,p,q){t(null);r.push(g);var e=A.createElement("div"),
a=g.options;p-=4;q-=4;e.className="pk_contextMenu "+g.menuClass;e.id=g.token;for(var b=0,f=a.length;b<f;++b){if(a[b].isHTML){var m=A.createElement("div");m.innerHTML=a[b].isHTML}else m=A.createElement("a"),m.className="pk_ctx_action",m.cnt=1,m.innerHTML=a[b].name,m.callback=a[b].callback,m.addEventListener("click",m.callback,!1);e.appendChild(m)}g.currentMenu=e;e.addEventListener(y,v,!1);A.body.appendChild(e);a=e.offsetWidth;m=e.offsetHeight;e.style.cssText=F.innerWidth<p+a&&F.innerHeight<q+m?"top:"+
(q-m)+"px;left:"+(p-a)+"px;":F.innerWidth<p+a?"top:"+q+"px;left:"+(p-a)+"px;":F.innerHeight<q+m?"top:"+(q-m)+"px;left:"+p+"px;":"top:"+q+"px;left:"+p+"px;";if(g.onOpen)g.onOpen(g,e);return!1},l=function(g){g?(g.preventDefault(),g.stopPropagation()):g={pageX:0,pageY:0};var p=n[this.getAttribute("data-token")],q=g.pageX||g.clientX+A.documentElement.scrollLeft,e=g.pageY||g.clientY+A.documentElement.scrollTop;if(!p)return!1;p.curr_target=g.target||g.srcElement;c(p,q,e)},d=F.contextMenu=function(g,p){if(!(this instanceof
d))return new d(g,p);p||(p={});this.elem=g;this.options=[];this.menuClass=p.className||"pk_open";this.curr_target=null;g&&g.addEventListener("pk_ctxmn",l,!1);this.token=++h;g&&g.setAttribute("data-token",this.token);n[this.token]=this};d.prototype.open=function(g){l.call(this.elem,g)};d.prototype.close=function(g){t()};d.prototype.openWithToken=function(g,p,q){c(n[g],p||0,q||0)};d.prototype.destroy=function(){this.elem.removeEventListener("pk_ctxmn",l);t();n[this.token]=null;return!1};d.prototype.addOption=
function(g,p,q){var e=this;this.options.push({name:g,callback:function(a){p&&p(e,e._open);t(e,!0)},isHTML:q})};A.addEventListener(y[0],t,!1);A.addEventListener("killCTX",t,!1);E._deps.ContextMenu=d})(window,document,PKAudioEditor);
(function(F,A,E){function r(){var n={};this.Set=function(t,v){var c=n[t];c||(c=[],n[t]=c);c.push(v);localStorage.setItem("pk_presetfx",JSON.stringify(n));return c};this.Save=function(){localStorage.setItem("pk_presetfx",JSON.stringify(n))};this.Get=function(t){return t?n[t]:n};this.GetSingle=function(t,v){if(!t||!v)return!1;for(var c=n[t],l=c.length,d=null;0<l--;)if(c[l].id===v){d=c[l];break}return d?d:!1};this.Del=function(t,v){if(!t)return n;for(var c=n[t],l=c.length,d=!1;0<l--;)if(c[l].id===v){c.splice(l,
1);d=!0;break}d&&localStorage.setItem("pk_presetfx",JSON.stringify(n));return c};if(F.localStorage){var h=F.localStorage.getItem("pk_presetfx"),y=null;if(h){try{y=JSON.parse(h)}catch(t){}y&&(n=y)}}else this.Set=function(){}}E._deps.uifx=function(n){var h=n.ui,y=null,t=new r;n.listenFor("DidCloseFX_UI",function(){y=null});n.listenFor("DidOpenFX_UI",function(l){y=l});n.listenFor("RequestFXUI_SELCUT",function(){var l=n.engine.wavesurfer,d=l.backend.buffer.sampleRate,g=l.regions.list[0];if(!g)return!1;
n.fireEvent("RequestPause");g.element.style.background="red";var p={pos:{start:g.start*d>>0,end:g.end*d>>0},initpos:{start:g.start*d>>0,end:g.end*d>>0}};l.backend.reg=p;l.on("region-updated",function(q){p.pos.start=q.start*d>>0;p.pos.end=q.end*d>>0;l.drawBuffer(!0)})});n.listenFor("RequestFXUI_Gain",function(){n.fireEvent("RequestSelect",1);(new PKAudioFXModal({id:"gain",title:"Apply Gain to selected range",presets:[{name:"Silence",val:0},{name:"-50%",val:.5},{name:"-25%",val:.75},{name:"+25%",val:1.25},
{name:"+50%",val:1.5},{name:"+100%",val:2}],custom_pres:t.Get("gain"),ondestroy:function(l){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},preview:function(l){l=[{val:l.el_body.getElementsByTagName("input")[0].value/1}];n.fireEvent("RequestActionFX_PREVIEW_GAIN",l)},buttons:[{title:"Apply Gain",clss:"pk_modal_a_accpt",callback:function(l){var d=[{val:l.el_body.getElementsByTagName("input")[0].value/1}];1!=d[0].val&&n.fireEvent("RequestActionFX_GAIN",d);l.Destroy()}}],
body:'<div class="pk_row" style="border:none"><label>Gain percentage</label><input type="range" class="pk_horiz" min="0.0" max="2.5" step="0.01" value="1.0" /><span class="pk_val">100%</span></div><div class="pk_row" style="border:none;padding:0">',setup:function(l){var d=l.el_body.getElementsByTagName("input")[0],g=l.el_body.getElementsByTagName("span")[0];l.el_body.getElementsByTagName("a");d.oninput=function(){g.innerHTML=(100*d.value>>0)+"%";n.fireEvent("RequestActionFX_UPDATE_PREVIEW",[{val:d.value/
1}])};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(p){n.ui.InteractionHandler.check("modalfx")&&l.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Speed",function(){n.fireEvent("RequestSelect",1);(new PKAudioFXModal({id:"speed",title:"Change Speed",presets:[{name:"-1/4",val:.25},{name:"-1/2",val:.5},{name:"Slightly slower",val:.85},{name:"Slightly faster%",val:1.1},{name:"+1/4",val:1.25},{name:"+1/2",val:1.5}],
custom_pres:t.Get("speed"),ondestroy:function(l){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},preview:function(l){l=l.el_body.getElementsByTagName("input")[0].value.trim()/1;n.fireEvent("RequestActionFX_PREVIEW_SPEED",l)},buttons:[{title:"Apply Rate",clss:"pk_modal_a_accpt",callback:function(l){var d=l.el_body.getElementsByTagName("input")[0].value.trim()/1;1!=d&&n.fireEvent("RequestActionFX_SPEED",d);l.Destroy()}}],body:'<div class="pk_row" style="border:none"><label>Playback Rate</label><input type="range" class="pk_horiz" min="0.2" max="2.0" step="0.05" value="1.0" /><span class="pk_val">1.0</span></div>',
setup:function(l){var d=l.el_body.getElementsByTagName("input")[0],g=l.el_body.getElementsByTagName("span")[0];d.oninput=function(){g.innerHTML=d.value;n.fireEvent("RequestActionFX_UPDATE_PREVIEW",d.value/1)};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(p){n.ui.InteractionHandler.check("modalfx")&&l.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Flip",function(){if(PKAudioEditor.engine.is_ready){n.fireEvent("RequestRegionClear");
n.fireEvent("RequestSelect",1);var l=0;(new PKAudioFXModal({id:"flip",title:"Channel Info",ondestroy:function(d){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},buttons:[{title:"Apply Changes",clss:"pk_modal_a_accpt",callback:function(d){if(1===l){var g=d.el_body.getElementsByClassName("pk_c_mm")[0],p=d.el_body.getElementsByClassName("pk_c_fl")[0];g.checked?(g=d.el_body.getElementsByClassName("pk_c_c"),g[0].checked?n.fireEvent("RequestActionFX_Flip","mono",0):g[1].checked&&
n.fireEvent("RequestActionFX_Flip","mono",1)):p.checked&&n.fireEvent("RequestActionFX_Flip","flip")}else 2===l&&d.el_body.getElementsByClassName("pk_c_ms")[0].checked&&n.fireEvent("RequestActionFX_Flip","stereo");d.Destroy()}}],body:'<div class="pk_row pk_mm" style="border:none;display:none"><div class="pk_row"><input type="checkbox" class="pk_check pk_c_mm" id="xmm" name="makeMono"><label for="xmm">Make Mono</label></div><div class="pk_row" style="padding-left:30px"><input type="radio" class="pk_check pk_c_c" id="kf6" name="chnl" value="left"><label class="pk_dis" for="kf6">Left Channel</label><input type="radio" class="pk_check pk_c_c" id="kf7" name="chnl" value="right"><label class="pk_dis" for="kf7">Right Channel</label></div><div class="pk_row"><input type="checkbox" class="pk_check pk_c_fl" id="xfc" name="flipChn"><label for="xfc">Flip Channels</label></div></div><div class="pk_row pk_ms" style="border:none;display:none"><div class="pk_row"><input type="checkbox" class="pk_check pk_c_ms" id="xms" checked name="makeStereo"><label for="xms">Make Stereo</label></div></div>',
setup:function(d){var g=null;if(2===PKAudioEditor.engine.wavesurfer.backend.buffer.numberOfChannels){l=1;g=d.el_body.getElementsByClassName("pk_mm")[0];var p=g.getElementsByClassName("pk_c_mm")[0],q=g.getElementsByClassName("pk_c_fl")[0],e=g.getElementsByClassName("pk_c_c"),a=g.getElementsByClassName("pk_dis"),b=[a[0],a[1]];p.onchange=function(f){p.checked?(q.checked=!1,e[0].checked=!0,b[0].className="",b[1].className=""):(e[0].checked=!1,e[1].checked=!1,b[0].className="pk_dis",b[1].className="pk_dis")};
q.onchange=function(f){q.checked&&(p.checked=!1,p.onchange())}}else l=2,g=d.el_body.getElementsByClassName("pk_ms")[0];g.style.display="block";n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(f){n.ui.InteractionHandler.check("modalfx")&&d.Destroy()},[27])}},n)).Show()}});n.listenFor("RequestFXUI_Silence",function(){(new PKSimpleModal({title:"Insert Silence",ondestroy:function(l){h.InteractionHandler.on=!1;h.KeyHandler.removeCallback("modalTemp")},
buttons:[{title:"Insert Silence",clss:"pk_modal_a_accpt",callback:function(l){var d=l.el_body.getElementsByClassName("pk_horiz")[0].value.trim()/1,g=0;l.el_body.getElementsByClassName("pk_check")[1].checked&&(g=PKAudioEditor.engine.wavesurfer.getCurrentTime().toFixed(3)/1);.001<d&&h.fireEvent("RequestActionSilence",g,d);l.Destroy()}}],body:'<div class="pk_row"><input type="radio" class="pk_check" id="ifeq" name="rdslnc" value="beginning"><label  for="ifeq">Insert silence at beginning</label><br/><input type="radio" class="pk_check"  id="vgdja" name="rdslnc" checked value="cursor"><label for="vgdja">Insert silence at current cursor (<span class="pkcdpk"></span>)</label></div><div class="pk_row"><label>Silence in seconds</label><input type="range" min="0.0" max="30.0" class="pk_horiz" step="0.01" value="5.0" /><span class="pk_val">5s</span></div>',
setup:function(l){l.el_body.getElementsByClassName("pkcdpk")[0].innerHTML=PKAudioEditor.engine.wavesurfer.getCurrentTime().toFixed(2)+"s";var d=l.el_body.getElementsByClassName("pk_horiz")[0],g=l.el_body.getElementsByClassName("pk_val")[0];d.oninput=function(){g.innerHTML=(d.value/1).toFixed(2)+"s"};h.fireEvent("RequestPause");h.InteractionHandler.checkAndSet("modal");h.KeyHandler.addCallback("modalTemp",function(p){l.Destroy()},[27])}})).Show()});n.listenFor("RequestActionFXUI_Compressor",function(){n.fireEvent("RequestSelect",
1);var l=function(d){var g=[];d=d.el_body.getElementsByTagName("input");g[0]={val:d[0].value/1};g[1]={val:d[1].value/1};g[2]={val:d[2].value/1};g[3]={val:d[3].value/1};g[4]={val:d[4].value/1};return{threshold:g[0],knee:g[1],ratio:g[2],attack:g[3],release:g[4]}};(new PKAudioFXModal({id:"compressor",title:"Apply Compression to selected range",clss:"pk_bigger",ondestroy:function(d){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},presets:[{name:"Classic",val:"-40,5,7,0.002,0.1"},
{name:"Light",val:"-6,2,2.5,0.002,0.05"},{name:"Dashed Distortion",val:"-45,26,2.05,0.233,0.0"},{name:"Chaotic Distortion",val:"-60,14,11.07,0.036,0.00"}],custom_pres:t.Get("compressor"),preview:function(d){d.el_body.getElementsByTagName("input");d=l(d);n.fireEvent("RequestActionFX_PREVIEW_COMPRESSOR",d)},buttons:[{title:"Apply",clss:"pk_modal_a_accpt",callback:function(d){d.el_body.getElementsByTagName("input");var g=l(d);n.fireEvent("RequestActionFX_Compressor",g);d.Destroy()}}],body:'<div class="pk_row"><label class="pk_line">Threshold</label><input class="pk_horiz" type="range" min="-100" max="0" step="0.1" value="-24.0" /><span class="pk_val">-24.0</span></div><div class="pk_row"><label class="pk_line">Knee</label><input class="pk_horiz" type="range" min="0.0" max="40.0" step="0.01" value="30.0" /><span class="pk_val">30.0</span></div><div class="pk_row"><label class="pk_line">Ratio</label><input class="pk_horiz" type="range" min="1.0" max="20.0" step="0.01" value="12.0" /><span class="pk_val">12.0</span></div><div class="pk_row"><label class="pk_line">Attack</label><input class="pk_horiz" type="range" min="0.0" max="1.0" step="0.001" value="0.003" /><span class="pk_val">0.003</span></div><div class="pk_row" style="border:none"><label class="pk_line">Release</label><input class="pk_horiz" type="range" min="0.0" max="1.0" step="0.001" value="0.25" /><span class="pk_val">0.25</span></div>',
setup:function(d){for(var g=d.el_body.getElementsByTagName("input"),p=0;p<g.length;++p)g[p].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value/1).toFixed(3);var q=l(d);n.fireEvent("RequestActionFX_UPDATE_PREVIEW",q)};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(q){n.ui.InteractionHandler.check("modalfx")&&d.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Normalize",
function(){n.fireEvent("RequestSelect",1);(new PKSimpleModal({title:"Normalize",ondestroy:function(l){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalTemp")},buttons:[{title:"Normalize Audio",clss:"pk_modal_a_accpt",callback:function(l){var d=l.el_body.getElementsByClassName("pk_horiz")[0].value/1,g=l.el_body.getElementsByClassName("pk_check")[0].checked;n.fireEvent("RequestActionFX_Normalize",[g,d]);l.Destroy()}}],body:'<div class="pk_row"><input type="checkbox" id="vhcjgs" class="pk_check" name="normEqually"><label for="vhcjgs">Normalize L/R Equally</label></div><div class="pk_row" style="border:none"><label>Normalize to</label><input type="range" min="0.0" max="2.0" class="pk_horiz" step="0.01" value="1.0" /><span class="pk_val">100%</span></div>',
setup:function(l){var d=l.el_body.getElementsByClassName("pk_horiz")[0],g=l.el_body.getElementsByClassName("pk_val")[0];d.oninput=function(){g.innerHTML=(d.value/1*100>>0)+"%"};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modal");n.ui.KeyHandler.addCallback("modalTemp",function(p){l.Destroy()},[27])}})).Show()});n.listenFor("RequestActionFXUI_ParaGraphicEQ",function(){PKAudioEditor._deps.FxEQ(n,t)});n.listenFor("RequestActionTempo",function(){PKAudioEditor._deps.FxTMP(n)});n.listenFor("RequestActionNewRec",
function(){PKAudioEditor._deps.FxREC(n)});n.listenFor("RequestActionFXUI_GraphicEQ",function(l){n.fireEvent("RequestSelect",1);var d="graph_eq",g=function(a){var b=[];for(var f=a.length,m=0;m<f;++m){var k=a[m];b.push({type:k.getAttribute("data-type"),freq:k.getAttribute("data-freq")/1,val:k.value/1,q:e})}return b},p='<div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="32" data-type="lowshelf" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">< 32hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="64" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">64hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="125" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">125hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="250" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">250hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="500" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">500hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="1000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">1000hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="2000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">2000hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="4000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">4000hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="8000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">8000hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="16000" data-type="highshelf" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm"> >16000hz</span></div>',
q=[{name:"Reset",val:"0,0,0,0,0,0,0,0,0,0"},{name:"Old Radio",val:"-25,-22,-20,-18,-9,0,8,10,-8,-25"},{name:"Lo Fi",val:"-18,-12,0,2,0,4,4,-1,-6,-8"}],e=4.6;20===l&&(d+="_2",q=null,e=10.2,p='<div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="31" data-type="lowshelf" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">< 31hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="44" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">44hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="63" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">63hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="88" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">88hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="125" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">125hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="180" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">180hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="250" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">250hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="335" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">335hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="500" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">500hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="710" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">710hz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="1000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">1khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="1400" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">1.4khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="2000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">2khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="2800" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">2.8khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="4000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">4khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="5600" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">5.6khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="8000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">8khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="11300" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">11.3khz</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="16000" data-type="peaking" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm">16k</span></div><div class="pk_col"><span class="pk_val">0 db</span><input class="pk_vert" data-freq="22000" data-type="highshelf" type="range" min="-25.0" max="25.0" step="0.01" value="0.0" /><span class="pk_btm"> >22khz</span></div>');
(new PKAudioFXModal({id:d,title:"Graphic EQ",clss:20===l?"pk_dens":"",custom_pres:t.Get(d),ondestroy:function(a){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},preview:function(a){a=a.el_body.getElementsByTagName("input");n.fireEvent("RequestActionFX_PREVIEW_PARAMEQ",g(a))},buttons:[{title:"Apply EQ",clss:"pk_modal_a_accpt",callback:function(a){var b=a.el_body.getElementsByTagName("input");n.fireEvent("RequestActionFX_PARAMEQ",g(b));a.Destroy()}}],presets:q,body:'<div class="pk_h200">'+
p+'<div style="clear:both;"></div></div>',setup:function(a){for(var b=a.el_body.getElementsByTagName("input"),f=b.length,m=0;m<f;++m)b[m].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value>>0)+" db";n.fireEvent("RequestActionFX_UPDATE_PREVIEW",g(b))};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(k){n.ui.InteractionHandler.check("modalfx")&&a.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_HardLimiter",
function(){n.fireEvent("RequestSelect",1);(new PKAudioFXModal({title:"Hard Limiting",ondestroy:function(l){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalTemp")},buttons:[{title:"Hard Limiting",clss:"pk_modal_a_accpt",callback:function(l){n.fireEvent("RequestActionFX_HardLimit",l.updateFilter(l));l.Destroy()}}],preview:function(l){n.fireEvent("RequestActionFX_PREVIEW_HardLimit",l.updateFilter(l))},body:'<div class="pk_row"><input type="checkbox" class="pk_check" id="xighs" name="normEqually"><label for="xighs">Hard Limiting</label></div><div class="pk_row"><label>Limit to</label><input type="range" min="0.1" max="1.0" class="pk_horiz pk_w180" step="0.01" value="0.99" /><span class="pk_val">99%</span></div><div class="pk_row"><label>Ratio between lows and highs</label><input type="range" min="0.0" max="1.0" class="pk_horiz pk_w180" step="0.01" value="0.0" /><span class="pk_val">Ratio 0%</span></div><div class="pk_row"><label>Look Ahead (ms)</label><input type="range" min="1.0" max="500.0" class="pk_horiz pk_w180" step="0.01" value="10.0" /><span class="pk_val">10 ms</span></div>',
updateFilter:function(l){var d=[l.el_body.getElementsByClassName("pk_check")[0].checked];l=l.el_body.getElementsByClassName("pk_horiz");for(var g=0;g<l.length;++g)d.push(l[g].value/1);return d},setup:function(l){var d=l.el_body.getElementsByClassName("pk_horiz");d[0].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value/1*100>>0)+"%";n.fireEvent("RequestActionFX_UPDATE_PREVIEW",l.updateFilter(l))};d[1].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=
"Ratio "+(this.value/1*100>>0)+"%";n.fireEvent("RequestActionFX_UPDATE_PREVIEW",l.updateFilter(l))};d[2].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=this.value/1+"ms";n.fireEvent("RequestActionFX_UPDATE_PREVIEW",l.updateFilter(l))};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modal");n.ui.KeyHandler.addCallback("modalTemp",function(g){l.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Delay",function(){n.fireEvent("RequestSelect",
1);var l=function(d){var g=[];d=d.el_body.getElementsByTagName("input");g[0]={val:d[0].value/1};g[1]={val:d[1].value/1};g[2]={val:d[2].value/1};return{delay:g[0],feedback:g[1],mix:g[2]}};(new PKAudioFXModal({id:"delay",title:"Apply Delay to selected range",clss:"pk_bigger",ondestroy:function(d){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},presets:[{name:"Classic",val:"0.3,0.4,0.4"},{name:"Spacey",val:"3.0,0.6,0.3"}],custom_pres:t.Get("delay"),preview:function(d){d=l(d);
n.fireEvent("RequestActionFX_PREVIEW_DELAY",d)},buttons:[{title:"Apply",clss:"pk_modal_a_accpt",callback:function(d){var g=l(d);n.fireEvent("RequestActionFX_DELAY",g);d.Destroy()}}],body:'<div class="pk_row"><label class="pk_line">Delay Time</label><input class="pk_horiz" type="range" min="0.0" max="6.0" step="0.01" value="0.28" /><span class="pk_val">0.28</span></div><div class="pk_row"><label class="pk_line">Feedback</label><input class="pk_horiz" type="range" min="0.0" max="1.0" step="0.01" value="0.5" /><span class="pk_val">0.5</span></div><div class="pk_row"><label class="pk_line">Wet</label><input class="pk_horiz" type="range" min="0.0" max="1.0" step="0.01" value="0.4" /><span class="pk_val">0.4</span></div>',
setup:function(d){for(var g=d.el_body.getElementsByTagName("input"),p=0;p<g.length;++p)g[p].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value/1).toFixed(3);var q=l(d);n.fireEvent("RequestActionFX_UPDATE_PREVIEW",q)};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(q){n.ui.InteractionHandler.check("modalfx")&&d.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Distortion",
function(){n.fireEvent("RequestSelect",1);var l=function(d){return[{val:d.el_body.getElementsByTagName("input")[0].value/1}]};(new PKAudioFXModal({id:"dist",title:"Apply Distortion to selected range",clss:"pk_bigger",ondestroy:function(d){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},preview:function(d){d=l(d);n.fireEvent("RequestActionFX_PREVIEW_DISTORT",d)},buttons:[{title:"Apply",clss:"pk_modal_a_accpt",callback:function(d){var g=l(d);n.fireEvent("RequestActionFX_DISTORT",
g);d.Destroy()}}],body:'<div class="pk_row"><label class="pk_line">Gain</label><input class="pk_horiz" type="range" min="0.0" max="2.0" step="0.01" value="0.5" /><span class="pk_val">0.5</span></div>',setup:function(d){for(var g=d.el_body.getElementsByTagName("input"),p=0;p<g.length;++p)g[p].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value/1).toFixed(2);var q=l(d);n.fireEvent("RequestActionFX_UPDATE_PREVIEW",q)};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");
n.ui.KeyHandler.addCallback("modalfxesc",function(q){n.ui.InteractionHandler.check("modalfx")&&d.Destroy()},[27])}},n)).Show()});n.listenFor("RequestActionFXUI_Reverb",function(){n.fireEvent("RequestSelect",1);(new PKAudioFXModal({id:"reverb",title:"Apply Reverb to selected range",clss:"pk_bigger",ondestroy:function(l){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc")},presets:[{name:"Classic",val:"0.3,0.4,0.4"},{name:"Spacey",val:"3.0,0.6,0.3"}],custom_pres:t.Get("reverb"),
preview:function(l){l=l.el_body.getElementsByTagName("input");n.fireEvent("RequestActionFX_PREVIEW_REVERB",{time:l[0].value/1,decay:l[1].value/1,mix:l[2].value/1})},buttons:[{title:"Apply",clss:"pk_modal_a_accpt",callback:function(l){var d=l.el_body.getElementsByTagName("input");n.fireEvent("RequestActionFX_REVERB",{time:d[0].value/1,decay:d[1].value/1,mix:d[2].value/1});l.Destroy()}}],body:'<div class="pk_row"><label class="pk_line">Time</label><input class="pk_horiz" type="range" min="0.0" max="3.0" step="0.01" value="0.3" /><span class="pk_val">0.3</span></div><div class="pk_row"><label class="pk_line">Decay</label><input class="pk_horiz" type="range" min="0.0" max="3.0" step="0.01" value="0.05" /><span class="pk_val">0.05</span></div><div class="pk_row"><label class="pk_line">Wet</label><input class="pk_horiz" type="range" min="0.0" max="1.0" step="0.01" value="0.6" /><span class="pk_val">0.6</span></div>',
setup:function(l){for(var d=l.el_body.getElementsByTagName("input"),g=0;g<d.length;++g)d[g].oninput=function(){this.parentNode.getElementsByTagName("span")[0].innerHTML=(this.value/1).toFixed(3);var p=l.el_body.getElementsByTagName("input");n.fireEvent("RequestActionFX_UPDATE_PREVIEW",{time:p[0].value/1,decay:p[1].value/1,mix:p[2].value/1})};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(p){n.ui.InteractionHandler.check("modalfx")&&
l.Destroy()},[27])}},n)).Show()});var v=null;n.listenFor("RequestActionID3",function(l,d){if(l)v=d;else{var g=function(p,q){var e='<div style="margin-top:18px"><div><span class="pk_id3ttl">Artist</span><span>'+((q.artist||"-")+"</span></div>");e+='<div><span class="pk_id3ttl">Title</span><span>'+(q.title||"-")+"</span></div>";e+='<div><span class="pk_id3ttl">Album</span><span>'+(q.album||"-")+"</span></div>";e+='<div><span class="pk_id3ttl">Year</span><span>'+(q.year||"-")+"</span></div>";e+='<div><span class="pk_id3ttl">Genre</span><span>'+
(q.genre||"-")+"</span></div>";e+='<div style="max-width:700px"><span class="pk_id3ttl">Comment</span><span>'+((q.comment||{}).text||"-")+"</span></div>";e+='<div><span class="pk_id3ttl">Track</span><span>'+(q.track||"-")+"</span></div>";e+='<div style="max-width:700px"><span class="pk_id3ttl">Lyrics</span><span>'+((q.lyrics||{}).lyrics||"-")+"</span></div>";if("picture"in q){for(var a=q.picture,b="",f=0;f<a.data.length;++f)b+=String.fromCharCode(a.data[f]);e+='<div><span style="float:left" class="pk_id3ttl">Cover</span><span><img style="max-width:340px" src="data:'+
a.format+";base64,"+window.btoa(b)+'"/></span></div>'}p.innerHTML=e+"</div>"};(new PKSimpleModal({title:"ID3 Metatags Explorer",ondestroy:function(p){n.ui.InteractionHandler.forceUnset("_id3");n.ui.KeyHandler.removeCallback("_id3esc")},buttons:[],body:'<input type="file" accept="audio/*" /><div class="pk_row pk_ttx">Choose file to view audio metatags!</div>',setup:function(p){var q=p.el_body.getElementsByTagName("input")[0],e=p.el_body.getElementsByClassName("pk_ttx")[0];q.onchange=function(a){a=
new FileReader;a.onload=function(){var b=PKAudioEditor.engine.ID3(this.result);b?g(e,b):e.innerHTML='<div style="padding:30px 0">No audio metadata found...</div>'};a.readAsArrayBuffer(this.files[0])};v&&g(e,v);n.ui.InteractionHandler.forceSet("_id3");n.ui.KeyHandler.addCallback("_id3esc",function(a){n.ui.InteractionHandler.check("_id3")&&p.Destroy()},[27])}})).Show()}});n.listenFor("RequestSavePreset",function(){if(y){var l=y.el_body;if(l){var d=function(m){var k={"&":"&amp;","<":"&lt;",">":"&gt;",
'"':"&quot;","'":"&#039;"};return m.replace(/[&<>"']/g,function(u){return k[u]})},g=!0,p=null,q=y.el_presets;q=q.options[q.selectedIndex];l=l.querySelectorAll("select, input");var e={target:y.id,name:"My Preset",id:y.id+"_"+(99*Math.random()>>0),date:Date.now(),val:""};q&&q.getAttribute("data-custom")&&(g=!1,p=q.getAttribute("data-custom"));for(q=0;q<l.length;++q)e.val="checkbox"===l[q].type?e.val+((l[q].checked?"1":"0")+","):e.val+(l[q].value+",");if(0<e.val.length){e.val=e.val.substring(0,e.val.length-
1);l="";q={};var a={},b=null;g||(b=t.GetSingle(e.target,p),l='value="'+b.name+'"',q={title:"Delete",clss:"pk_modal_a_red",callback:function(m){OneUp("Successfully deleted preset!",1400);var k=t.Del(e.target,p);n.fireEvent("DidSetPresets",e.target,k);m.Destroy()}},a={title:"Update",callback:function(m){if(b){var k=m.el_body.getElementsByTagName("input")[0].value.trim();k=d(k);0<k.length?(OneUp("Successfully updated preset!",1400),b.name=k,b.val=e.val,t.Save(),k=t.Get(e.target),n.fireEvent("DidSetPresets",
e.target,k),m.Destroy()):OneUp("Name is too short...",1200)}}});var f='Save Custom Preset for filter "'+y.id+'"';g||(f='Edit Custom Preset "'+b.name+'", for filter "'+y.id+'"');(new PKSimpleModal({title:f,ondestroy:function(m){n.ui.InteractionHandler.forceUnset("_ctPr");n.ui.KeyHandler.removeCallback("_ctPresc");n.ui.KeyHandler.removeCallback("_ctPrent")},buttons:[{title:g?"Save":"Save As New",clss:"pk_modal_a_accpt",callback:function(m){var k=m.el_body.getElementsByTagName("input")[0].value.trim();
k=d(k);0<k.length?(OneUp("Successfully saved preset!",1400),e.name=k,k=t.Set(e.target,e),n.fireEvent("DidSetPresets",e.target,k),n.fireEvent("RequestSetPresetActive",e.target,e.id),m.Destroy()):OneUp("Name is too short...",1200)}},a,q],body:'<label for="k07">Preset Name</label><input style="min-width:340px" maxlength="16" placeholder="Please type a name, eg: My Preset" '+l+' class="pk_txt" type="text" id="k07" />',setup:function(m){n.ui.InteractionHandler.forceSet("_ctPr");n.ui.KeyHandler.addCallback("_ctPresc",
function(k){n.ui.InteractionHandler.check("_ctPr")&&m.Destroy()},[27]);n.ui.KeyHandler.addCallback("_ctPren",function(k){n.ui.InteractionHandler.check("_ctPr")&&m.els.bottom[0].click()},[13]);setTimeout(function(){if(m.el){var k=m.el.getElementsByTagName("input")[0];k.focus();0<k.value.length&&(k.selectionStart=k.selectionEnd=k.value.length)}},20)}})).Show()}}}});var c={};n.listenFor("WillUnload",function(){var l,d;for(d in c)(l=c[d])&&!l.type&&l.destroy&&l.destroy();c={}});n.listenFor("RequestDragI",
function(l){if(n.isMobile)alert("unsupported on mobile");else{var d=c[l];if(d&&d.el){d.el.style.pointerEvents="none";d.el.style.zIndex="9";d.win.document.body.classList.add("c");var g=document.createElement("div");g.className="pk_modal_back";document.body.appendChild(g);var p=!0,q=0,e=0,a=2,b=parseInt(d.el.style.top)||0,f=parseInt(d.el.style.left)||0;n.ui.InteractionHandler.on=!0;setTimeout(function(){d&&d.el&&(d.el.style.display="none",setTimeout(function(){d.el.style.display="block"},0),g.focus())},
60);g.onmousemove=function(m){if(p)if(0===q&&0===e)q=m.pageX,e=m.pageY;else{var k=m.pageX-q;b+=m.pageY-e;f+=k;d.el.style.top=b+"px";d.el.style.left=f+"px";q=m.pageX;e=m.pageY;--a}};g.onmouseup=function(m){p=!1;d.win.document.body.classList.remove("c");d.el.style.pointerEvents="";d.el.style.zIndex="7";n.ui.InteractionHandler.on=!1;document.body.removeChild(g);if("mouseup"===m.type&&0<a){d.el.style.top="0px";m=n.ui.BarBtm.el.childNodes;for(var k=0,u=0;u<m.length&&d.el!==m[u];++u)k+=m[u].clientWidth+
18;d.el.style.left=k+"px"}g.onmousemove=null;g.onmouseleave=null;g=g.onmouseup=null};g.onmouseleave=function(m){g.onmouseup(m);n.fireEvent("RequestShowFreqAn",l,[[window.screenLeft+m.pageX||0,window.screenTop+m.pageY||0],0])}}}});n.listenFor("RequestShowFreqAn",function(l,d){if(n.isMobile)alert("Currently unsupported on mobile");else{var g=d[0],p=d[1],q="Frequency Analysis",e=c[l];"sp"===l&&(q="Spectrum Analysis");var a=!1;if(e&&g){a=!1;e.type===p&&(a=!0);e.destroy();e=null;c[l]=null;if(a)return;
a=!0}var b=function(x,z){e&&e.win.update&&e.win.update(z)},f=function(x,z){x.win.destroy=function(){n.stopListeningFor("DidAudioProcess",b);n.fireEvent("DidToggleFreqAn",z,null);x&&x===c[l]&&(c[l]=null);var C=!0,B;for(B in c)if(c[B]){C=!1;break}C&&(n.engine.wavesurfer.backend.logFrequencies=!1)};n.listenFor("DidAudioProcess",b);n.fireEvent("DidToggleFreqAn",z,e);n.engine.wavesurfer.backend.logFrequencies=!0};if(!p){var m=function(x){var z="";x&&x[0]&&(x[0]=Math.max(0,x[0]-200)>>0,x[1]=Math.max(0,
x[1])>>0,z=",left="+x[0]+",top="+x[1]);var C=window.open("/"+l+".html",q,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=188"+z);C?(c[l]={type:p,el:null,win:C,destroy:function(){C&&C.close&&C.close()}},e=c[l],f(e,l)):OneUp("Please allow pop-ups for AudioMass!",3600,"pk_r")};a?setTimeout(function(){m(g)},130):m(g)}else if(1===p){var k=document.createElement("iframe");k.className="pk_frqan";k.id="pk_fr"+l;if(n.ui.BarBtm.on){a=n.ui.BarBtm.el.childNodes;
for(var u=0,w=0;w<a.length;++w)u+=a[w].clientWidth+18;k.style.left=u+"px"}n.ui.BarBtm.el.appendChild(k);n.ui.BarBtm.Show();c[l]={type:p,el:k,win:null,destroy:function(){k.parentNode.removeChild(k);k=null;var x=n.ui.BarBtm.el.childNodes;0===x.length?n.ui.BarBtm.Hide():setTimeout(function(){for(var z=0,C=0;C<x.length;++C)x[C]&&x[C].parentNode&&(-20<x[C].offsetTop&&(x[C].style.top="0px",x[C].style.left=z+"px"),z+=x[C].clientWidth+18)},198)}};e=c[l];k.onload=function(x){e&&e.type===p&&(e.win=k.contentWindow,
f(e,l))};k.src="/"+l+".html?iframe=1"}}})}})(window,document,PKAudioEditor);
(function(F,A,E){function r(c,l){return[{name:"File",children:[{name:"Export / Download",action:function(){(new PKSimpleModal({title:"Export / Download",ondestroy:function(d){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTemp")},buttons:[{title:"Export",clss:"pk_modal_a_accpt",callback:function(d){for(var g=d.el_body.getElementsByTagName("input")[0].value.trim(),p="mp3",q=128,e=!1,a=!1,b=d.el_body.getElementsByClassName("pk_check"),f=b.length;0<f--;)b[f].checked&&("frmtex"==b[f].name?
p=b[f].value:"xport"==b[f].name?"sel"===b[f].value&&(e=(e=c.engine.wavesurfer.regions.list[0])?[e.start,e.end]:!1):"chnl"==b[f].name?"stereo"===b[f].value&&(a=!0):q=b[f].value/1);c.engine.DownloadFile(g,p,q,e,a);d.Destroy()}}],body:'<div class="pk_row"><label for="k0">File Name</label><input style="min-width:250px" placeholder="mp3 filename" value="audiomass-output.mp3" class="pk_txt" type="text" id="k0" /></div><div class="pk_row" id="frmtex" style="padding-bottom:4px"><label style="display:inline">Format</label><input type="radio" class="pk_check" id="k01" name="frmtex" checked value="mp3"><label for="k01">mp3</label><input type="radio" class="pk_check" id="k02" name="frmtex" value="wav"><label for="k02">wav <i>(44100hz)</i></label></div><div class="pk_row" id="frmtex-mp3"><input type="radio" class="pk_check" id="k1" name="rdslnc" checked value="128"><label  for="k1">128kbps</label><input type="radio" class="pk_check"  id="k2" name="rdslnc" value="192"><label for="k2">192kbps</label><input type="radio" class="pk_check"  id="k3" name="rdslnc" value="256"><label for="k3">256kbps</label></div><div class="pk_row" style="padding-bottom:5px"><input type="radio" class="pk_check" id="k6" name="chnl" checked value="mono"><label for="k6">Mono</label><input type="radio" class="pk_check pk_stereo" id="k7" name="chnl" value="stereo"><label for="k7">Stereo</label></div><div class="pk_row"><input type="radio" class="pk_check" id="k4" name="xport" checked value="whole"><label for="k4">Export whole file</label><input type="radio" class="pk_check" id="k5" name="xport" value="sel"><label class="pk_lblmp3" for="k5">Export Selection Only</label></div>',
setup:function(d){var g=PKAudioEditor.engine.wavesurfer;g.regions.list[0]||(d.el_body.getElementsByClassName("pk_lblmp3")[0].className="pk_dis");2===g.backend.buffer.numberOfChannels&&(d.el_body.getElementsByClassName("pk_stereo")[0].checked=!0);c.fireEvent("RequestPause");c.ui.InteractionHandler.checkAndSet("modal");c.ui.KeyHandler.addCallback("modalTemp",function(p){d.Destroy()},[27]);setTimeout(function(){if(d.el){var p=d.el.getElementsByTagName("input")[0];p&&p.select();var q=document.getElementById("frmtex"),
e=document.getElementById("frmtex-mp3");q&&q.addEventListener("change",function(a){a=this.getElementsByTagName("input");for(var b=0;b<a.length;++b)a[b].checked&&("mp3"===a[b].value?(e.style.display="block",p.value=p.value.replace(".wav",".mp3")):(e.style.display="none",p.value=p.value.replace(".mp3",".wav")))},!1)}},20)}})).Show()},clss:"pk_inact",setup:function(d){d.setAttribute("data-id","dl");c.listenFor("DidUnloadFile",function(){d.classList.add("pk_inact")});c.listenFor("DidLoadFile",function(){d.classList.remove("pk_inact")})}},
{name:"Load from Computer",type:"file",action:function(d){c.fireEvent("RequestLoadLocalFile")}},{name:"Load Sample File",action:function(d){c.engine.LoadSample()}},{name:"Load From URL",action:function(d){(new PKSimpleModal({title:"Load audio from remote url",ondestroy:function(g){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTemp");c.ui.KeyHandler.removeCallback("modalTempEnter")},buttons:[{title:"Load Asset",clss:"pk_modal_a_accpt",callback:function(g){var p=g.el_body.getElementsByTagName("input")[0].value.trim();
var q=/^((https?:)?\/\/)?(?:\S+(?::\S*)?@)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/i.test(p)?!0:!1;q?(c.engine.LoadURL(p),g.Destroy()):OneUp("Invalid URL entered",1100)}}],body:'<label for="k00">Insert url</label><input style="min-width:250px" placeholder="Please insert url" class="pk_txt" type="text" id="k00" />',setup:function(g){c.fireEvent("RequestPause");c.ui.InteractionHandler.checkAndSet("modal");
c.ui.KeyHandler.addCallback("modalTemp",function(p){g.Destroy()},[27]);c.ui.KeyHandler.addCallback("modalTempEnter",function(p){g.els.bottom[0].click()},[13]);setTimeout(function(){g.el&&g.el.getElementsByTagName("input")[0].focus()},20)}})).Show()}},{name:"New Recording",action:function(d){c.fireEvent("RequestActionNewRec")}},{name:"Save Draft Locally",clss:"pk_inact",action:function(d){if(c.engine.is_ready){var g=function(p,q){var e=c.engine.wavesurfer.backend.buffer;"copy"===p?e=c.engine.GetCopyBuff():
"sel"===p&&(e=c.engine.GetSel());var a=function(b){var f=Math.random().toString(36).substring(7);b.SaveSession(e,f,q);c.stopListeningFor("DidOpenDB",a)};c.listenFor("DidOpenDB",a);c.fls.on?c.fireEvent("DidOpenDB",c.fls):c.fls.Init(function(b){b&&alert("db error")})};(new PKSimpleModal({title:"Save Local Draft of...",ondestroy:function(p){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[{title:"Save",clss:"pk_modal_a_accpt",callback:function(p){var q="whole",e=
p.el_body.getElementsByTagName("input"),a=e[e.length-1].value;a?(a=a.trim(),100<=a.length&&(a=a.substr(0,99).trim()),0===a.length&&(a=null)):a=null;for(var b=0;b<e.length;++b)if(e[b].checked){q=e[b].value;break}g(q,a);p.Destroy()}}],body:'<p>Please choose source...</p><div class="pk_row"><input type="radio" class="pk_check" id="sl1" name="rdslnc" checked value="whole"><label style="vertical-align:top" for="sl1">Whole Track</label><input type="radio" class="pk_check"  id="sl2" name="rdslnc" value="sel"><label style="vertical-align:top" class="pk_lblsel" for="sl2">Selection<i style="display:block;font-size:11px;margin-top:-5px"></i></label><input type="radio" class="pk_check"  id="sl3" name="rdslnc" value="copy"><label style="vertical-align:top" class="pk_lblsel2" for="sl3">"Copy" clipboard/buffer</label></div><div class="pk_row"><label for="slk0">Draft Name</label><input style="min-width:250px" placeholder="(optional) filename" maxlength="100" class="pk_txt" type="text" id="slk0" /></div>',
setup:function(p){var q=c.engine.wavesurfer.regions.list[0],e=p.el_body.getElementsByClassName("pk_lblsel")[0];q?(p.el_body.getElementsByClassName("pk_check")[1].checked=!0,e.childNodes[1].textContent=c.ui.formatTime(q.start)+" to "+c.ui.formatTime(q.end)):e.className="pk_dis";c.engine.GetCopyBuff()||(p.el_body.getElementsByClassName("pk_lblsel2")[0].className="pk_dis");c.isMobile||setTimeout(function(){p.el&&p.el.getElementsByClassName("pk_txt")[0].focus()},20);c.fireEvent("RequestPause");c.ui.InteractionHandler.checkAndSet("modal");
c.ui.KeyHandler.addCallback("modalTempErr",function(a){p.Destroy()},[27])}})).Show()}},setup:function(d){c.listenFor("DidUnloadFile",function(){d.classList.add("pk_inact")});c.listenFor("DidLoadFile",function(){d.classList.remove("pk_inact")});c.listenFor("DidStoreDB",function(g,p){var q=g.id;(new PKSimpleModal({title:"Succesfully Stored",ondestroy:function(e){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[{title:"OPEN IN NEW WINDOW",callback:function(e){window.open(window.location.pathname+
"?local="+q);e.Destroy()}}],body:'<p>Open in new window?</p><div style="padding:2px 0">id: '+(q+'</div><div style="padding:2px 0"><span>durr: '+g.durr+"s</span>&nbsp;&nbsp;&nbsp;<span>chan: "+(1===g.chans?"mono":"stereo")+'</span></div><div style="padding:2px 0"><img src="'+g.thumb+'" /></div>'),setup:function(e){c.fireEvent("RequestPause");c.fireEvent("RequestRegionClear");c.ui.InteractionHandler.checkAndSet("modal");c.ui.KeyHandler.addCallback("modalTempErr",function(a){e.Destroy()},[27])}})).Show()})}},
{name:"Open Local Drafts",action:function(d){var g=new Date,p=function(e){e=(g-e)/1E3>>0;if(59>=e)return g=1<e?"s":"",e+" second"+g+" ago";if(60<=e&&3599>=e)return e=Math.floor(e/60),e+" minute"+(1<e?"s":"")+" ago";if(3600<=e&&86399>=e)return e=Math.floor(e/3600),e+" hour"+(1<e?"s":"")+" ago";if(86400<=e&&2592030>=e)return e=Math.floor(e/86400),e+" day"+(1<e?"s":"")+" ago";if(2592031<=e)return e=Math.floor(e/2592E3),e+" month"+(1<e?"s":"")+" ago"},q=function(e){e.ListSessions(function(a){var b="";
if(0===a.length)b+="No drafts found...";else for(var f=0;f<a.length;++f){var m=a[f],k=new Date(m.created),u=k.getMonth()+1+"/"+k.getDate()+"/"+k.getFullYear()+"  "+k.getHours()+":"+k.getMinutes()+":"+k.getSeconds();k=p(k);b+='<div id="pk_'+m.id+'" class="pk_lcldrf"><div style="padding-bottom:2px"><span><i class="pk_i">name:</i>'+(m.name||"-")+'</span></div><div><span class="pk_lcls"><i class="pk_i">id:</i><strong>'+m.id+'</strong><br/><i class="pk_i">chn:</i>'+(1===m.chans?"mono":"stereo")+'</span><span class="pk_lcls" style="width:50%;text-align:center"><i class="pk_i">date:</i><span>'+
u+"<br/>"+k+'</span></span><span style="text-align:right;float:right" class="pk_lcls"><i class="pk_i">durr:</i>'+m.durr+'s</span></div><div><img class="pk_lcli" src="'+m.thumb+'" /><a class="pk_lcla2" onclick="PKAudioEditor.fireEvent(\'LoadDraft\',\''+m.id+"', 3);\">PLAY</a><a class=\"pk_lcla\" onclick=\"PKAudioEditor.fireEvent('LoadDraft','"+m.id+"');\">Open</a>";c.engine.is_ready&&(b+="<a onclick=\"PKAudioEditor.fireEvent('LoadDraft','"+m.id+'\',1);" class="pk_lcla">Append to Current Track</a>');
b+='<a class="pk_lcla" style="color:#ad2b2b" onclick="PKAudioEditor.fireEvent(\'LoadDraft\',\''+m.id+"',2);\">Del</a>";b+="</div></div>"}var w=function(C,B){2!==B&&3!==B&&(z.Destroy(),z=null)},x=function(C,B){var D;B?(D=document.getElementById("pk_"+C))&&(D=D.getElementsByClassName("pk_lcla2")[0])&&D.classList.add("pk_act"):(D=z.el_body.getElementsByClassName("pk_act")[0])&&D.classList.remove("pk_act")};c.listenFor("_lclStart",x);var z=new PKSimpleModal({title:"Local Drafts",clss:"pk_bigger",ondestroy:function(C){c.fireEvent("_lclStop");
c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTempErr");c.stopListeningFor("LoadDraft",w);c.stopListeningFor("_lclStart",x)},buttons:[],body:"<div>"+b+"</div>",setup:function(C){c.fireEvent("RequestPause");c.fireEvent("RequestRegionClear");c.listenFor("LoadDraft",w);c.ui.InteractionHandler.checkAndSet("modal");c.ui.KeyHandler.addCallback("modalTempErr",function(B){C.Destroy()},[27])}});z.Show()});c.stopListeningFor("DidOpenDB",q)};c.listenFor("DidOpenDB",q);c.fls.on?c.fireEvent("DidOpenDB",
c.fls):c.fls.Init(function(e){e&&alert("db error")})},setup:function(){var d={};c.listenFor("_lclStop",function(g,p){d.src&&(d.src.stop(),d.src.disconnect(),d.src.onended=null,d.aud.close&&d.aud.close(),d={})});c.listenFor("LoadDraft",function(g,p){c.fls.Init(function(q){if(!q)if(2===p)d.id===g&&(c.fireEvent("_lclStart",d.id,0),d.src.stop(),d.src.disconnect(),d.src.onended=null,d.aud.close&&d.aud.close(),d={}),c.fls.DelSession(g,function(f){if(f=document.getElementById("pk_"+f))1===f.parentNode.children.length?
f.parentNode.innerHTML="No drafts found...":f.parentNode.removeChild(f)});else if(3===p){if(d.id&&(q=!1,d.id===g&&(q=!0),c.fireEvent("_lclStart",d.id,0),d.src.stop(),d.src.disconnect(),d.src.onended=null,d.aud.close&&d.aud.close(),d={},q))return;var e=new (F.AudioContext||F.webkitAudioContext);e&&"suspended"==e.state&&e.resume&&e.resume();c.fls.GetSession(g,function(f){f&&f.id===g&&(d.id=f.id,d.aud=e,d.src=c.engine.PlayBuff(f.data,f.chans,f.samplerate,e),d.src?(d.src.onended=function(m){c.fireEvent("_lclStart",
d.id,0);d.src.stop();d.src.disconnect();d.src.onended=null;d.aud.close&&d.aud.close();d={}},c.fireEvent("_lclStart",f.id,1)):(d.aud&&d.aud.close&&d.aud.close(),d={}))})}else{var a=function(f,m,k){return function(){f.fls.GetSession(m,function(u){u&&u.id===m&&(f.engine.wavesurfer.backend._add=k?1:0,f.engine.LoadDB(u))})}}(c,g,p);if(c.engine.is_ready&&!p){var b=new PKSimpleModal({title:"Open in Existing?",body:"<div>Open in new window, or in the current one?</div>",buttons:[{title:"OPEN",clss:"pk_modal_a_accpt",
callback:function(f){a();f.Destroy()}},{title:"OPEN IN NEW",clss:"pk_modal_a_accpt",callback:function(f){window.open(window.location.pathname+"?local="+g);f.Destroy()}}],setup:function(f){c.ui.InteractionHandler.checkAndSet("mm");c.ui.KeyHandler.addCallback("mmErr",function(m){f.Destroy()},[27])},ondestroy:function(f){a=null;c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("mmErr")}});setTimeout(function(){b.Show()},0)}else a()}})})}}]},{name:"Edit",children:[{name:'Undo <span class="pk_shrtct">Shft+Z</span>',
clss:"pk_inact",action:function(){c.fireEvent("StateRequestUndo")},setup:function(d){c.listenFor("DidStateChange",function(g,p){0===g.length?(d.innerHTML='Undo <span class="pk_shrtct">Shft+Z</span>',d.classList.add("pk_inact")):(d.innerHTML='Undo&nbsp;<i style="pointer-events:none">'+g[g.length-1].desc+'</i><span class="pk_shrtct">Shft+Z</span>',d.classList.remove("pk_inact"))})}},{name:'Redo <span class="pk_shrtct">Shft+Y</span>',clss:"pk_inact",action:function(){c.fireEvent("StateRequestRedo")},
setup:function(d){c.listenFor("DidStateChange",function(g,p){0===p.length?(d.innerHTML='Redo <span class="pk_shrtct">Shft+Y</span>',d.classList.add("pk_inact")):(d.innerHTML='Redo&nbsp;<i style="pointer-events:none">'+p[0].desc+'</i><span class="pk_shrtct">Shft+Y</span>',d.classList.remove("pk_inact"))})}},{name:'Play <span class="pk_shrtct">Space</span>',action:function(){c.fireEvent("RequestPlay")}},{name:"Stop",action:function(){c.fireEvent("RequestStop")}},{name:'Select All <span class="pk_shrtct">Shft+A</span>',
action:function(){c.fireEvent("RequestSelect")}},{name:'Deselect All <span class="pk_shrtct">~</span>',action:function(){c.fireEvent("RequestDeselect")}},{name:"Channel Info/Flip",action:function(){c.fireEvent("RequestActionFXUI_Flip")},clss:"pk_inact",setup:function(d){c.listenFor("DidUnloadFile",function(){d.classList.add("pk_inact")});c.listenFor("DidLoadFile",function(){d.classList.remove("pk_inact")})}}]},{name:"Effects",children:[{name:"Gain",action:function(){c.fireEvent("RequestFXUI_Gain")}},
{name:"Fade In",action:function(){c.fireEvent("RequestActionFX_FadeIn")}},{name:"Fade Out",action:function(){c.fireEvent("RequestActionFX_FadeOut")}},{name:"Noise Reduction (Voice)",action:function(){c.fireEvent("RequestActionFX_NoiseRNN")}},{name:"Paragraphic EQ",action:function(){c.fireEvent("RequestActionFXUI_ParaGraphicEQ")}},{name:"Compressor",action:function(){c.fireEvent("RequestActionFXUI_Compressor")}},{name:"Normalize",action:function(){c.fireEvent("RequestActionFXUI_Normalize")}},{name:"Graphic EQ",
action:function(){c.fireEvent("RequestActionFXUI_GraphicEQ",10)}},{name:"Graphic EQ (20 bands)",action:function(){c.fireEvent("RequestActionFXUI_GraphicEQ",20)}},{name:"Hard Limiter",action:function(){c.fireEvent("RequestActionFXUI_HardLimiter")}},{name:"Delay",action:function(){c.fireEvent("RequestActionFXUI_Delay")}},{name:"Distortion",action:function(){c.fireEvent("RequestActionFXUI_Distortion")}},{name:"Reverb",action:function(){c.fireEvent("RequestActionFXUI_Reverb")}},{name:"Speed Up / Slow Down",
action:function(){c.fireEvent("RequestActionFXUI_Speed")}},{name:"Reverse",action:function(){c.fireEvent("RequestActionFX_Reverse")}},{name:"Invert",action:function(){c.fireEvent("RequestActionFX_Invert")}},{name:"Remove Silence",action:function(){c.fireEvent("RequestActionFX_RemSil")}}]},{name:"View",children:[{name:"Follow Cursor  &#10004;",action:function(d){c.fireEvent("RequestViewFollowCursorToggle")},setup:function(d){c.listenFor("DidViewFollowCursorToggle",function(g){g?d.innerHTML="Follow Cursor &#10004;":
d.textContent="Follow Cursor"})}},{name:"Peak Separators &#10004;",action:function(d){c.fireEvent("RequestViewPeakSeparatorToggle")},setup:function(d){c.listenFor("DidViewPeakSeparatorToggle",function(g){g?d.innerHTML="Peak Separators &#10004;":d.textContent="Peak Separators"})}},{name:"Timeline &#10004;",action:function(d){c.fireEvent("RequestViewTimelineToggle")},setup:function(d){c.listenFor("DidViewTimelineToggle",function(g){g?d.innerHTML="Timeline &#10004;":d.textContent="Timeline"})}},{name:"---"},
{name:"Frequency Analyser",action:function(d){c.fireEvent("RequestShowFreqAn","eq",[1])},setup:function(d){c.listenFor("DidToggleFreqAn",function(g,p){"eq"===g&&(p?d.innerHTML="Frequency Analyser &#10004;":d.textContent="Frequency Analyser")})}},{name:"Spectrum Analyser",action:function(d){c.fireEvent("RequestShowFreqAn","sp",[1])},setup:function(d){c.listenFor("DidToggleFreqAn",function(g,p){"sp"===g&&(p?d.innerHTML="Spectrum Analyser &#10004;":d.textContent="Spectrum Analyser")})}},{name:"Tempo Tools",
action:function(d){c.fireEvent("RequestActionTempo")}},{name:"ID3 Tags",action:function(d){c.fireEvent("RequestActionID3")}},{name:"---"},{name:'Center to Cursor <span class="pk_shrtct">[Tab]</span>',action:function(d){c.fireEvent("RequestViewCenterToCursor")}},{name:'Reset Zoom <span class="pk_shrtct">[0]</span>',action:function(d){c.fireEvent("RequestZoomUI",0)}}]},{name:"Help",children:[{name:"Store Offline Version",action:function(){if(0<window.location.href.indexOf("-cache")){var d=function(g){confirm("Would you like to refresh the page to load the newer version?")&&
window.location.reload()};window.applicationCache.onupdateready=d;window.applicationCache.ondownloading=function(g){OneUp("Downloading newer version",1500)};window.applicationCache.status===window.applicationCache.UPDATEREADY&&d();window.applicationCache.update()}else(new PKSimpleModal({title:"Open Offline Version?",ondestroy:function(g){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[{title:"OPEN",callback:function(g){window.open("/index-cache.html");g.Destroy()}}],
body:"<p>This will open a new window that will try to store a local version in your browser</p>",setup:function(g){c.fireEvent("RequestPause");c.fireEvent("RequestRegionClear");c.ui.InteractionHandler.checkAndSet("modal");c.ui.KeyHandler.addCallback("modalTempErr",function(p){g.Destroy()},[27])}})).Show()},setup:function(d){0<window.location.href.indexOf("-cache")&&(d.innerHTML="Update Offline Version")}},{name:"---"},{name:"About",action:function(){window.open("/about.html")}},{name:"See Welcome Message",
action:function(){PKAudioEditor._deps.Wlc()}},{name:"SourceCode on Github",action:function(){window.open("https://github.com/pkalogiros/audiomass")}}]}]}function n(c,l){function d(u,w,x){for(var z=0;z<w.length;++z){var C=A.createElement("div"),B=w[z];if(0===x){C.className="pk_btn pk_noselect";var D=A.createElement("button");D.innerHTML=B.name;C.appendChild(D)}else C.className="pk_menu_el",D=A.createElement("button"),D.className="pk_opt "+(B.clss?B.clss:""),D.setAttribute("tab-index","-1"),D.setAttribute("data-index",
z),D.innerHTML=B.name,C.appendChild(D),B.action&&function(G,K){G.onclick=function(H){this.classList.contains("pk_inact")||(m.closeMenu(),K(H))}}(D,B.action),B.setup&&B.setup(D);u.appendChild(C);0===x&&(f[z]=C.childNodes[0]);B.children&&(D=A.createElement("div"),D.className="pk_menu",d(D,B.children,x+1),C.appendChild(D))}}function g(u){if(e==u||!u)return!1;for(var w=u.parentNode;w&&e;){if(e.parentNode==w)return!1;w=w.parentNode}for(w=f.length;0<w--;)if(f[w]===u)return m.openMenu(w,!0);return!1}var p=
A.createElement("div");p.className="pk_hdr pk_noselect";var q=-1,e=null,a=null,b=null,f=[],m=this;d(p,c,0);this.getOpenElement=function(){return e};this.closeMenu=function(){e&&(e.parentNode.className="pk_btn pk_noselect",e=a=null,b&&(b.classList.remove("pk_act"),b=null),l.InteractionHandler.on=!1,A.removeEventListener("mouseup",k),l.KeyHandler.removeCallback("TopHeader1"),l.KeyHandler.removeCallback("TopHeader2"),l.KeyHandler.removeCallback("TopHeader3"),l.KeyHandler.removeCallback("TopHeader4"),
l.KeyHandler.removeCallback("TopHeader5"),l.KeyHandler.removeCallback("TopHeader6"))};this.openMenu=function(u,w){e&&(e.parentNode.className="pk_btn pk_noselect");-1===u&&(u=-1===q?0:q);var x=f[u];e=x;var z=x.parentNode,C=z.getBoundingClientRect().left,B=window.innerWidth,D=0;200>B-C&&(D=264-(B-C)>>0,1<D&&(z.getElementsByClassName("pk_menu")[0].style.left=-D/2+"px"));z.className+=" pk_vis";setTimeout(function(){e===x&&(z.className+=" pk_act")},0);q=u;l.InteractionHandler.checkAndSet("TopHeader");
w||A.addEventListener("mouseup",k,!1);l.KeyHandler.addCallback("TopHeader1",function(G){0===q&&(q=f.length);m.closeMenu();m.openMenu(q-1)},[37]);l.KeyHandler.addCallback("TopHeader2",function(G){q===f.length-1&&(q=-1);m.closeMenu();m.openMenu(q+1)},[39]);l.KeyHandler.addCallback("TopHeader3",function(G){m.closeMenu()},[27]);l.KeyHandler.addCallback("TopHeader4",function(G,K,H){b?(G=b.getAttribute("data-index")/1,b.classList.remove("pk_act"),b=e.parentNode.getElementsByClassName("pk_opt"),b=0>G-1?
b[b.length-1]:b[G-1],b.classList.add("pk_act")):(G=e.parentNode.getElementsByClassName("pk_opt"),G[0]&&(b=G[0],b.classList.add("pk_act")))},[38]);l.KeyHandler.addCallback("TopHeader5",function(G,K,H){b?(G=b.getAttribute("data-index")/1,b.classList.remove("pk_act"),b=e.parentNode.getElementsByClassName("pk_opt"),b=b.length<=G+1?b[0]:b[G+1],b.classList.add("pk_act")):(G=e.parentNode.getElementsByClassName("pk_opt"),G[0]&&(b=G[0],b.classList.add("pk_act")))},[40]);l.KeyHandler.addCallback("TopHeader6",
function(G){b?b.click():m.closeMenu()},[13]);return!0};l.listenFor("DidReadyFire",function(){m.closeMenu()});var k=function(u){u=u.target||u.srcElement;if(e){for(var w=u,x=!1;w&&e;){if(e.parentNode==w){x=!0;break}w=w.parentNode}x&&a!==u||m.closeMenu()}else l.InteractionHandler.on=!1,A.removeEventListener("mouseup",k);a=null};p.addEventListener("mousemove",function(u){return l.InteractionHandler.check("TopHeader")?e||l.InteractionHandler.on&&"TopHeader"===l.InteractionHandler.by?(u=u.target||u.srcElement,
0<=u.className.indexOf("pk_opt")?(b&&b.classList.remove("pk_act"),b=u,b.classList.add("pk_act")):(b&&b.classList.remove("pk_act"),b=null),g(u)):!1:!1},!1);p.addEventListener("mousedown",function(u){if(!l.InteractionHandler.checkAndSet("TopHeader"))return!1;A.removeEventListener("mouseup",k);e?(a=g(u.target||u.srcElement)?null:e,A.addEventListener("mouseup",k,!1)):(a=null,A.addEventListener("mouseup",k,!1),g(u.target||u.srcElement))},!1);l.el.appendChild(p)}function h(c,l){var d=this,g=A.createElement("div");
g.className="pk_dck";c.el.appendChild(g);d.el=g;d.on=!1;d.height=130;d.Show=function(){d.on=!0;g.style.display="block";l.fireEvent("RequestResize")};d.Hide=function(){d.on=!1;g.style.display="none";l.fireEvent("RequestResize")}}function y(c,l){var d=this,g=A.createElement("div");g.className="pk_av_cont";c.el.appendChild(g);var p=A.createElement("div");p.className="pk_av pk_noselect";p.id="pk_av_"+l.id;g.appendChild(p);var q=A.createElement("div");q.className="pk_ftr pk_noselect";c.el.appendChild(q);
var e=A.createElement("div");e.className="pk_panner pk_noselect";var a=A.createElement("div");a.className="pk_pan_left";var b=A.createElement("div");b.className="pk_pan_right";var f=A.createElement("button"),m=A.createElement("button");f.setAttribute("tabIndex",-1);m.setAttribute("tabIndex",-1);f.className="pk_pan_btn";m.className="pk_pan_btn";f.innerHTML="<strong>L</strong> ON";m.innerHTML="<strong>R</strong> ON";a.appendChild(f);b.appendChild(m);e.appendChild(a);e.appendChild(b);g.appendChild(e);
f.onclick=function(){l.fireEvent("RequestChanToggle",0);this.blur()};m.onclick=function(){l.fireEvent("RequestChanToggle",1);this.blur()};l.listenFor("DidChanToggle",function(L,V){0===L?V?(f.classList.remove("pk_inact"),f.innerHTML="<strong>L</strong> ON"):(f.classList.add("pk_inact"),f.innerHTML="<strong>L</strong> OFF"):V?(m.classList.remove("pk_inact"),m.innerHTML="<strong>R</strong> ON"):(m.classList.add("pk_inact"),m.innerHTML="<strong>R</strong> OFF")});g=A.createElement("div");g.className=
"pk_zoombtn";e=A.createElement("button");e.className="pk_btn pk_zoom_in_h";e.innerHTML="+<span>Zoom In Horiz (+)</span>";e.setAttribute("tabIndex",-1);e.onclick=function(){l.fireEvent("RequestZoomUI","h",-1);this.blur()};var k=A.createElement("button");k.className="pk_btn pk_zoom_out_h pk_inact";k.innerHTML="&ndash;<span>Zoom Out Horiz (-)</span>";k.setAttribute("tabIndex",-1);k.onclick=function(){l.fireEvent("RequestZoomUI","h",1);this.blur()};var u=A.createElement("button");u.className="pk_btn pk_zoom_reset pk_inact";
u.innerHTML="[R] <span>Reset Zoom (0)</span>";u.setAttribute("tabIndex",-1);u.onclick=function(){l.fireEvent("RequestZoomUI",0);this.blur()};c.KeyHandler.addCallback("Key0",function(L){c.InteractionHandler.on||l.fireEvent("RequestZoomUI",0)},[48]);c.KeyHandler.addCallback("KeyZO",function(L){c.InteractionHandler.on||l.fireEvent("RequestZoomUI","h",1)},[189]);c.KeyHandler.addCallback("KeyZI",function(L){c.InteractionHandler.on||l.fireEvent("RequestZoomUI","h",-1)},[187]);a=A.createElement("button");
a.className="pk_btn pk_zoom_in_v";a.innerHTML="&#x2195; +<span>Zoom In Vertically</span>";a.setAttribute("tabIndex",-1);a.onclick=function(){l.fireEvent("RequestZoomUI","v",-1);this.blur()};b=A.createElement("button");b.className="pk_btn pk_zoom_out_v";b.innerHTML="&#x2195; &ndash;<span>Zoom Out Vertically</span>";b.setAttribute("tabIndex",-1);b.onclick=function(){l.fireEvent("RequestZoomUI","v",1);this.blur()};g.appendChild(e);g.appendChild(k);g.appendChild(u);g.appendChild(a);g.appendChild(b);q.appendChild(g);
g=A.createElement("div");g.className="pk_wavescroll";var w=!1,x=A.createElement("div");x.className="pk_wavepoint";var z=A.createElement("div"),C=z.style;z.className="pk_wavedrag pk_inact";var B=A.createElement("div");B.className="pk_wavedrag_l";var D=A.createElement("div");D.className="pk_wavedrag_r";g.appendChild(x);z.appendChild(B);z.appendChild(D);g.appendChild(z);q.appendChild(g);var G=0,K=100;g.onclick=function(L){if(!(20>window.performance.now()-G)){var V=L.target.getBoundingClientRect();c.fireEvent("RequestPan",
L.clientX-V.left,2)}};c.listenFor("DidZoom",function(L){var V=L[0],aa=L[1];1===V?(k.classList.add("pk_inact"),u.classList.add("pk_inact")):(k.classList.remove("pk_inact"),u.classList.remove("pk_inact"));1!=L[2]&&u.classList.remove("pk_inact");1===V?w&&(x.style.display="none",w=!1):w||(x.style.display="block",L=l.engine.wavesurfer.getCurrentTime()/l.engine.wavesurfer.getDuration(),x.style.left=(1E4*L>>0)/100+"%",w=!0);99<100/V?(K=100,C.width="100%",C.left="0%",z.classList.add("pk_inact")):(K=100/V,
C.width=K+"%",C.left=aa+"%",z.classList.remove("pk_inact"))});c.listenFor("DidCursorCenter",function(L,V){requestAnimationFrame(function(){C.left=100*L+"%"})});var H=0,P=0,Q=function(L){L.stopPropagation();L.preventDefault();var V=L.clientX;if(L.touches){if(1<L.touches.length)return;V=L.touches[0].clientX}L=-P+V;0===H?c.fireEvent("RequestPan",L,1):-1===H?c.fireEvent("RequestZoom",L,-1):1===H&&c.fireEvent("RequestZoom",L,1);P=V},X=function(L){L.touches&&1<L.touches.length||(PKAudioEditor.engine.wavesurfer.Interacting&=
-3,L.stopPropagation(),L.preventDefault(),H=0,G=window.performance.now(),z.classList.remove("pk_drag"),document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",X),document.removeEventListener("touchmove",Q,{passive:!1}),document.removeEventListener("touchend",X))},Y=function(L){PKAudioEditor.engine.is_ready&&(L.target===z?H=0:L.target===B?H=-1:L.target===D&&(H=1),z.className+=" pk_drag",P=L.clientX,PKAudioEditor.engine.wavesurfer.Interacting|=2,L.is_touch?(document.addEventListener("touchmove",
Q,{passive:!1}),document.addEventListener("touchend",X,!1)):(document.addEventListener("mousemove",Q,!1),document.addEventListener("mouseup",X,!1)))};z.addEventListener("mousedown",Y,!1);"ontouchstart"in window&&z.addEventListener("touchstart",function(L){L.preventDefault();L.stopPropagation();1<L.touches.length||Y({is_touch:!0,target:z,clientX:L.touches[0].clientX})},!1);this.volumeGauge=A.createElement("div");this.volumeGauge2=A.createElement("div");this.volumeGaugeInner=A.createElement("div");
this.volumeGaugeInner2=A.createElement("div");this.volumeGaugePeaker=A.createElement("div");this.volumeGaugePeaker2=A.createElement("div");g=A.createElement("div");this.volumeGauge.className="pk_volpar";this.volumeGauge2.className="pk_volpar";this.volumeGaugeInner.className="pk_vol";this.volumeGaugeInner2.className="pk_vol";this.volumeGaugePeaker.className="pk_peaker";this.volumeGaugePeaker2.className="pk_peaker";this.volumeGauge.appendChild(this.volumeGaugeInner);this.volumeGauge.appendChild(this.volumeGaugePeaker);
this.volumeGauge2.appendChild(this.volumeGaugeInner2);this.volumeGauge2.appendChild(this.volumeGaugePeaker2);e=A.createElement("div");e.className="pk_markers pk_noselect";a='<span class="pk_mark1">-Inf</span>';for(b=35;0<=b;--b)a+='<span class="pk_mark1 '+(b%2?"pk_odd":"")+'">'+-(2*b)+"</span>";e.innerHTML=a;g.appendChild(this.volumeGauge);g.appendChild(this.volumeGauge2);g.appendChild(e);g.onclick=function(){d.volumeGaugePeaker.className="pk_peaker";d.volumeGaugePeaker2.className="pk_peaker"};q.appendChild(g);
q=A.createElement("div");q.className="pk_tmpMsg";q.innerHTML='Drag n drop an Audio File in this window, or click <a style="white-space:nowrap;border:1px solid;border-radius:23px;padding:5px 18px;font-size:0.94em;margin-left:5px" onclick="PKAudioEditor.engine.LoadSample()">here to use a sample</a>';p.appendChild(q);p=A.createElement("div");p.className="pk_tmpMsg2";p.innerHTML='<span>Please Wait...</span><div class="pk_mload"><div></div></div><div class="pk_prc"><span>0%</span><button tabIndex="-1" class="pk_btn" onclick="PKAudioEditor.fireEvent(\'RequestCancelModal\');">cancel</button></div>';
A.body.appendChild(p);c.loaderEl=p;c.listenFor("WillDownloadFile",function(){c.loaderEl.classList.add("pk_act");c.loaderEl.getElementsByTagName("span")[1].style.display="none"});c.listenFor("DidDownloadFile",function(){c.loaderEl.classList.remove("pk_act")});c.listenFor("DidProgressModal",function(L){c.loaderEl.getElementsByTagName("span")[1].style.display="block";c.loaderEl.getElementsByTagName("span")[1].textContent=L+"%"})}function t(c){function l(I){var N=I>>0,O=I-N;if(10>N){if(0===I)return"00:00:000";
N="00:0"+N}else 60>N?N="00:"+N:(I=N/60>>0,N%=60,N=(10>I?"0":"")+I+":"+(10>N?"0"+N:N));return.1>O?N+":0"+(.01>O?"0":"")+(1E3*O>>0):N+":"+(1E3*O>>0)}var d=A.createElement("div");d.className="pk_tbc";var g=A.createElement("div");g.className="pk_tb pk_noselect";var p=A.createElement("div");p.className="pk_btngroup";var q=A.createElement("div");q.className="pk_transport";var e=A.createElement("button");e.setAttribute("tabIndex",-1);e.innerHTML="<span>Stop Playback (Space)</span>";e.className="pk_btn pk_stop icon-stop2";
e.onclick=function(){c.fireEvent("RequestStop")};q.appendChild(e);var a=A.createElement("button");a.setAttribute("tabIndex",-1);a.className="pk_btn pk_play icon-play3";a.innerHTML="<span>Play (Space)</span>";q.appendChild(a);a.onclick=function(){c.fireEvent("RequestPlay");this.blur()};c.listenFor("DidStopPlay",function(){a.classList.remove("pk_act")});c.listenFor("DidPlay",function(){a.classList.add("pk_act")});e=A.createElement("button");e.setAttribute("tabIndex",-1);e.className="pk_btn pk_pause icon-pause2";
e.innerHTML="<span>Pause (Shift+Space)</span>";q.appendChild(e);e.onclick=function(){c.fireEvent("RequestPause");this.blur()};var b=A.createElement("button");b.setAttribute("tabIndex",-1);b.className="pk_btn pk_loop icon-loop";b.innerHTML="<span>Toggle Loop (L)</span>";q.appendChild(b);b.onclick=function(){c.fireEvent("RequestSetLoop");this.blur()};c.listenFor("DidSetLoop",function(I){I?b.classList.add("pk_act"):b.classList.remove("pk_act")});e=A.createElement("button");e.setAttribute("tabIndex",
-1);e.className="pk_btn pk_back_jump icon-backward2";e.innerHTML="<span>Seek (left arrow)</span>";q.appendChild(e);var f=!1,m=null;e.onclick=function(){if(!f){m&&(clearTimeout(m),m=null);var I=PKAudioEditor.engine.wavesurfer.getDuration()/20;I/=PKAudioEditor.engine.wavesurfer.ZoomFactor/2+.5;1<I&&(I<<=0);c.fireEvent("RequestSkipBack",I)}this.blur();f=!1};e.onmouseleave=function(){m&&(clearTimeout(m),m=null);this.blur()};e.onfocus=function(){var I=this;f=!1;var N=function(O,R){if(document.activeElement===
I){f=!0;c.fireEvent("RequestSkipBack",O);var W=PKAudioEditor.engine.wavesurfer.getDuration()/4450;W/=PKAudioEditor.engine.wavesurfer.ZoomFactor;12>R&&(W=0);setTimeout(function(){N(O+W,++R)},40)}};m=setTimeout(function(){var O=PKAudioEditor.engine.wavesurfer.getDuration()/2E3;O/=PKAudioEditor.engine.wavesurfer.ZoomFactor;.01>O&&(O=.01);N(O,0)},390)};e=A.createElement("button");e.setAttribute("tabIndex",-1);e.className="pk_btn pk_front_jump icon-forward3";e.innerHTML="<span>Seek (right arrow)</span>";
q.appendChild(e);var k=!1,u=null;e.onclick=function(){if(!k){u&&(clearTimeout(u),u=null);var I=PKAudioEditor.engine.wavesurfer.getDuration()/20;I/=PKAudioEditor.engine.wavesurfer.ZoomFactor/2+.5;1<I&&(I<<=0);c.fireEvent("RequestSkipFront",I)}this.blur();k=!1};e.onmouseleave=function(){u&&(clearTimeout(u),u=null);this.blur()};e.onfocus=function(){var I=this;k=!1;var N=function(O,R){if(document.activeElement===I){k=!0;c.fireEvent("RequestSkipFront",O);var W=PKAudioEditor.engine.wavesurfer.getDuration()/
4450;W/=PKAudioEditor.engine.wavesurfer.ZoomFactor;12>R&&(W=0);setTimeout(function(){N(O+W,++R)},40)}};u=setTimeout(function(){var O=PKAudioEditor.engine.wavesurfer.getDuration()/2E3;O/=PKAudioEditor.engine.wavesurfer.ZoomFactor;.01>O&&(O=.01);N(O,0)},390)};var w=0,x=1,z=4;c.KeyHandler.addCallback("KeyArrowBack",function(I,N,O){!c.InteractionHandler.on&&PKAudioEditor.engine.is_ready&&(I=O.timeStamp,158<I-w?(x=1,z=4):0>--z&&6>x&&(x+=.05),w=I,I=PKAudioEditor.engine.wavesurfer.ZoomFactor,N=PKAudioEditor.engine.wavesurfer.getDuration(),
N=Math.max(N/200,.05),N=N/I*x,c.fireEvent("RequestSkipBack",N))},[37]);var C=0,B=1,D=4;c.KeyHandler.addCallback("KeyArrowFront",function(I,N,O){!c.InteractionHandler.on&&PKAudioEditor.engine.is_ready&&(I=O.timeStamp,158<I-C?(B=1,D=4):0>--D&&6>B&&(B+=.05),C=I,I=PKAudioEditor.engine.wavesurfer.ZoomFactor,N=PKAudioEditor.engine.wavesurfer.getDuration(),N=Math.max(N/200,.05),N=N/I*B,c.fireEvent("RequestSkipFront",N))},[39]);c.KeyHandler.addCallback("KeyShiftArrowBack",function(I){if(!c.InteractionHandler.on&&
PKAudioEditor.engine.is_ready){if(I=PKAudioEditor.engine.wavesurfer.regions.list[0]){var N=PKAudioEditor.engine.wavesurfer.ActiveMarker,O=PKAudioEditor.engine.wavesurfer.getDuration(),R=I.end/O;if(N>R+.004){c.fireEvent("RequestSeekTo",R-1E-4);return}R=I.start/O;if(N>R+.004){c.fireEvent("RequestSeekTo",R);return}}c.fireEvent("RequestSeekTo",0)}},[16,37]);c.KeyHandler.addCallback("KeyShiftArrowFront",function(I){if(!c.InteractionHandler.on&&PKAudioEditor.engine.is_ready){if(I=PKAudioEditor.engine.wavesurfer.regions.list[0]){var N=
PKAudioEditor.engine.wavesurfer.ActiveMarker,O=PKAudioEditor.engine.wavesurfer.getDuration(),R=I.start/O;if(N<R-.004){c.fireEvent("RequestSeekTo",R);return}R=I.end/O;if(N<R-.004){c.fireEvent("RequestSeekTo",R-1E-4);return}}c.fireEvent("RequestSeekTo",.994)}},[16,39]);c.KeyHandler.addCallback("killctx",function(I){I=new Event("killCTX",{bubbles:!0});document.body.dispatchEvent(I)},[27]);e=A.createElement("button");e.setAttribute("tabIndex",-1);e.className="pk_btn icon-previous2";e.innerHTML="<span>Seek Start (Shift + left arrow)</span>";
q.appendChild(e);e.onclick=function(){c.fireEvent("RequestRegionClear");c.fireEvent("RequestSeekTo",0);this.blur()};e=A.createElement("button");e.setAttribute("tabIndex",-1);e.className="pk_btn icon-next2";e.innerHTML="<span>Seek End (Shift + right arrow)</span>";e.onclick=function(){c.fireEvent("RequestRegionClear");c.fireEvent("RequestSeekTo",.996);this.blur()};q.appendChild(e);var G=A.createElement("button");G.setAttribute("tabIndex",-1);G.className="pk_btn icon-rec";G.innerHTML="<span>Record (R)</span>";
G.onclick=function(){"disabled"!==this.getAttribute("disabled")&&c.fireEvent("RequestActionRecordToggle");this.blur()};c.listenFor("ErrorRec",function(){G.style.opacity=.6;G.setAttribute("disabled","disabled")});q.appendChild(G);c.KeyHandler.addCallback("KeyRecR",function(I){c.InteractionHandler.on||G.click()},[82]);c.listenFor("DidActionRecordStart",function(){G.classList.add("pk_act")});c.listenFor("DidActionRecordStop",function(){G.classList.remove("pk_act")});c.KeyHandler.addCallback("KeyTab",
function(I){!c.InteractionHandler.on&&PKAudioEditor.engine.is_ready&&c.fireEvent("RequestViewCenterToCursor")},[9]);var K=!!window.chrome;e=A.createElement("div");e.className="pk_timecontainer";var H=A.createElement("span");K||(H.textContent="00:00:000",H.className="pk_timing",e.appendChild(H));var P=A.createElement("canvas");P.className="pk_timingcnv";P.width=150;P.height=40;var Q="00:00:000",X=P.getContext("2d",{alpha:!1}),Y={};if(K){e.appendChild(P);X.fillStyle="#000";X.fillRect(0,0,150,40);for(P=
0;11>P;++P){var L=A.createElement("canvas");L.width=18;L.height=26;var V=L.getContext("2d",{alpha:!1});V.font="29px Helvetica, Arial, sans-serif";V.textAlign="center";V.fillStyle="#000";V.fillRect(0,0,18,26);V.fillStyle="#fff";V.textBaseline="middle";10===P?(V.fillText(":",8,14),Y[":"]=L):(V.fillText(P+"",9,14),Y[P+""]=L)}(function(I,N){for(var O=0;9>O;++O)I.drawImage(N["00:00:000"[O]],16*O,10)})(X,Y)}var aa=A.createElement("span");aa.textContent="00:00:000";aa.className="pk_total_dur";e.appendChild(aa);
var ba=A.createElement("span");ba.textContent="00:00:000";ba.className="pk_hover_dur";e.appendChild(ba);setTimeout(function(){c.listenFor("DidZoom",function(R,W){W&&(ba.textContent=l(PKAudioEditor.engine.wavesurfer.drawer.handleEvent(W)*PKAudioEditor.engine.wavesurfer.VisibleDuration+PKAudioEditor.engine.wavesurfer.LeftProgress))});var I=0,N=A.getElementsByClassName("pk_av")[0];N.addEventListener("mousemove",function(R){var W=R.timeStamp;58>W-I||(I=W,ba.textContent=l(PKAudioEditor.engine.wavesurfer.drawer.handleEvent(R)*
PKAudioEditor.engine.wavesurfer.VisibleDuration+PKAudioEditor.engine.wavesurfer.LeftProgress))},!1);N=PKAudioEditor._deps.ContextMenu(N);N.addOption("Select Visible View",function(R,W,ca){c.fireEvent("RequestRegionSet")},!1);N.addOption("Reset Zoom",function(R){c.fireEvent("RequestZoomUI",0)},!1);N.addOption("Set Volume/Gain",function(R){c.fireEvent("RequestFXUI_Gain")},!1);N.addOption("Copy",function(R){PKAudioEditor.engine.wavesurfer.regions.list[0]&&c.fireEvent("RequestActionCopy")},!1);N.addOption("Paste",
function(R){O&&c.fireEvent("RequestActionPaste")},!1);N.addOption("Cut",function(R){PKAudioEditor.engine.wavesurfer.regions.list[0]&&c.fireEvent("RequestActionCut")},!1);N.addOption("Insert Silence",function(R){c.fireEvent("RequestFXUI_Silence",0)},!1);var O=!1;c.listenFor("DidSetClipboard",function(R){O=R?!0:!1});N.onOpen=function(R,W){var ca=W.childNodes;O||(ca[4].className+=" pk_inact");c.fireEvent("RequestPause");PKAudioEditor.engine.wavesurfer.regions.list[0]||(ca[3].className+=" pk_inact",ca[5].className+=
" pk_inact")}},1E3);c.listenFor("DidUpdateLen",function(I){aa.textContent=l(I)});c.formatTime=l;var da=0,fa=0,ja=0,ea=document.querySelector(".pk_wavepoint");c.listenFor("DidAudioProcess",function(I){var N=I[0],O=I[1];I=I[2]||F.performance.now();if(!(50>I-ja)){ja=I;if(-1<N){if(K){I=l(N);for(var R=!1,W=0;W<I.length;++W){if(!R)if(I[W]===Q[W])continue;else R=!0;X.drawImage(Y[I[W]],16*W,10)}Q=I}else H.textContent=l(N);1<PKAudioEditor.engine.wavesurfer.ZoomFactor&&(N/=PKAudioEditor.engine.wavesurfer.getDuration(),
ea||(ea=document.querySelector(".pk_wavepoint")),ea.style.left=(1E4*N>>0)/100+"%")}O?0<O[0]?(c.footer.volumeGaugePeaker.className="pk_peaker pk_act",c.footer.volumeGaugeInner.style.transform="translate3d(100%,0,0)",da=100,c.footer.volumeGaugePeaker.setAttribute("title","Peak at "+PKAudioEditor.engine.wavesurfer.getCurrentTime().toFixed(2)),0<O[1]&&(c.footer.volumeGaugePeaker2.className="pk_peaker pk_act",c.footer.volumeGaugeInner2.style.transform="translate3d(100%,0,0)",fa=100,c.footer.volumeGaugePeaker2.setAttribute("title",
"Peak at "+PKAudioEditor.engine.wavesurfer.getCurrentTime().toFixed(2)))):0<O[1]?(c.footer.volumeGaugePeaker2.className="pk_peaker pk_act",c.footer.volumeGaugeInner2.style.transform="translate3d(100%,0,0)",fa=100,c.footer.volumeGaugePeaker2.setAttribute("title","Peak at "+PKAudioEditor.engine.wavesurfer.getCurrentTime().toFixed(2))):(N=100+O[0],-100>N?da=0:(da+=(N-da)/4,isNaN(da)&&(da=0)),N=100+O[1],-100>N?fa=0:(fa+=(N-fa)/4,isNaN(fa)&&(fa=0)),c.footer.volumeGaugeInner.style.transform="translate3d("+
da+"%,0,0)",c.footer.volumeGaugeInner2.style.transform="translate3d("+fa+"%,0,0)"):(c.footer.volumeGaugePeaker.className="pk_peaker",c.footer.volumeGaugePeaker2.className="pk_peaker",c.footer.volumeGaugeInner.style.transform="translate3d(0,0,0)",c.footer.volumeGaugeInner2.style.transform="translate3d(0,0,0)")}});P=A.createElement("div");P.className="pk_ctns";var U=A.createElement("button");U.setAttribute("tabIndex",-1);U.className="pk_btn icon-files-empty pk_inact";U.innerHTML="<span>Copy Selection (Shift + C)</span>";
P.appendChild(U);U.onclick=function(){c.fireEvent("RequestActionCopy");this.blur()};c.listenFor("DidSetClipboard",function(I){I?M.classList.remove("pk_inact"):M.classList.add("pk_inact")});var M=A.createElement("button");M.setAttribute("focusable","false");M.className="pk_btn icon-file-text2 pk_inact";M.innerHTML="<span>Paste Selection (Shift + V)</span>";P.appendChild(M);M.onclick=function(){c.fireEvent("RequestActionPaste");this.blur()};var S=A.createElement("button");S.setAttribute("tabIndex",
-1);S.className="pk_btn icon-scissors pk_inact";S.innerHTML="<span>Cut Selection (Shift + X)</span>";P.appendChild(S);S.onclick=function(){c.fireEvent("RequestActionCut");this.blur()};var J=A.createElement("button");J.setAttribute("tabIndex",-1);J.className="pk_btn icon-silence";J.innerHTML="<span>Insert Silence (Shift + N)</span>";P.appendChild(J);c.KeyHandler.addCallback("KeyShiftN",function(I){c.InteractionHandler.on||J.click()},[16,78]);J.onclick=function(){c.fireEvent("RequestFXUI_Silence");
this.blur()};L=A.createElement("div");L.className="pk_selection";L.innerHTML='<div class="pk_sellist"><span class="pk_title">Selection:</span><div><span class="title">Start:</span><span class="s_s pk_dat">-</span></div><div><span class="title">End:</span><span class="s_e pk_dat">-</span></div><div><span  class="title">Duration:</span><span class="s_d pk_dat">-</span></div></div>';var T=A.createElement("button");T.setAttribute("tabIndex",-1);T.className="pk_btn icon-clearsel pk_inact";T.innerHTML=
"<span>Clear Selection (Q key)</span>";var Z=L.getElementsByClassName("pk_dat");c.listenFor("DidCreateRegion",function(I){U.classList.remove("pk_inact");S.classList.remove("pk_inact");T.classList.remove("pk_inact");I&&(Z[0]||(Z=document.querySelectorAll(".pk_sellist .pk_dat")),Z[0].textContent=I.start.toFixed(3),Z[1].textContent=I.end.toFixed(3),Z[2].textContent=(I.end-I.start).toFixed(3))});c.listenFor("DidDestroyRegion",function(){U.classList.add("pk_inact");S.classList.add("pk_inact");T.classList.add("pk_inact");
Z[0]||(Z=document.querySelectorAll(".pk_sellist .pk_dat"));Z[0].textContent="-";Z[1].textContent="-";Z[2].textContent="-"});T.onclick=function(){c.fireEvent("RequestRegionClear");this.blur()};L.appendChild(T);g.appendChild(e);c.listenFor("DidChanToggle",function(I,N){var O=PKAudioEditor.engine.wavesurfer.regions.list[0];O&&(1===N?(O.element.style.top="0",O.element.style.height="100%"):0===I?(O.element.style.top="50%",O.element.style.height="50%"):1===I&&(O.element.style.top="0",O.element.style.height=
"50%"))});g.appendChild(p);p.appendChild(q);p.appendChild(P);g.appendChild(L);d.appendChild(g);c.el.appendChild(d);dragNDrop(A.getElementById("app"),"pk_overlay",function(I){PKAudioEditor.engine.LoadArrayBuffer(new Blob([I]))},"arrayBuffer")}function v(c){var l=-1,d=-1,g=!1;A.body.addEventListener("touchstart",function(p){l=p.touches[0].pageX;d=p.touches[0].pageY;g=!1});A.body.addEventListener("touchend",function(p){d=l=-1;g=!1});A.body.addEventListener("touchmove",function(p){if("INPUT"!==p.target.tagName&&
!g){var q=p.touches[0].pageY,e=p.touches[0].pageX,a=d-q,b=l-e;if(0===a||3>Math.abs(a)&&3<Math.abs(b)||6>Math.abs(a)&&10<Math.abs(b))d=q,l=e,g=!0;else if(d=q,l=e,q=document.getElementsByClassName("pk_modal_back"),q[0])q=q[0],q.scrollHeight>window.innerHeight?(q=q.scrollTop,0<a?document.getElementsByClassName("pk_modal")[0].clientHeight-q<window.innerHeight-80&&p.preventDefault():0>=q&&p.preventDefault()):p.preventDefault(),g=!0;else{a=window.screen.height;q=window.screen.width;e=window.innerHeight;
b=!1;var f=0;if(0===window.orientation)f=e/a;else if(90===window.orientation||-90===window.orientation)f=e/q;.8>f&&(b=!0);b||(p.preventDefault(),g=!0)}}},{passive:!1})}E._deps.ui=function(c){var l=this;this.el=c.el;this.el.className+=" pk_app"+(c.isMobile?" pk_mob":"");this.fireEvent=c.fireEvent;this.listenFor=c.listenFor;this.InteractionHandler={on:!1,by:null,arr:[],check:function(g){return this.on&&this.by!==g?!1:!0},checkAndSet:function(g){if(!this.check(g))return!1;this.on=!0;this.by=g;return!0},
forceSet:function(g){this.on&&this.arr.push({on:this.on,by:this.by});this.on=!0;this.by=g},forceUnset:function(g){this.check(g)&&((g=this.arr.pop())?(this.on=g.on,this.by=g.by):(this.on=!1,this.by=null))}};if(c.isMobile){A.body.className="pk_stndln";var d=A.createElement("div");d.className="pk_fxd";d.appendChild(this.el);A.body.appendChild(d);v(this)}this.KeyHandler=new c._deps.keyhandler(this);this.TopHeader=new n(r(c),this);this.Toolbar=new t(this);this.footer=new y(this,c);this.BarBtm=new h(this,
c);this.Dock=function(g,p,q){c.fireEvent(g,p,q)};c.listenFor("ShowError",function(g){(new PKSimpleModal({title:"Oops! Something is not right",clss:"pk_modal_anim",ondestroy:function(p){c.ui.InteractionHandler.on=!1;c.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[],body:"<p>"+g+"</p>",setup:function(p){c.fireEvent("RequestPause");c.fireEvent("RequestRegionClear");c.ui.InteractionHandler.checkAndSet("modal");c.ui.KeyHandler.addCallback("modalTempErr",function(q){p.Destroy()},[27])}})).Show()});
c.listenFor("RequestKeyDown",function(g){l.KeyHandler.keyDown(g,null);l.KeyHandler.keyUp(g)})}})(window,document,PKAudioEditor);
(function(F,A){function E(n){var h=this;this.id=n.id?n.id:++r;var y=A.createElement("div");this.els={toolbar:[],bottom:[]};y.className="pk_modal "+(n.clss?n.clss:"");h.el=y;var t=A.createElement("div");t.className="pk_modal_back";this.el_back=t;t=A.createElement("div");t.className="pk_modal_cnt";this.el_cont=t;t=A.createElement("div");t.className="pk_noselect pk_modal_title";t.innerHTML="<span>"+(n.title||"")+"</span>";y.appendChild(t);this.el_title=t;var v=A.createElement("div");v.className="pk_modal_main";
y.appendChild(v);this.el_body=v;v=A.createElement("div");v.className="pk_noselect pk_modal_bottom";var c=A.createElement("a");c.innerHTML="CANCEL";c.className="pk_modal_cancel pk_modal_a_bottom";c.onclick=function(){h.Destroy()};v.appendChild(c);if(n.buttons&&0<n.buttons.length)for(c=0;c<n.buttons.length;++c){var l=n.buttons[c];if(l.title&&l.callback){var d=A.createElement("a");d.innerHTML=l.title;d.className="pk_modal_a_bottom "+(l.clss?l.clss:"");l.callback&&function(p){d.onclick=function(){p(h)}}(l.callback);
h.els.bottom.push(d);v.appendChild(d)}}y.appendChild(v);if(n.toolbar&&0<n.toolbar.length)for(c=0;c<n.toolbar.length;++c)if(l=n.toolbar[c],l.title&&l.callback){var g=A.createElement("a");g.innerHTML=l.title;g.className="pk_modal_a_top "+(l.clss?l.clss:"");t.appendChild(g);l.callback&&function(p){g.onclick=function(){p(h,this)}}(l.callback);h.els.toolbar.push(g)}this.ondestroy=n.ondestroy;n.body&&(h.el_body.innerHTML=n.body);n.onpreset&&(this.onpreset=n.onpreset);n.setup&&n.setup(this)}var r=0;E.prototype.Show=
function(){this.el_back.appendChild(this.el_cont);this.el_cont.appendChild(this.el);A.body.appendChild(this.el_back);return this};E.prototype.Destroy=function(){this.ondestroy&&(this.ondestroy(this),this.ondestroy=null);this.els=null;A.body.removeChild(this.el_back)};F.PKSimpleModal=E;F.PKAudioFXModal=function(n,h){var y=null;n.preview&&(y=[{title:"ON",clss:"pk_inact",callback:function(t,v){h.fireEvent("RequestActionFX_TOGGLE")}},{title:"Preview",callback:function(t){n.preview&&n.preview(t)}}]);return new E({id:n.id,
title:n.title,clss:n.clss,presets:n.presets,updateFilter:n.updateFilter,ondestroy:function(t){h.fireEvent("DidCloseFX_UI");h.stopListeningFor("DidStartPreview",t._evstart);h.stopListeningFor("DidStopPreview",t._evstop);h.stopListeningFor("DidTogglePreview",t._evtoggle);h.stopListeningFor("DidSetPresets",t._updatePresets);h.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview);h.stopListeningFor("RequestSetPresetActive",t._updpreset);h.fireEvent("RequestActionFX_PREVIEW_STOP");h.ui.KeyHandler.removeCallback("ksp"+
t.id);n.ondestroy&&n.ondestroy(t)},toolbar:y,buttons:n.buttons,body:n.body,onpreset:n.onpreset,setup:function(t){h.fireEvent("RequestActionFX_TOGGLE",1);var v=this;h.ui.KeyHandler.addCallback("ksp"+t.id,function(c,l){if(h.ui.InteractionHandler.check("modalfx")){var d=v.toolbar;if(d&&0<d.length)for(var g=d.length;0<g--;)if("Preview"===d[g].title){d[g].callback(t);break}}},[32]);t._evstart=function(){t.els.toolbar[0].classList.remove("pk_inact");t.els.toolbar[1].classList.add("pk_act")};t._evstop=function(){t.els.toolbar[0].classList.add("pk_inact");
t.els.toolbar[1].classList.remove("pk_act")};t._evtoggle=function(c){t.els.toolbar[0].innerHTML=c?"ON":"OFF"};t._updpreview=function(c){var l=t.el_presets.options[t.el_presets.selectedIndex],d=t.el.getElementsByClassName("pk_sel_edt")[0];"t"===c?l&&l.getAttribute("data-custom")?(d.style.visibility="visible",d.style.opacity="1",h.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview)):(d.style.visibility="hidden",d.style.opacity="0",h.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview),
setTimeout(function(){h.listenFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview)},100)):(d.style.visibility="visible",d.style.opacity="1",h.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview))};t._updpreset=function(c,l){if(!c||c===t.id)for(var d=t.el_presets.getElementsByTagName("option"),g=d.length,p;0<g--;)if(p=d[g],p.getAttribute("data-custom")===l){p.selected="selected";break}};t._updatePresets=function(c,l){if(!c||c===t.id){var d=document,g=t.el.getElementsByClassName("pk_sel");
if(0<g.length){g=g[0];for(var p=g.getElementsByTagName("option"),q=p.length,e=null;0<q--;)e=p[q],e.getAttribute("data-custom")&&g.removeChild(e);if(0!==l.length)for(p=d.createElement("option"),p.setAttribute("disabled","1"),p.setAttribute("data-custom","1"),p.innerHTML="----custom-----",g.appendChild(p),q=0;q<l.length;++q)p=d.createElement("option"),e=l[q],p.value=e.val,p.setAttribute("data-custom",e.id),p.innerHTML=e.name,g.appendChild(p)}else if(g=d.createElement("select"),g.className="pk_sel",
0!==l.length){for(q=-1;q<l.length;++q)p=d.createElement("option"),-1===q?(p.value="null",p.innerHTML="Presets"):(e=l[q],p.value=e.val,p.innerHTML=e.name),g.appendChild(p);g.onchange=function(){var a=this.value.split(","),b=t.el.getElementsByTagName("input");t._updpreview("t");if(t.onpreset)t.onpreset(this.value);else for(var f=b.length,m=0;m<f&&a[m];++m){var k=a[m].trim(),u=b[m];"null"!==k&&("checkbox"===u.type||"radio"===u.type?u.checked=k:(u.value=k,u.oninput&&u.oninput.apply(u)))}};e=t.el.getElementsByClassName("pk_modal_bottom")[0];
e.appendChild(g);t.el_presets=g;d=d.createElement("a");d.className="pk_sel_edt";d.innerHTML="...<span>Save or Modify preset</span>";d.onclick=function(){h.fireEvent("RequestSavePreset")};e.appendChild(d);h.listenFor("RequestActionFX_UPDATE_PREVIEW",t._updpreview);h.listenFor("RequestSetPresetActive",t._updpreset)}}};h.listenFor("DidStartPreview",t._evstart);h.listenFor("DidStopPreview",t._evstop);h.listenFor("DidTogglePreview",t._evtoggle);h.fireEvent("DidOpenFX_UI",t);n.updateFilter&&(t.updateFilter=
n.updateFilter);n.presets&&(t._updatePresets(null,n.presets),n.custom_pres&&t._updatePresets(null,n.custom_pres),h.listenFor("DidSetPresets",t._updatePresets));n.setup&&n.setup(t)}})}})(window,document);
(function(F){F._deps.state=function(A,E){A||(A=1);var r=this,n=1,h=E.fireEvent,y=E.listenFor,t=[],v=[];r.getLastUndoState=function(){return t[t.length-1]};r.pushUndoState=function(c){if(!c)return!1;c.id||(c.id=++n);t.length>=A&&t.shift();0<t.length&&t[t.length-1].id!==c.id-1&&(t=[]);0<v.length&&v[0].id!==c.id+1&&(v=[]);t.push(c);h("StatePush",t.length);h("DidStateChange",t,v);return!0};r.popUndoState=function(){var c=t.pop();if(c){0<v.length&&v[0].id!==c.id+1&&(v=[]);var l=E.engine.wavesurfer.backend.buffer;
h("StateDidPop",c,1);c.data=l;v.unshift(c);h("DidStateChange",t,v)}return c};r.shiftRedoState=function(){var c=v.shift();if(c){0<t.length&&t[t.length-1].id!==c.id-1&&(t=[]);var l=E.engine.wavesurfer.backend.buffer;h("StateDidPop",c,0);c.data=l;t.push(c);h("DidStateChange",t,v)}return c};r.clearAllState=function(){t=[];v=[];h("StateClearAll");h("DidStateChange",[],[])};y("StateRequestPush",function(c){r.pushUndoState(c)});y("StateRequestUndo",function(){r.popUndoState()});y("StateRequestRedo",function(){r.shiftRedoState()});
y("StateRequestClearAll",function(){r.clearAllState()});y("StateRequestLastState",function(){h("StateDidLastState",r.getLastUndoState())})}})(PKAudioEditor);
(function(F,A,E){E._deps.engine=function(r){var n=this,h=WaveSurfer.create({container:"#pk_av_"+r.id,scrollParent:!1,hideScrollbar:!0,partialRender:!1,fillParent:!1,pixelRatio:1,progressColor:"rgba(128,85,85,0.24)",splitChannels:!0,autoCenter:!0,height:F.innerHeight-168,plugins:[WaveSurfer.regions.create({dragSelection:{slop:5}})]});this.wavesurfer=h;var y=new r._deps.audioutils(r,h);n.is_ready=!1;this.TrimTo=function(a,b){var f={0:1,1:10,2:100,3:1E3,4:1E4,5:1E5}[b];return(a*f>>0)/f};this.LoadArrayBuffer=
function(a){var b=function(){r.listenFor("RequestCancelModal",function(){h.cancelBufferLoad();h.arraybuffer&&(n.is_ready=!0);r.fireEvent("RequestResize");setTimeout(function(){r.fireEvent("DidDownloadFile")},12);r.stopListeningForName("RequestCancelModal");OneUp("Canceled Loading",1350)});r.fireEvent("RequestZoomUI",0);r.fireEvent("WillDownloadFile");n.is_ready=!1;h.loadBlob(a);r.fireEvent("DidUnloadFile")};n.is_ready?(new PKSimpleModal({title:"Open or append",clss:"pk_modal_anim pk_fnt10",ondestroy:function(f){r.ui.InteractionHandler.on=
!1;r.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[{title:"OPEN NEW",callback:function(f){h.backend._add=0;b();f.Destroy()}},{title:"ADD IN EXISTING",callback:function(f){h.backend._add=1;b();f.Destroy()}}],body:"<p>Append file to existing track?</p>",setup:function(f){r.ui.InteractionHandler.checkAndSet("modal");r.ui.KeyHandler.addCallback("modalTempErr",function(m){f.Destroy()},[27])}})).Show():(h.backend._add=0,b())};this.LoadDB=function(a){for(var b=h.backend.ac.createBuffer(a.data.length,
a.data[0].byteLength/4,a.samplerate),f=0;f<a.data.length;++f){var m=new Float32Array(a.data[f]);b.copyToChannel?b.copyToChannel(m,f,0):b.getChannelData(f).set(m)}a=h.backend._add;f=h.getDuration();PKAudioEditor.engine.wavesurfer.loadDecodedBuffer(b);l();b=h.getDuration();r.fireEvent("DidUpdateLen",b);a?(h.regions.clear(),h.regions.add({start:f,end:b,id:"t"})):r.fireEvent("RequestSeekTo",0)};this.LoadFile=function(a){if(0<a.files.length&&("audio/mp3"==a.files[0].type||"audio/wave"==a.files[0].type||
"audio/mpeg"==a.files[0].type||"audio/aiff"==a.files[0].type||"audio/flac"==a.files[0].type||"audio/ogg"==a.files[0].type)){var b=function(){r.listenFor("RequestCancelModal",function(){h.cancelBufferLoad();y.DownloadFileCancel();h.arraybuffer&&(n.is_ready=!0);r.fireEvent("RequestResize");setTimeout(function(){r.fireEvent("DidDownloadFile")},12);r.stopListeningForName("RequestCancelModal");OneUp("Canceled Loading",1350)});r.fireEvent("WillDownloadFile");n.is_ready=!1;h.loadBlob(a.files[0]);r.fireEvent("DidUnloadFile")};
n.is_ready?(new PKSimpleModal({title:"Open or append",clss:"pk_modal_anim pk_fnt10",ondestroy:function(f){r.ui.InteractionHandler.on=!1;r.ui.KeyHandler.removeCallback("modalTempErr")},buttons:[{title:"OPEN NEW",callback:function(f){h.backend._add=0;b();f.Destroy()}},{title:"ADD IN EXISTING",callback:function(f){h.backend._add=1;b();f.Destroy()}}],body:"<p>Append file to existing track?</p>",setup:function(f){r.ui.InteractionHandler.checkAndSet("modal");r.ui.KeyHandler.addCallback("modalTempErr",function(m){f.Destroy()},
[27])}})).Show():(h.backend._add=0,b())}};this.DownloadFile=function(a,b,f,m,k){n.is_ready&&(r.fireEvent("WillDownloadFile"),r.listenFor("RequestCancelModal",function(){y.DownloadFileCancel();h.arraybuffer&&(n.is_ready=!0);r.fireEvent("RequestResize");setTimeout(function(){r.fireEvent("DidDownloadFile")},12);r.stopListeningForName("RequestCancelModal")}),setTimeout(function(){y.DownloadFile(a,b,f,m,k,function(u){"done"===u?(setTimeout(function(){r.fireEvent("DidDownloadFile")},12),r.stopListeningForName("RequestCancelModal")):
r.fireEvent("DidProgressModal",u)})},220))};this.LoadSample=function(){r.fireEvent("WillDownloadFile");setTimeout(function(){r.listenFor("RequestCancelModal",function(){h.cancelAjax()&&(h.arraybuffer&&(n.is_ready=!0),r.fireEvent("RequestResize"),setTimeout(function(){r.fireEvent("DidDownloadFile")},12),r.stopListeningForName("RequestCancelModal"),OneUp("Canceled Loading",1380))});r.fireEvent("RequestZoomUI",0);n.is_ready=!1;h.load("test.mp3")},180)};this.LoadURL=function(a){r.fireEvent("WillDownloadFile");
setTimeout(function(){r.listenFor("RequestCancelModal",function(){h.cancelAjax()&&(h.arraybuffer&&(n.is_ready=!0),r.fireEvent("RequestResize"),setTimeout(function(){r.fireEvent("DidDownloadFile")},12),r.stopListeningForName("RequestCancelModal"),OneUp("Canceled Loading",1350))});h.load(a);n.is_ready=!1},180)};r.listenFor("RequestResize",function(){h.fireEvent("resize");var a=window.innerHeight,b=0;r.ui&&r.ui.BarBtm&&(b=r.ui.BarBtm.on?r.ui.BarBtm.height:0);h.setHeight((280>a?280:a)-168-b)});h.on("ready",
function(){r.fireEvent("DidReadyFire");h.backend._add&&(h.backend._add=0);if(!n.is_ready){n.is_ready=!0;var a=document.getElementsByClassName("pk_tmpMsg");0<a.length&&(a=a[0],a.parentNode.removeChild(a));v=null;r.fireEvent("DidDownloadFile");r.fireEvent("StateRequestClearAll");r.fireEvent("DidLoadFile");r.fireEvent("DidUpdateLen",h.getDuration());r.fireEvent("DidSetClipboard",0);r.fireEvent("RequestSeekTo",0);r.fireEvent("RequestResize");h.getWaveEl().style.opacity="1";r.stopListeningForName("RequestCancelModal");
setTimeout(function(){OneUp("Loaded Successfully")},180);1===h.backend.buffer.numberOfChannels?(h.backend.SetNumberOfChannels(1),h.ActiveChannels=[1],h.drawer.params.ActiveChannels=h.ActiveChannels,h.SelectedChannelsLen=1,r.el.classList.add("pk_mono")):2===h.backend.buffer.numberOfChannels&&(h.backend.SetNumberOfChannels(2),h.ActiveChannels=[1,1],h.drawer.params.ActiveChannels=h.ActiveChannels,h.SelectedChannelsLen=2,r.el.classList.remove("pk_mono"))}});h.on("pause",function(){r.fireEvent("DidStopPlay")});
h.on("play",function(){r.fireEvent("DidPlay")});h.on("seek",function(a,b){var f=h.getCurrentTime(),m=h.getLoudness();r.fireEvent("DidAudioProcess",[f,m,b])});r.listenFor("RequestStop",function(a){if(r.rec.isActive())return r.fireEvent("RequestActionRecordStop"),!1;var b=h.regions.list[0];b&&(h.ActiveMarker=b.start/h.getDuration());h.stop(a)});r.listenFor("RequestPlay",function(a){r.fireEvent("RequestActionRecordStop");!a&&h.isPlaying()&&h.stop();h.play()});r.listenFor("RequestPause",function(){r.fireEvent("RequestActionRecordStop");
h.pause()});r.listenFor("RequestSetLoop",function(){if(n.is_ready){var a=!1;h.regions.list[0]?h.regions.list[0].loop=h.regions.list[0].loop?!1:!0:(a=!0,h.regions.add({start:.01,end:h.getDuration()-.01,id:"t"}),h.regions.list[0].loop=!0);var b=h.regions.list[0].loop;r.fireEvent("DidSetLoop",b);b&&!a&&r.fireEvent("RequestSeekTo",h.regions.list[0].start/h.getDuration())}});r.listenFor("RequestSkipBack",function(a){h.skipBackward(a)});r.listenFor("RequestSkipFront",function(a){h.skipForward(a)});r.listenFor("RequestSeekTo",
function(a){1<a||h.seekTo(a)});r.ui.KeyHandler.addCallback("zkA",function(a,b,f){f.preventDefault()},[38]);r.ui.KeyHandler.addCallback("zkD",function(a,b,f){f.preventDefault()},[40]);r.ui.KeyHandler.addSingleCallback("KeyPlayPause",function(a){r.ui.InteractionHandler.on||a.preventDefault()},32);r.ui.KeyHandler.addSingleCallback("KeyTilda",function(a){r.ui.TopHeader.getOpenElement()?(r.ui.TopHeader.closeMenu(),a.preventDefault()):r.ui.InteractionHandler.on||(a.preventDefault(),r.ui.TopHeader.openMenu(-1))},
96);r.ui.KeyHandler.addSingleCallback("KeyQ",function(a){r.ui.InteractionHandler.on||(a.preventDefault(),r.fireEvent("RequestDeselect"))},113);r.ui.KeyHandler.addCallback("kF12",function(a,b,f){f.preventDefault();f.stopPropagation()},[123]);r.ui.KeyHandler.addCallback("KeyShiftSpace"+r.id,function(a){r.ui.InteractionHandler.on||h.playPause()},[16,32]);r.ui.KeyHandler.addCallback("KeySpace"+r.id,function(a,b){r.ui.InteractionHandler.on||1!==b[16]&&(PKAudioEditor.engine.wavesurfer.isPlaying()?r.fireEvent("RequestStop"):
r.fireEvent("RequestPlay"))},[32]);r.ui.KeyHandler.addCallback("KeyShiftCopy"+r.id,function(a){r.ui.InteractionHandler.on||r.fireEvent("RequestActionCopy")},[16,67]);r.ui.KeyHandler.addCallback("KeyShiftUndo"+r.id,function(a){r.ui.InteractionHandler.on||r.fireEvent("StateRequestUndo")},[16,90]);r.ui.KeyHandler.addCallback("KeyShiftRedo"+r.id,function(a){r.ui.InteractionHandler.on||r.fireEvent("StateRequestRedo")},[16,89]);r.ui.KeyHandler.addCallback("KeyShiftPaste"+r.id,function(a){r.ui.InteractionHandler.on||
r.fireEvent("RequestActionPaste")},[16,86]);r.ui.KeyHandler.addCallback("KeyShiftCut"+r.id,function(a){r.ui.InteractionHandler.on||r.fireEvent("RequestActionCut")},[16,88]);r.ui.KeyHandler.addCallback("KeyShiftSelectAll"+r.id,function(a){r.ui.InteractionHandler.on||r.fireEvent("RequestSelect")},[16,65]);r.ui.KeyHandler.addSingleCallback("KeyLoopToggle",function(a){r.ui.InteractionHandler.on||(a.preventDefault(),a.stopPropagation(),r.fireEvent("RequestSetLoop"))},108);r.ui.KeyHandler.addCallback("KeyShiftSave"+
r.id,function(a){r.ui.InteractionHandler.on||document.querySelector('.pk_opt[data-id="dl"]').click()},[16,83]);h.container.addEventListener("mousedown",function(a){3===a.which&&a.preventDefault()},!1);r.listenFor("RequestSelect",function(a,b){if(n.is_ready){if(a&&h.regions.list[0])return!1;b?(h.regions.add({start:b[0],end:b[1],id:"t"}),h.isPlaying()||setTimeout(function(){r.fireEvent("RequestSeekTo",b[0]/h.getDuration())},0)):(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),h.isPlaying()||setTimeout(function(){r.fireEvent("RequestSeekTo",
0)},0))}});r.listenFor("RequestDeselect",function(){h.regions.clear();r.fireEvent("RequestSeekTo",0)});(function(){var a=null;r.listenFor("RequestLoadLocalFile",function(){h.pause();a&&(a.parentNode.removeChild(a),a.onchange=null);a=A.createElement("input");a.setAttribute("type","file");a.setAttribute("accept","audio/*");a.className="pk_inpfile";a.onchange=function(){n.LoadFile(a);a.parentNode.removeChild(a);a=a.onchange=null};r.el.appendChild(a);a.click()})})();h.container.addEventListener("dblclick",
function(a){r.fireEvent("RequestSelect",!1,[h.LeftProgress,h.LeftProgress+h.VisibleDuration])},!1);h.container.addEventListener("click",function(a){n.is_ready&&(r.ui.KeyHandler.keyMap[16]||h.regions.clear())},!1);var t=null;F.addEventListener("resize",function(){h&&(t&&clearTimeout(t),t=setTimeout(function(){r.fireEvent("RequestResize");r.isMobile&&window.scrollTo(0,200)},82))},!1);F.addEventListener("beforeunload",function(a){r.fireEvent("WillUnload")});h.on("error",function(a){setTimeout(function(){r.fireEvent("DidDownloadFile");
n.is_ready=!1},20);r.fireEvent("ShowError",a)});h.on("audioprocess",function(a,b){var f=h.getLoudness();r.fireEvent("DidAudioProcess",[a,f,b],h.backend.FreqArr)});h.on("DidZoom",function(a){r.fireEvent("DidZoom",[h.ZoomFactor,h.LeftProgress/h.getDuration()*100,h.params.verticalZoom],a)});h.on("region-removed",function(){r.fireEvent("DidSetLoop",0);r.fireEvent("DidDestroyRegion")});r.listenFor("RequestRegionClear",function(){h.regions.clear()});r.listenFor("RequestRegionSet",function(a,b){n.is_ready&&
(a||(a=h.LeftProgress/1),b||(b=(h.LeftProgress+h.VisibleDuration)/1),h.regions.clear(),h.regions.add({start:a,end:b,id:"t"}))});var v=null;this.GetCopyBuff=function(){return v};this.GetSel=function(){var a=h.regions.list[0];if(!a)return!1;var b=n.TrimTo(a.start,3);a=n.TrimTo(a.end-a.start,3);return y.Copy(b,a)};this.PlayBuff=function(a,b,f,m){if(m=m?m:new (F.AudioContext||F.webkitAudioContext)){f=m.createBuffer(b,a[0].byteLength/4,f);for(var k=0;k<b;++k)f.getChannelData(k).set(new Float32Array(a[k]));
a=m.createBufferSource();a.buffer=f;a.connect(m.destination);a.start(0);return a}};this.GetFX=function(a,b){return y.FXBank[a](b)};this.GetWave=function(a,b,f,m,k,u,w){var x=a.getChannelData(0),z=a.sampleRate,C=[];b=b||200;var B=f||80;f=B/2;m=m||0;k=((k||a.duration*z>>0)-m)/b>>0;for(a=0;a<b;++a){var D=m+k*a;var G=z=0;if(0<=D)for(var K=0;K<k;K+=3)x[D+K]>z?z=x[D+K]:x[D+K]<G&&(G=x[D+K]);C[2*a]=z;C[2*a+1]=G}u||(u=document.createElement("canvas"),u.width=b,u.height=B,w=u.getContext("2d",{alpha:!1,antialias:!1}));
w.fillStyle="#000";w.fillRect(0,0,b,B);w.fillStyle="#99c2c6";w.beginPath();w.moveTo(0,f);for(a=0;a<b;++a)x=C[2*a],x=Math.round(x*f),w.lineTo(a,f-x);for(a=b-1;0<=a;--a)x=C[2*a+1],x=Math.round(x*f),w.lineTo(a,f-x);w.closePath();w.fill();return u.toDataURL("image/jpeg",.56)};r.listenFor("RequestActionCut",function(){if(n.is_ready){var a=h.regions.list[0];if(!a)return!1;r.fireEvent("RequestPause");var b=n.TrimTo(a.start,3);a=n.TrimTo(a.end-a.start,3);r.fireEvent("StateRequestPush",{desc:"Cut",meta:[b,
a],data:h.backend.buffer});var f=y.Trim(b,a);h.regions.clear();var m=b-.03;0>m&&(m=0);r.fireEvent("RequestSeekTo",m/h.getDuration());v=f;r.fireEvent("DidSetClipboard",1);r.fireEvent("DidCut",f);OneUp("Cut :: "+n.TrimTo(b,2)+" to "+n.TrimTo(b/1+a/1,2),1100)}});r.listenFor("RequestActionCopy",function(){if(n.is_ready){var a=h.regions.list[0];if(!a)return!1;r.fireEvent("RequestPause");var b=n.TrimTo(a.start,3);a=n.TrimTo(a.end-a.start,3);v=b=y.Copy(b,a);r.fireEvent("DidSetClipboard",1);r.fireEvent("DidCopy",
b);OneUp("Copied range")}});r.listenFor("RequestActionSilence",function(a,b){if(n.is_ready){r.fireEvent("RequestPause");if(!b||0>b)b=1;r.fireEvent("StateRequestPush",{desc:"Silence",meta:[a,b],data:h.backend.buffer});var f=y.Insert(a,y.MakeSilence(b));h.regions.clear();h.regions.add({start:f[0],end:f[1],id:"t"});r.fireEvent("RequestSeekTo",f[0]/h.getDuration());OneUp("Inserted Silence")}});r.listenFor("RequestActionPaste",function(){function a(m,k){r.fireEvent("StateRequestPush",{desc:"Paste",meta:[m,
k],data:h.backend.buffer})}if(n.is_ready){if(!v)return!1;r.fireEvent("RequestPause");var b=h.regions.list[0],f=[0,0];b?(f=n.TrimTo(b.start,3),b=n.TrimTo(b.end-b.start,3),a(f,b),f=y.Replace(f,b,v)):(b=n.TrimTo(h.getCurrentTime(),3),a(b),f=y.Insert(b,v));h.regions.clear();h.regions.add({start:f[0],end:f[1],id:"t"});b=0;1E-4<h.getDuration()&&(b=f[0]/h.getDuration());r.fireEvent("RequestSeekTo",b);OneUp("Paste to "+f[0].toFixed(2),982)}});var c=!1;r.listenFor("RequestActionRecordToggle",function(){n.is_ready?
r.rec.isActive()?r.fireEvent("RequestActionRecordStop"):c||(c=!0,setTimeout(function(){r.fireEvent("RequestActionRecordStart");setTimeout(function(){c=!1},50)},26)):r.fireEvent("RequestActionNewRec")});r.listenFor("RequestActionRecordStop",function(){if(n.is_ready){if(!r.rec.isActive())return!1;r.rec.stop()}});r.listenFor("RequestActionRecordStart",function(){if(n.is_ready){r.fireEvent("RequestPause");if(r.rec.isActive())return!1;var a=h.getCurrentTime()*h.backend.buffer.sampleRate;r.rec.start(a,
function(b,f){r.fireEvent("DidActionRecordStop",!!f);if(f){r.fireEvent("StateRequestPush",{desc:"Record Audio",meta:[b,void 0],data:h.backend.buffer});var m=y.ReplaceFloatArrays(b,f);h.regions.clear();h.regions.add({start:m[0],end:m[1],id:"t"});r.fireEvent("RequestSeekTo",m[0]/h.getDuration());OneUp("Recorded Audio "+m[0].toFixed(2),982)}},function(){r.fireEvent("DidActionRecordStart")});(a=h.regions.list[0])?r.rec.setEndingOffset(a.end*h.backend.buffer.sampleRate):r.rec.setEndingOffset(h.getDuration()*
h.backend.buffer.sampleRate)}});r.listenFor("RequestActionFX_PREVIEW_HardLimit",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.HardLimit(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_HardLimit",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=
h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Hard Limit (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.HardLimit(a));OneUp("Applied Hard Limit (fx)")}});r.listenFor("RequestActionFX_PARAMEQ",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);
var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Parametric EQ (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.ParametricEQ(a));OneUp("Applied Parametric EQ (fx)")}});r.listenFor("RequestActionFX_PREVIEW_PARAMEQ",function(a){if(n.is_ready&&a)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=
n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.ParametricEQ(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_PREVIEW_DISTORT",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Distortion(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_DISTORT",
function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Distortion (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Distortion(a));OneUp("Applied Distortion (fx)")}});r.listenFor("RequestActionFX_PREVIEW_DELAY",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");
else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Delay(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_DELAY",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",
{desc:"Apply Delay (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Delay(a));OneUp("Applied Delay (fx)")}});r.listenFor("RequestActionFX_PREVIEW_REVERB",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Reverb(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_REVERB",
function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Reverb (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Reverb(a));OneUp("Applied Reverb (fx)")}});r.listenFor("RequestActionFX_PREVIEW_COMPRESSOR",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");
else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Compressor(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_Compressor",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",
{desc:"Apply Compressor (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Compressor(a));OneUp("Applied Compressor (fx)")}});r.listenFor("RequestActionFX_Normalize",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Normalize ",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Normalize(a));
OneUp("Applied Normalize")}});r.listenFor("RequestActionFX_Invert",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);a=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Invert ",meta:[a,b],data:h.backend.buffer});y.FX(a,b,y.FXBank.Invert());OneUp("Applied Invert")}});r.listenFor("RequestActionFX_RemSil",function(a){if(n.is_ready){r.fireEvent("RequestPause");
a=h.regions.list[0];a||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),a=h.regions.list[0]);var b=n.TrimTo(a.start,3),f=n.TrimTo(a.end-a.start,3);r.fireEvent("StateRequestPush",{desc:"Remove Silence ",meta:[b,f],data:h.backend.buffer});a=h.backend.buffer;var m=[],k=210,u=0,w=0;f=b=0;for(var x=!1,z=0;1>z;++z){for(var C=a.getChannelData(z),B=0;B<C.length;++B)3.68E-4>Math.abs(C[B])?(0===u&&(b=500<B?B-500:B),++u>k&&(w=0,f=B,x=!0)):x?56<++w?(m.push([b,f]),B+=500,f=b=u=0,x=!1,w=0):f=B:(f=b=u=0,x=
!1,w=0);x&&m.push([b,f])}if(0<m.length){for(z=k=0;z<m.length;++z)k+=m[z][1]-m[z][0];b=h.backend.ac.createBuffer(a.numberOfChannels,a.length-k,a.sampleRate);for(z=0;z<a.numberOfChannels;++z){C=a.getChannelData(z);f=b.getChannelData(z);u=k=0;var D=m[u];w=D[0];x=D[1];for(B=D=0;B<f.length;++B){D=B+k;if(D>w&&D<x)if(D<w+500){var G=(500-(D-w))/500;f[B]=C[D]*G;f[B]+=(1-G)*C[B+(k+(x-w))];continue}else{k+=x-w;if(D=m[++u])w=D[0],x=D[1];D=B+k}f[B]=C[D]}}y.FullReplace(b)}setTimeout(function(){h.drawBuffer()},
40);OneUp("Applied :: Remove Silence")}});var l=function(){var a=h.backend.buffer.numberOfChannels;1===a?(h.ActiveChannels=[1],r.el.classList.add("pk_mono")):(h.ActiveChannels=[1,1],r.el.classList.remove("pk_mono"));h.drawer.params.ActiveChannels=h.ActiveChannels;h.SelectedChannelsLen=a};r.listenFor("RequestActionFX_Flip",function(a,b){function f(w,x,z,C){r.fireEvent("StateRequestPush",{desc:z,meta:[w,x],data:h.backend.buffer,cb:C})}if(n.is_ready){r.fireEvent("RequestPause");var m=h.getDuration();
if("flip"===a)f(0,m,"Flip Channels"),y.FX(0,m,y.FXBank.Flip(a));else if("stereo"===a){f(0,m,"Make Stereo",function(){l()});var k=h.backend.buffer,u=h.backend.ac.createBuffer(2,k.length,k.sampleRate);u.getChannelData(0).set(k.getChannelData(0));u.getChannelData(1).set(k.getChannelData(0));y.FullReplace(u);h.regions.clear();h.regions.add({start:0,end:m,id:"t"});l();r.fireEvent("RequestSeekTo",0)}else"mono"===a&&(f(0,m,"Make Mono",function(){l()}),k=h.backend.buffer,u=h.backend.ac.createBuffer(1,k.length,
k.sampleRate),u.getChannelData(0).set(k.getChannelData(b)),y.FullReplace(u),h.regions.clear(),h.regions.add({start:0,end:m,id:"t"}),l(),r.fireEvent("RequestSeekTo",0));OneUp("Applied Channel Change: "+a)}});r.listenFor("RequestActionFX_Reverse",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);a=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Reverse ",
meta:[a,b],data:h.backend.buffer});y.FX(a,b,y.FXBank.Reverse());OneUp("Applied Reverse")}});var d=!1;r.listenFor("RequestActionFX_NoiseRNN",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=function(){var f=h.regions.list[0];f||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),f=h.regions.list[0]);var m=n.TrimTo(f.start,3),k=n.TrimTo(f.end-f.start,3);f=f.end-f.start;f=n.TrimTo(f,3);r.fireEvent("StateRequestPush",{desc:"Apply Noise RNN (fx)",meta:[m,k],data:h.backend.buffer});for(var u=
y.Copy(m,k),w=0;w<u.numberOfChannels;w++){var x=u.getChannelData(w),z=wasm_denoise_stream_perf(x);x.set(z)}y.Replace(m,k,u);r.fireEvent("RequestSeekTo",m/h.getDuration());h.regions.clear();h.regions.add({start:m,end:m+f,id:"t"});OneUp("Applied Noise RNN (fx)")};d?b():(a=document.createElement("script"),a.src="rnn_denoise.js",a.onload=function(){d=!0;var f=function(){window.Module&&window.Module.asm&&window.Module.asm.malloc?b():setTimeout(function(){f()},350)};setTimeout(function(){f()},100)},a.onerror=
function(){alert("Could not download noise Reduction script")},document.head.appendChild(a))}});r.listenFor("RequestActionFX_FadeIn",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);a=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Fade In (fx)",meta:[a,b],data:h.backend.buffer});y.FX(a,b,y.FXBank.FadeIn());OneUp("Applied Fade In (fx)")}});r.listenFor("RequestActionFX_FadeOut",
function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);a=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Fade Out (fx)",meta:[a,b],data:h.backend.buffer});y.FX(a,b,y.FXBank.FadeOut());OneUp("Applied Fade Out (fx)")}});var g=null;r.listenFor("RequestActionFX_UPDATE_PREVIEW",function(a){y.previewing&&(clearTimeout(g),g=setTimeout(function(){y.FXPreviewUpdate(a)},
44))});r.listenFor("RequestActionFX_TOGGLE",function(a){a?y.FXPreviewInit(!0):r.fireEvent("DidTogglePreview",y.FXPreviewToggle())});r.listenFor("RequestActionFX_PREVIEW_STOP",function(){y.FXPreviewStop();r.fireEvent("DidStopPreview")});r.listenFor("RequestActionFX_PREVIEW_GAIN",function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);
b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Gain(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_GAIN",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);r.fireEvent("StateRequestPush",{desc:"Apply Gain (fx)",meta:[f,b],data:h.backend.buffer});y.FX(f,b,y.FXBank.Gain(a));OneUp("Applied Gain (fx)")}});r.listenFor("RequestActionFX_PREVIEW_SPEED",
function(a){if(n.is_ready)if(y.previewing)y.FXPreviewStop(),r.fireEvent("DidStopPreview");else{var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);var f=n.TrimTo(b.start,3);b=n.TrimTo(b.end-b.start,3);y.FXPreview(f,b,y.FXBank.Speed(a));r.fireEvent("DidStartPreview")}});r.listenFor("RequestActionFX_SPEED",function(a){if(n.is_ready){r.fireEvent("RequestPause");var b=h.regions.list[0];b||(h.regions.add({start:0,end:h.getDuration()-0,id:"t"}),b=h.regions.list[0]);
var f=n.TrimTo(b.start,3),m=n.TrimTo(b.end-b.start,3),k=(b.end-b.start)/a;k=n.TrimTo(k,3);r.fireEvent("StateRequestPush",{desc:"Apply Speed (fx)",meta:[f,m],data:h.backend.buffer});var u=y.Copy(f,m);b=h.backend.buffer;var w=k/1*b.sampleRate>>0;a=y.FXBank.Speed(a);b=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(h.SelectedChannelsLen,w,b.sampleRate);var x=b.createBufferSource();x.buffer=u;var z=a.filter(b,b.destination,x,k);x.start();var C=function(B){y.Replace(f,m,B);h.regions.clear();
h.regions.add({start:f,end:f+k,id:"t"});r.fireEvent("RequestSeekTo",f/h.getDuration());OneUp("Applied Speed (fx)");if(0<z.length)for(B=0;B<z.length;++B)z[B].disconnect();else z&&z.disconnect&&z.disconnect();u=z=null;x.disconnect()};(a=b.startRendering())?a.then(C)["catch"](function(B){console.log("Rendering failed: "+B)}):b.oncomplete=function(B){C(B.renderedBuffer)}}});r.listenFor("StateDidPop",function(a,b){if(n.is_ready){r.fireEvent("RequestPause");h.regions.clear();h.loadDecodedBuffer(a.data);
a.cb&&a.cb();var f=h.getDuration();r.fireEvent("DidUpdateLen",f);a.meta&&0<a.meta.length&&(a.meta[1]?h.regions.add({start:a.meta[0]/1,end:a.meta[0]/1+a.meta[1]/1,id:"t"}):(f||(f=1E-4),r.fireEvent("RequestSeekTo",a.meta[0]/f)));b?OneUp("Undo "+a.desc):OneUp("Redo "+a.desc)}});r.listenFor("RequestChanToggle",function(a,b){if(!n.is_ready||h.ActiveChannels.length<=a)return!1;var f=h.ActiveChannels[a];var m=b?b:1===f?0:1;f!==m&&(h.ActiveChannels[a]=m,0===m?(--h.SelectedChannelsLen,0===a?h.backend.gainNode2.gain.value=
0:h.backend.gainNode1.gain.value=0):(++h.SelectedChannelsLen,0===a?h.backend.gainNode2.gain.value=1:h.backend.gainNode1.gain.value=1),h.ForceDraw(),r.fireEvent("DidChanToggle",a,m))});h.on("region-updated",function(){h.regions.list[0]&&r.fireEvent("DidCreateRegion",h.regions.list[0])});h.on("region-update-end",function(){r.fireEvent("DidCreateRegion",h.regions.list[0]);var a=h.regions.list[0].start;h.isPlaying()||r.fireEvent("RequestSeekTo",a/h.getDuration())});h.on("cursorcenter",function(a){r.fireEvent("DidCursorCenter",
a,h.ZoomFactor)});var p=h.drawer.canvases[0].wave.parentNode,q=0,e=function(a){r.fireEvent("RequestPan",q-a.clientX);q=a.clientX};r.listenFor("RequestZoom",function(a,b){a*=h.ZoomFactor;if(-1===b){var f=h.drawer.width;f-=f/h.ZoomFactor;var m=h.ZoomFactor-1;if(0>=m)return;var k=h.ZoomFactor;h.ZoomFactor+=a*m/f;1>h.ZoomFactor&&(h.ZoomFactor=1);f=h.getDuration()/h.ZoomFactor;if(.5>=f){h.ZoomFactor=k;return}h.VisibleDuration=f;h.LeftProgress+=a/h.drawer.width*h.VisibleDuration;h.LeftProgress+h.VisibleDuration>=
h.getDuration()?h.LeftProgress=h.getDuration()-h.VisibleDuration:0>h.LeftProgress&&(h.LeftProgress=0)}else if(1===b){f=h.drawer.width;f-=f/h.ZoomFactor;m=h.ZoomFactor-1;if(0>=m)return;k=h.ZoomFactor;h.ZoomFactor-=a*m/f;1>h.ZoomFactor&&(h.ZoomFactor=1);f=h.getDuration()/h.ZoomFactor;if(f+h.LeftProgress>h.getDuration())h.ZoomFactor=k;else{if(.5>=f){h.ZoomFactor=k;return}h.VisibleDuration=f}}h.ForceDraw();r.fireEvent("DidZoom",[h.ZoomFactor,h.LeftProgress/h.getDuration()*100,h.params.verticalZoom])});
r.listenFor("RequestPan",function(a,b){if(1===b)a*=h.ZoomFactor;else if(2===b){var f=h.getDuration()*(a/h.drawer.width);h.LeftProgress=f;h.ForceDraw();r.fireEvent("DidZoom",[h.ZoomFactor,h.LeftProgress/h.getDuration()*100,h.params.verticalZoom]);return}0<h.ZoomFactor&&(f=a/h.drawer.width*h.VisibleDuration,h.LeftProgress+=f,h.LeftProgress+h.VisibleDuration>=h.getDuration()?h.LeftProgress=h.getDuration()-h.VisibleDuration:0>h.LeftProgress&&(h.LeftProgress=0),h.ForceDraw(),r.fireEvent("DidZoom",[h.ZoomFactor,
h.LeftProgress/h.getDuration()*100,h.params.verticalZoom]))});p.addEventListener("mousedown",function(a){if(3===a.which)return a.preventDefault(),h.Interacting|=2,q=a.clientX,p.className="pk_grabbing",document.addEventListener("mousemove",e,!1),!1;r.fireEvent("MouseDown");r.fireEvent("RequestChanToggle",0,1);r.fireEvent("RequestChanToggle",1,1)},!1);p.addEventListener("mouseleave",function(a){document.removeEventListener("mousemove",e);""!==p.className&&(p.className="",setTimeout(function(){h.Interacting&=
-3},20))},!1);p.addEventListener("mouseup",function(a){3===a.which&&(""!==p.className&&(p.className="",setTimeout(function(){h.Interacting&=-3},20)),document.removeEventListener("mousemove",e))},!1);r.fireEvent("RequestResize");r.listenFor("RequestViewFollowCursorToggle",function(){var a=!h.FollowCursor;(h.FollowCursor=a)&&n.is_ready&&h.CursorCenter();r.fireEvent("DidViewFollowCursorToggle",a)});r.listenFor("RequestViewPeakSeparatorToggle",function(){if(n.is_ready){var a=!h.params.limits;h.params.limits=
a;h.ForceDraw();r.fireEvent("DidViewPeakSeparatorToggle",a)}});r.listenFor("RequestViewTimelineToggle",function(){if(n.is_ready){var a=!h.params.timeline;h.params.timeline=a;h.ForceDraw();r.fireEvent("DidViewTimelineToggle",a)}});r.listenFor("RequestViewCenterToCursor",function(){n.is_ready&&h.CursorCenter()});r.listenFor("RequestZoomUI",function(a,b){n.is_ready&&(0===a?h.ResetZoom():("h"===a&&h.SetZoom(.5,b),"v"===a&&h.SetZoomVertical(b)))});this.ID3=function(a){var b=null,f=new Uint8Array(a);if(64>
f.length)return r.fireEvent("RequestActionID3",1,b),b;73===f[0]&&68===f[1]&&51===f[2]?b=ID3v2.ReadTags(a):102===f[4]&&116===f[5]&&121===f[6]&&112===f[7]&&77===f[8]&&52===f[9]&&(b=ID4.ReadTags(a));r.fireEvent("RequestActionID3",1,b);return b}}})(window,document,PKAudioEditor);
(function(F){F._deps.audioutils=function(A,E){function r(p){E.loadDecodedBuffer(p);A.fireEvent("DidUpdateLen",E.getDuration())}function n(p,q){for(var e=E.backend.buffer,a=q/1*e.sampleRate>>0,b=p/1*e.sampleRate>>0,f=E.backend.ac.createBuffer(E.SelectedChannelsLen,a,e.sampleRate),m=0,k=0;m<E.ActiveChannels.length;++m)0!==E.ActiveChannels[m]&&(f.getChannelData(k).set(e.getChannelData(m).slice(b,a+b)),++k);return f}function h(p,q,e){var a=E.backend.buffer;q=q/1*a.sampleRate>>0;p=p/1*a.sampleRate>>0;
var b=E.backend.ac.createBuffer(e?a.numberOfChannels:E.SelectedChannelsLen,q,a.sampleRate);if(!e&&E.SelectedChannelsLen<a.numberOfChannels){e=E.backend.ac.createBuffer(a.numberOfChannels,a.length,a.sampleRate);for(var f=0;f<a.numberOfChannels;++f){var m=a.getChannelData(f),k=e.getChannelData(f);if(0===E.ActiveChannels[f])k.set(m);else{var u=b.getChannelData(0);u.set(m.slice(p,p+q));k.set(m.slice(0,p));k.set(m.slice(p+q),p+q)}}}else for(e=a.length-q,0>=e&&(e=100),e=E.backend.ac.createBuffer(a.numberOfChannels,
e,a.sampleRate),f=0;f<a.numberOfChannels;++f)m=a.getChannelData(f),u=b.getChannelData(f),k=e.getChannelData(f),u.set(m.slice(p,p+q)),k.set(m.slice(0,p)),k.set(m.slice(p+q),p);r(e,a);return b}function y(p,q){var e=E.backend.buffer,a=E.backend.ac.createBuffer(e.numberOfChannels,e.length+q.length,e.sampleRate);p=p/1*e.sampleRate>>0;for(var b=0;b<e.numberOfChannels;++b){var f=e.getChannelData(b),m=a.getChannelData(b);var k=1===q.numberOfChannels?q.getChannelData(0):q.getChannelData(b);1===E.SelectedChannelsLen&&
0===E.ActiveChannels[b]?m.set(f):(0<p&&m.set(f.slice(0,p)),m.set(k,p),p<e.length+q.length&&m.set(f.slice(p),p+k.length))}r(a,e);return[p/e.sampleRate,p/e.sampleRate+q.length/e.sampleRate]}function t(){if(this.previewing){if(this.PreviewFilter)if(0<this.PreviewFilter.length)for(var p=0;p<this.PreviewFilter.length;++p)this.PreviewFilter[p].disconnect();else this.PreviewFilter.disconnect();d.disconnect();E.backend.scriptNode.connect(l.destination);this.PreviewSource.stop();this.PreviewSource.disconnect();
this.PreviewDestination=this.PreviewSource=this.PreviewFilter=this.PreviewUpdate=null;this.previewing=0}}function v(){if(!this.previewing)return this.previewVal=!this.previewVal;if(2===this.previewing)return this.PreviewTog&&this.PreviewTog(!1,this.PreviewSource),this.PreviewSource.disconnect(),this.PreviewSource.connect(this.PreviewDestination),this.previewing=1,this.previewVal=!1;this.PreviewSource.disconnect();this.PreviewFilter&&(0<this.PreviewFilter.length?!this.PreviewFilter[0].buffer&&this.PreviewSource.connect(this.PreviewFilter[0]):
(!this.PreviewFilter.buffer&&this.PreviewSource.connect(this.PreviewFilter),this.PreviewFilter.disconnect(),this.PreviewFilter.connect(this.PreviewDestination)));this.PreviewTog&&this.PreviewTog(!0,this.PreviewSource);this.previewing=2;return this.previewVal=!0}var c=E.backend.analyser,l=E.backend.ac,d=l.createScriptProcessor(256),g=null;this.FXPreviewUpdate=function(p){this.previewing&&this.PreviewUpdate&&this.PreviewUpdate(this.PreviewFilter,l,p,this.PreviewSource)};this.FXPreviewStop=t;this.FXPreviewToggle=
v;this.FXPreviewInit=function(p){this.previewVal=p};this.FXPreview=function(p,q,e){this.previewing&&t();var a=E.backend.buffer;p||q||(p=0,q=a.length/a.sampleRate>>0);a=d;p=n(p,q);var b;(b=E.backend.ac)||(window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new (window.AudioContext||window.webkitAudioContext)),b=window.WaveSurferAudioContext);var f=b.createBufferSource();f.buffer=p;f.loop=!0;this.PreviewFilter=this.PreviewTog=null;e?(this.PreviewTog=e.preview,this.PreviewUpdate=e.update,this.PreviewFilter=
e.filter(b,c,f,q/1)):f.connect(c);a.disconnect();E.backend.scriptNode.disconnect();a.connect(b.destination);var m=1,k=0,u=null;a.onaudioprocess=function(w){var x=[0,0],z=0;--m;if(0===m){if(c.getFloatTimeDomainData){k!==c.fftSize&&(u=new Float32Array(c.fftSize),k=c.fftSize);c.getFloatTimeDomainData(u);for(var C=0;C<c.fftSize;C+=1){var B=u[C];Math.abs(B)>=z&&(z=Math.abs(B))}x[0]=20*Math.log10(z)+.001}else{k!==c.fftSize&&(u=new Uint8Array(c.fftSize),k=c.fftSize);c.getByteTimeDomainData(u);for(C=z=0;C<
c.fftSize;C+=1)B=u[C]/128-1,z+=B*B;x[0]=Math.log(Math.sqrt(z/c.fftSize))/Math.log(10)*20}-100>x[0]&&(x[0]=-100);x[1]=x[0];c.getByteFrequencyData(E.backend.FreqArr);A.fireEvent("DidAudioProcess",[-1,x,w.timeStamp],E.backend.FreqArr);m=2}};f.start();this.PreviewSource=f;this.PreviewDestination=c;this.previewing=2;this.previewVal||v.call(this);return f};this.FX=function(p,q,e){var a=E.backend.buffer;p||q||(p=0,q=a.length/a.sampleRate>>0);0>p&&(p=0);E.getDuration()<q&&(q=E.getDuration());var b=n(p,q),
f=p/1*a.sampleRate>>0;p=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(E.SelectedChannelsLen,b.length,a.sampleRate);var m=p.createBufferSource();m.buffer=b;var k=null;e&&(k=e.filter(p,p.destination,m,q/1));m.start();var u=function(w){for(var x=E.backend.ac.createBuffer(a.numberOfChannels,a.length,a.sampleRate),z=0;z<a.numberOfChannels;++z){var C=x.getChannelData(z),B=a.getChannelData(z);if(0===E.ActiveChannels[z])C.set(B);else{var D=1===w.numberOfChannels?w.getChannelData(0):w.getChannelData(z);
C.set(B);C.set(D,f,D.length-f)}}r(x);if(0<k.length)for(z=0;z<k.length;++z)k[z].disconnect();else k&&k.disconnect&&k.disconnect();b=k=null;m.disconnect()};(q=p.startRendering())?q.then(u)["catch"](function(w){console.log("Rendering failed: "+w)}):p.oncomplete=function(w){u(w.renderedBuffer)}};this.FXBank={Gain:function(p){return{filter:function(q,e,a,b){b=q.createGain();for(var f=0;f<p.length;++f){var m=p[f];if(m.length)for(var k=0;k<m.length;++k)b.gain.linearRampToValueAtTime(m[k].val,q.currentTime+
m[k].time);else b.gain.setValueAtTime(m.val,q.currentTime)}b.connect(e);a.connect(b);return b},update:function(q,e,a){for(var b=0;b<a.length;++b){var f=a[b];if(f.length)for(var m=0;m<f.length;++m)q.gain.linearRampToValueAtTime(f[m].val,e.currentTime+f[m].time);else q.gain.setValueAtTime(f.val,e.currentTime)}}}},FadeIn:function(p){return{filter:function(q,e,a,b){var f=q.createGain();f.gain.setValueAtTime(0,q.currentTime);f.gain.linearRampToValueAtTime(1,q.currentTime+b/1);f.connect(e);a.connect(f);
return f}}},FadeOut:function(p){return{filter:function(q,e,a,b){var f=q.createGain();f.gain.setValueAtTime(1,q.currentTime);f.gain.linearRampToValueAtTime(0,q.currentTime+b/1);f.connect(e);a.connect(f);return f}}},Compressor:function(p){return{filter:function(q,e,a,b){b=q.createDynamicsCompressor();for(var f in p)if(p[f].length)for(var m=0;m<p[f].length;++m){var k=p[f][m];b[f].linearRampToValueAtTime(k.val,q.currentTime+k.time)}else b[f].setValueAtTime(p[f].val,q.currentTime);b.connect(e);a.connect(b);
return b},update:function(q,e,a){for(var b in a)if(a[b].length)for(var f=0;f<a[b].length;++f){var m=a[b][f];q[b].linearRampToValueAtTime(m.val,e.currentTime+m.time)}else q[b].setValueAtTime(a[b].val,e.currentTime)}}},Reverse:function(p){return{filter:function(q,e,a,b){for(q=0;q<a.buffer.numberOfChannels;++q)Array.prototype.reverse.call(a.buffer.getChannelData(q));a.connect(e);return a},update:function(){}}},Invert:function(p){return{filter:function(q,e,a,b){for(q=0;q<a.buffer.numberOfChannels;++q){b=
a.buffer.getChannelData(q);for(var f=0;f<b.length;++f)b[f]*=-1}a.connect(e);return a},update:function(){}}},Flip:function(p,q){return{filter:function(e,a,b,f){if("flip"===p){e=b.buffer.getChannelData(0);f=b.buffer.getChannelData(1);for(var m,k=0;k<e.length;++k)m=e[k],e[k]=f[k],f[k]=m}b.connect(a);return b},update:function(){}}},Normalize:function(p){return{filter:function(q,e,a,b){q=p[1]||1;b=p[0];for(var f=0,m=0;m<a.buffer.numberOfChannels;++m){for(var k=a.buffer.getChannelData(m),u=1,w=k.length;u<
w;u+=10){var x=Math.abs(k[u]);f<x&&(f=x)}x=q/f;if(!b){u=0;for(w=k.length;u<w;++u)k[u]*=x;f=0}}if(b)for(x=q/f,m=0;m<a.buffer.numberOfChannels;++m)for(k=a.buffer.getChannelData(m),u=0,w=k.length;u<w;++u)k[u]*=x;a.connect(e);return a},update:function(){}}},HardLimit:function(p){return{filter:function(q,e,a,b){var f=p[1]||1,m=p[2]||0,k=p[3]||15,u=0;b=q.createBuffer(a.buffer.numberOfChannels,a.buffer.length,a.buffer.sampleRate);k=k*b.sampleRate/1E3>>0;for(var w=0;w<b.numberOfChannels;++w){var x=b.getChannelData(w);
x.set(a.buffer.getChannelData(w));for(var z=0,C=x.length;z<C;++z){for(var B=0;B<k;B+=10){var D=Math.abs(x[z+B]);u<D&&(u=D)}u=f/u;for(B=0;B<k;++B){D=x[z+B];var G=D*u,K=f-Math.abs(G);K*=0>D?-m:m;x[z+B]=G+K}z+=k;u=0}}q=q.createBufferSource();q.buffer=b;q.loop=!0;q.start();q.connect(e);return q},update:function(q,e,a,b){q.disconnect();q.buffer=null;this.PreviewFilter=this.FXBank.HardLimit(a).filter(e,c,b,0)}}},ParametricEQ:function(p){return{filter:function(q,e,a,b){b=[];var f=p.length,m=function(u){var w=
q.createBiquadFilter();if(u.length){for(var x=0;x<u.length;++x)w.gain.linearRampToValueAtTime(~~u[x].val,q.currentTime+u[x].time);u=u[0]}else w.gain.value=~~u.val;w.type=u.type;w.Q.value=u.q||1;w.frequency.value=u.freq;return w};p[0]||(p[0]={type:"peaking",val:0,q:1,freq:500});var k=m(p[0]);b.push(k);a.connect(k);if(1===p.length)return k.connect(e),b;for(a=1;a<f-1;++a)k=m(p[a]),b[a-1].connect(k),b.push(k);k=m(p[f-1]);b[b.length-1].connect(k);b.push(k);k.connect(e);return b},update:function(q,e,a,
b){if(q.length!==a.length)if(q.length<a.length){for(var f=a.length-q.length;0<f--;){var m=e.createBiquadFilter();var k=q[0];q.unshift(m);m.connect(k)}b.disconnect();b.connect(q[0])}else if(0<a.length){f=q.length-a.length;b.disconnect();for(e=0;e<f;++e)m=q.shift(),m.disconnect();b.connect(q[0])}else a[0]={type:"peaking",val:0,q:1,freq:500};b=a.length;for(e=0;e<b;++e)m=q[e],m.type=a[e].type,m.gain.value=~~a[e].val,m.Q.value=a[e].q||1,m.frequency.value=a[e].freq}}},Speed:function(p){var q=1;return{filter:function(e,
a,b,f){e=e.createGain();b.playbackRate.value=p;b.connect(e);e.connect(a);return[e]},preview:function(e,a){a.playbackRate.value=e?q:1},update:function(e,a,b,f){q=b;f.playbackRate.value=b}}},Delay:function(p){return{filter:function(q,e,a,b){var f=q.createGain(),m=q.createGain();b=q.createGain();var k=q.createGain(),u=q.createGain(),w=q.createDelay();a.connect(f);f.connect(b);b.connect(m);w.connect(u);u.connect(w);f.connect(w);w.connect(k);k.connect(m);m.connect(e);e=[f,m,b,k,u,w];if(p.delay.length)for(a=
0;a<p.delay.length;++a)w.delayTime.linearRampToValueAtTime(p.delay[a].val,p.delay[a].time+q.currentTime);else w.delayTime.value=p.delay.val;if(p.feedback.length)for(a=0;a<p.feedback.length;++a)u.gain.linearRampToValueAtTime(p.feedback[a].val,p.feedback[a].time+q.currentTime);else u.gain.value=p.feedback.val;if(p.mix.length)for(a=0;a<p.mix.length;++a)b.gain.linearRampToValueAtTime(1-2*(p.mix[a].val-.5),p.mix[a].time+q.currentTime),k.gain.linearRampToValueAtTime(1-2*(.5-p.mix[a].val),p.mix[a].time+
q.currentTime);else b.gain.value=1-2*(p.mix.val-.5),k.gain.value=1-2*(.5-p.mix.val);return e},update:function(q,e,a){var b=q[2],f=q[3],m=q[4];q=q[5];if(a.delay.length)for(var k=0;k<a.delay.length;++k)q.delayTime.linearRampToValueAtTime(a.delay[k].val,a.delay[k].time+e.currentTime);else q.delayTime.value=a.delay.val;if(a.feedback.length)for(k=0;k<a.feedback.length;++k)m.gain.linearRampToValueAtTime(a.feedback[k].val,a.feedback[k].time+e.currentTime);else m.gain.value=a.feedback.val;if(a.mix.length)for(k=
0;k<a.mix.length;++k)b.gain.linearRampToValueAtTime(1-2*(a.mix[k].val-.5),a.mix[k].time+e.currentTime),f.gain.linearRampToValueAtTime(1-2*(.5-a.mix[k].val),a.mix[k].time+e.currentTime);else b.gain.value=1-2*(a.mix.val-.5),f.gain.value=1-2*(.5-a.mix.val)}}},Distortion:function(p){return{filter:function(q,e,a,b){b=q.createWaveShaper();for(var f=function(w){w=parseInt(w/1*100,10);for(var x=new Float32Array(44100),z=Math.PI/180,C,B=0;44100>B;++B)C=2*B/44100-1,x[B]=(3+w)*C*20*z/(Math.PI+w*Math.abs(C));
return x},m=0;m<p.length;++m){var k=p[m];if(k.length)for(var u=0;u<k.length;++u)b.curve.linearRampToValueAtTime(f(k[u].val),q.currentTime+k[u].time);else b.curve=f(k.val)}a.connect(b);b.connect(e);return b},update:function(q,e,a){for(var b=function(u){u=parseInt(u/1*100,10);for(var w=new Float32Array(44100),x=Math.PI/180,z,C=0;44100>C;++C)z=2*C/44100-1,w[C]=(3+u)*z*20*x/(Math.PI+u*Math.abs(z));return w},f=0;f<a.length;++f){var m=a[f];if(m.length)for(var k=0;k<m.length;++k)q.curve.linearRampToValueAtTime(b(m[k].val),
e.currentTime+m[k].time);else q.curve=b(m.val)}}}},Reverb:function(p){return{filter:function(q,e,a,b){var f=q.createGain();b=q.createConvolver();var m=q.createGain(),k=q.createGain(),u=q.createGain();a.connect(f);f.connect(b);b.connect(k);f.connect(u);u.connect(m);k.connect(m);m.connect(e);e=[f,m,b,u,k];u.gain.value=1-2*(p.mix-.5);k.gain.value=1-2*(.5-p.mix);a=q.sampleRate*p.time;q=q.createBuffer(2,a,q.sampleRate);k=q.getChannelData(0);u=q.getChannelData(1);for(m=0;m<a;m++)f=p.reverse?a-m:m,k[m]=
(2*Math.random()-1)*Math.pow(1-f/a,p.decay),u[m]=(2*Math.random()-1)*Math.pow(1-f/a,p.decay);b.buffer=q;return e},update:function(q,e,a){e=E.backend.ac;var b=q[2],f=q[4];q[3].gain.value=1-2*(a.mix-.5);f.gain.value=1-2*(.5-a.mix);q=e.sampleRate*a.time;e=e.createBuffer(2,q,e.sampleRate);f=e.getChannelData(0);var m=e.getChannelData(1),k;for(k=0;k<q;k++){var u=a.reverse?q-k:k;f[k]=(2*Math.random()-1)*Math.pow(1-u/q,a.decay);m[k]=(2*Math.random()-1)*Math.pow(1-u/q,a.decay)}b.buffer=e}}}};this.Trim=h;this.Copy=
n;this.Insert=y;this.InsertFloatArrays=function(p,q){var e=E.backend.buffer,a=q.length,b=q[0].length,f=b*a;p=p/1*e.sampleRate>>0;for(var m=E.backend.ac.createBuffer(e.numberOfChannels,e.length+f,e.sampleRate),k=0;k<e.numberOfChannels;k++){var u=e.getChannelData(k),w=m.getChannelData(k);0<p&&w.set(u.slice(0,p));for(var x=0;x<a;++x)w.set(q[x],p+x*b);p<e.length+f&&w.set(u.slice(p),p+f)}r(m,e);return[p/e.sampleRate,p/e.sampleRate+f/e.sampleRate]};this.ReplaceFloatArrays=function(p,q){var e=E.backend.buffer,
a=q.length,b=q[0].length,f=b*a,m=e.length;p=p/1*e.sampleRate>>0;m<p+f&&(m=p+f);m=E.backend.ac.createBuffer(e.numberOfChannels,m,e.sampleRate);for(var k=0;k<e.numberOfChannels;k++){var u=e.getChannelData(k),w=m.getChannelData(k);0<p&&w.set(u.slice(0,p));for(var x=0;x<a;++x)w.set(q[x],p+x*b);p<e.length+f&&w.set(u.slice(p+f),p+f)}r(m,e);return[p/e.sampleRate,p/e.sampleRate+f/e.sampleRate]};this.Replace=function(p,q,e){h(p,q,!0);p=y(p,e);setTimeout(function(){E.drawBuffer()},40);return p};this.FullReplace=
function(p){r(p);setTimeout(function(){E.drawBuffer()},40)};this.MakeSilence=function(p){var q=E.backend.buffer;return E.backend.ac.createBuffer(q.numberOfChannels,p*q.sampleRate,q.sampleRate)};this.DownloadFile=function(p,q,e,a,b,f){function m(B){return Math.max(-32768,Math.min(32768,0>B?32768*B:32767*B))}if(!(E&&E.backend&&E.backend.buffer))return!1;g="mp3"===q?new Worker("lame.js"):new Worker("wav.js");var k=E.backend.buffer;q=k.sampleRate;var u=k.numberOfChannels,w=k.getChannelData(0),x=null;
2===u&&(x=k.getChannelData(1));b||2!==u||E.ActiveChannels[0]||!E.ActiveChannels[1]||(w=k.getChannelData(1),x=null,u=1);b&&!x?(x=w,u=2):!b&&x&&(x=null,u=1);b=w.length;var z=k=0;a&&(z=a[0]*q>>0,b=(a[1]*q>>0)-z);a=new Int16Array(b);var C=null;if(x)for(C=new Int16Array(b);k<b;)a[k]=m(w[z+k]),C[k]=m(x[z+k]),++k;else for(;k<b;)a[k]=m(w[z+k]),++k;g.onmessage=function(B){if(B.data.percentage)f&&f(B.data.percentage);else{B=(window.URL||window.webkitURL).createObjectURL(B.data);var D=document.createElement("a");
D.href=B;D.download=p?p:"output.mp3";D.style.display="none";document.body.appendChild(D);D.click();f&&f("done");g.terminate();g=null}};g.postMessage({sample_rate:q,kbps:e?e:128,channels:u});g.postMessage(a.buffer,[a.buffer]);x?g.postMessage(C.buffer,[C.buffer]):g.postMessage(null)};this.DownloadFileCancel=function(){g&&(g.terminate(),g=null)}}})(PKAudioEditor);
(function(F){F=F||window;var A=function(n,h){if(!n.className)return!1;for(var y=n.className.split(" "),t=[],v=0,c=y.length;v<c;++v)y[v]!=h&&t.push(y[v]);n.className=t.join(" ")};if(window.FileReader&&document.addEventListener){var E=new FileReader;var r=function(n,h,y){E.onerror=function(t){throw["File not found.","File coulnot be opened","File couldnot be uploaded","Couldnot read File","File too large"][t.target.error.code-1];};E.onloadend=function(t){h&&h(t.target.result,n.name);E.onloadend=null};
E[y](n);return!1}}else throw"File API not supported";F.dragNDrop=function(n,h,y,t,v){if("ontouchstart"in window)return"mobile";var c={text:"readAsText",binary:"readAsBinaryText",arrayBuffer:"readAsArrayBuffer"},l=v?v:"__fadingIn";t=t?c[t]:"readAsText";var d=0,g=h?h:n,p={silencer:function(q){q.preventDefault();q.stopPropagation()},onDragEnter:function(q){++d;setTimeout(function(){1<d&&(d=1)},10)},onDragLeave:function(q){--d;0>=d&&(A(g,l),d=0)},onDrop:function(q){p.silencer(q);A(g,l);d=0;q=q.dataTransfer.files;
var e;if(!q||!q.length)return!1;for(e=q.length;e--;)r(q[e],y,t)}};n.parentNode.addEventListener("dragenter",p.onDragEnter,!1);n.addEventListener("dragleave",p.onDragLeave,!1);n.addEventListener("dragover",p.silencer,!1);n.addEventListener("drop",p.onDrop,!1)}})(window);
(function(F,A,E){E._deps.rec=function(r){var n=this,h=null,y=null,t=null,v=null,c=!1,l=0,d=0,g=0,p=[],q=-1,e=4,a=null,b=null,f=0,m=12,k=function(u){0<m?--m:(f+=u.inputBuffer.duration*g,d<=f?0<d&&n.stop():(u=u.inputBuffer.getChannelData(0).slice(0),p[++q]=u,0===--e&&(e=4,r.engine.wavesurfer.DrawTemp(l,p))))};this.isActive=function(){return c};this.setEndingOffset=function(u){d=u};this.start=function(u,w,x,z){if(c)return!1;if(!navigator.mediaDevices)return r.fireEvent("ErrorRec"),r.fireEvent("ShowError",
"No recording device found"),!1;l=u/1;if(isNaN(l)||!l)l=0;f=l;t=r.engine.wavesurfer.backend.getAudioContext();if(!t)return r.fireEvent("ErrorRec"),r.fireEvent("ShowError","No recording device found"),!1;0===t.currentTime&&(r.engine.wavesurfer.backend.source.start(0),r.engine.wavesurfer.backend.source.stop(0));z||(g=r.engine.wavesurfer.backend.buffer?r.engine.wavesurfer.backend.buffer.sampleRate:t.sampleRate);a=w;b=x;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(C){y=C;h=t.createMediaStreamSource(C);
v=t.createScriptProcessor(2048,1,1);h.connect(v);v.connect(t.destination);c=!0;b&&b();v.onaudioprocess=k})["catch"](function(C){r.fireEvent("ErrorRec");C&&C.message&&r.fireEvent("ShowError",C.message)});return!0};this.stop=function(u){c&&(y.getTracks().forEach(function(w){w.stop()}),v.onaudioprocess=null,h.disconnect(),v.disconnect(),c=!1,r.engine.wavesurfer.DrawTemp(null),0<p.length&&!u?a&&a(l/g,p):a&&a(null,null),g=0,m=12,q=-1,l=d=0,p=[],a=b=t=y=null)}}})(window,document,PKAudioEditor);
(function(F,A,E){setTimeout(function(){PKAudioEditor._deps.Wlc=function(){var n="",h="";E.isMobile?(r-=15,n='Tips:<br/>Please make sure your device is not in silent mode. You might need to physically flip the silent switch. <img src="phone-switch.jpg" style="max-width:224px;max-height:126px;width:40%;margin: 10px auto; display: block;"/><br/><br/>'):(n="Tips:<br/>Please keep in mind that most key shortcuts rely on the <strong>Shift + <u>key</u></strong> combo. (eg Shift+Z for undo, Shift+C copy, Shift+X cut... etc )<br/><br/>",
h='Check out the codebase on <a href="https://github.com/pkalogiros/audiomass" target="_blank">Github</a><br/><br/>');(new PKSimpleModal({title:'<font style="font-size:15px">Welcome to AudioMass</font>',ondestroy:function(y){E.ui.InteractionHandler.on=!1;E.ui.KeyHandler.removeCallback("modalTemp")},body:'<div style="overflow:auto;-webkit-overflow-scrolling:touch;max-width:580px;width:calc(100vw - 40px);max-height:calc(100vh - 340px);min-height:110px;font-size:13px; color:#95c6c6;padding-top:7px;">AudioMass is a free, open source, web-based Audio and Waveform Editor.<br />It runs entirely in the browser with no backend and no plugins required!<br/><br/><br/>'+
n+"You can load any type of audio your browser supports and perform operations such as fade in, cut, trim, change the volume, and apply a plethora of audio effects.<br/><br/>"+h+"</div>",setup:function(y){E.ui.InteractionHandler.checkAndSet("modal");E.ui.KeyHandler.addCallback("modalTemp",function(v){y.Destroy()},[27]);var t=y.el_body.getElementsByTagName("div")[0];t.addEventListener("touchstart",function(v){v.stopPropagation()},!1);t.addEventListener("touchmove",function(v){v.stopPropagation()},
!1)}})).Show();document.getElementsByClassName("pk_modal_cancel")[0].innerHTML="&nbsp; &nbsp; &nbsp; OK &nbsp; &nbsp; &nbsp;"};var r=96;F.localStorage&&F.localStorage.getItem("k")||(r=0,F.localStorage&&F.localStorage.setItem("k",1));100*Math.random()>>0<r||PKAudioEditor._deps.Wlc()},320)})(window,document,PKAudioEditor);
(function(F,A,E){function r(){function n(k,u,w,x){var z=!1,C;for(C in w)if(u[C]!==w[C])if(z=!0,u[C]=w[C],"_on"===C){var B=document.getElementById("pgon"+u.id);B.checked=u[C]}else"freq"===C?(B=u.el.getElementsByClassName("pk_freq")[0],B.value=u[C]):"gain"===C?(B=u.el.getElementsByClassName("pk_gain")[0],B.value=u[C]):"q"===C?(B=u.el.getElementsByClassName("pk_q")[0],B.value=u[C]):"type"===C&&(B=u.el.getElementsByTagName("select")[0],"peaking"===u[C]?B.options[0].selected=!0:"lowpass"===u[C]?B.options[1].selected=
!0:"highpass"===u[C]&&(B.options[2].selected=!0),y(u),k.ranges.sort(c));z&&(x&&(x=k.ui.canvas_eq,w=x.width,x=x.height,u._coords.x=5E3>=u.freq?(u.freq/5E3*(w/2)).toFixed(1)/1:(w/2+(u.freq-5E3)/15E3*(w/2)).toFixed(1)/1,u._coords.y="peaking"===u.type?((1-(u.gain+35)/70)*x).toFixed(1)/1:(x/2).toFixed(1)/1),a&&clearTimeout(a),a=setTimeout(function(){k.Callback();a=null},38),k.Render())}function h(k){return k*k*k*k}function y(k){for(var u=[],w=0;w<f;++w)u[w]=0;k._arr=u;var x=2/k.q*b,z=x/m>>0;if("peaking"===
k.type){w=k.freq-x/2;var C=k.freq+x/2;x=w/m>>0;C=C/m>>0;var B=0;for(w=x;w<C;++w)w*m<k.freq?++B:--B,x=B/(z/2),u[w]+=x*x*x*x*x*k.gain}else if("highpass"===k.type){w=k.freq-x;x=w/m>>0;C=k.freq/m>>0;for(w=0;w<x;++w)u[w]=-35;B=z;for(w=x;w<C;++w)--B,u[w]-=35*h(B/z)}else if("lowpass"===k.type){C=k.freq+x;x=k.freq/m>>0;for(w=C=C/m>>0;w<f;++w)u[w]=-35;B=0;for(w=x;w<C;++w)++B,u[w]-=35*h(B/z)}}function t(k){var u=k.ui.canvas_eq,w=0,x=!1,z=function(D){if(x&&k.act){if(D.touches){if(1<D.touches.length)return;var G=
D.touches[0].clientX;var K=D.touches[0].clientY}else G=D.clientX,K=D.clientY;var H=u.getBoundingClientRect();D=u.height;G-=H.left;K-=H.top;H=G/u.width;k.act._coords.x=G;k.act._coords.y=K;G=.5>=H?1E4*H>>0:5E3+(3E4*(H-.5)>>0);D=(-70*(K/D-.5)).toFixed(2)/1;n(k,k.act,{freq:G,gain:D});y(k.act)}},C=function(D){x=!1;u.removeEventListener("mousemove",z);u.removeEventListener("mouseup",C);u.removeEventListener("touchmove",z);u.removeEventListener("touchup",C)},B=function(D){var G=!!k.act;if(0===k.ranges.length)G&&
k.Render();else{var K=u.getBoundingClientRect(),H=D.clientX-K.left;K=D.clientY-K.top;for(var P=D.is_touch?20:10,Q=D.is_touch?20:9,X=0;X<k.ranges.length;++X){var Y=k.ranges[X];if(Math.abs(Y._coords.x-H)<P&&Math.abs(Y._coords.y-K)<Q){G&&k.act.el.classList.remove("pk_act");k.act=Y;k.act.el.classList.add("pk_act");x=!0;k.Render();D.is_touch?(D.ev.preventDefault(),D.ev.stopPropagation(),u.addEventListener("touchmove",z,!1),u.addEventListener("touchup",C,!1)):(u.addEventListener("mousemove",z,!1),u.addEventListener("mouseup",
C,!1));return}}G&&(k.act.el.classList.remove("pk_act"),k.act=null,k.Render())}};u.addEventListener("mousedown",B,!1);u.addEventListener("touchstart",function(D){1<D.touches.length?(D.preventDefault(),D.stopPropagation()):B({clientX:D.touches[0].clientX,clientY:D.touches[0].clientY,is_touch:!0,ev:D})});u.addEventListener("click",function(D){if(260>D.timeStamp-w){var G=u.getBoundingClientRect(),K=u.height,H=D.clientX-G.left;G=D.clientY-G.top;var P=H/u.width;P=.5>=P?1E4*P>>0:5E3+(3E4*(P-.5)>>0);K=(-70*
(G/K-.5)).toFixed(2)/1;k.Add("peaking",!0,P,K,5,H,G)}w=D.timeStamp},!1)}function v(k,u,w){var x=k.ui.el_list,z=A.createElement("div");z.className="pk_pgeq_els"+(w?w:"");z.setAttribute("data-id",u.id);z.addEventListener("click",function(D){u.el&&u!==k.act&&(k.act&&k.act.el.classList.remove("pk_act"),k.act=u,k.act.el.classList.add("pk_act"),k.Render())},!1);z.addEventListener("mouseover",function(D){u.el&&!u._hov&&(u._hov=!0,k.Render())},!1);z.addEventListener("mouseleave",function(D){u.el&&u._hov&&
(u._hov=!1,k.Render())},!1);w=u._on?"checked":"";var C="<i>"+u.id+"</i>",B=A.createElement("div");B.className="pk_txlft";B.innerHTML=C+'<input type="checkbox" id="pgon'+u.id+'" class="pk_check" name="onoff" '+w+'><label for="pgon'+u.id+'">ON</label>';B.getElementsByTagName("input")[0].onchange=function(D){n(k,u,{_on:!!this.checked});this.parentNode.getElementsByTagName("label")[0].innerHTML=this.checked?"ON":"OFF"};z.appendChild(B);w="lowpass"===u.type?"selected":"";C="highpass"===u.type?"selected":
"";B=A.createElement("div");B.innerHTML="<select><option>peaking</option><option "+w+">lowpass</option><option "+C+">highpass</option></select>";B.getElementsByTagName("select")[0].onchange=function(D){D=this.options[this.selectedIndex].value;"peaking"===D?z.classList.remove("pk_dis"):z.classList.add("pk_dis");n(k,u,{type:D},1)};z.appendChild(B);w=A.createElement("div");w.innerHTML='<input type="number" class="pk_val pk_gain" min="-35" max="35" value="'+u.gain+'">';w.getElementsByClassName("pk_gain")[0].onchange=
function(D){this.value||(this.value=0);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);n(k,u,{gain:this.value/1},1);y(u)};w.getElementsByClassName("pk_gain")[0].onfocus=function(D){if(!this.hasAttribute("data-open")){var G=this,K=this.parentNode,H=document.createElement("div");H.className="pk_pgeq_freq pk_gain";H.innerHTML='<div class="pk_arr"></div><input type="range" min="-35" max="35" class="pk_horiz pk_gain" step="0.1" value="'+u.gain+'">';
H.getElementsByClassName("pk_horiz")[0].oninput=function(Q){G.value!=this.value&&(G.value=this.value,G.onchange())};K.appendChild(H);this.setAttribute("data-open","1");var P=function(Q){if(!Q.target.classList.contains("pk_gain")||Q.target.type===G.type&&Q.target!==G)G.removeAttribute("data-open"),K.removeChild(H),k.el.removeEventListener("mousedown",P)};k.el.addEventListener("mousedown",P,!1)}};z.appendChild(w);w=A.createElement("div");w.innerHTML='<input type="number" class="pk_val pk_freq" min="16" max="20000" value="'+
u.freq+'">';w.getElementsByClassName("pk_freq")[0].onchange=function(D){this.value||(this.value=500);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);n(k,u,{freq:this.value/1},1);y(u)};w.getElementsByClassName("pk_freq")[0].onfocus=function(D){if(!this.hasAttribute("data-open")){var G=this,K=this.parentNode,H=document.createElement("div");H.className="pk_pgeq_freq pk_freq";H.innerHTML='<div class="pk_arr"></div><input type="range" min="16" max="20000" class="pk_horiz pk_freq" step="1" value="'+
u.freq+'">';H.getElementsByClassName("pk_horiz")[0].oninput=function(Q){G.value!=this.value&&(G.value=this.value,G.onchange())};K.appendChild(H);this.setAttribute("data-open","1");var P=function(Q){if(!Q.target.classList.contains("pk_freq")||Q.target.type===G.type&&Q.target!==G)G.removeAttribute("data-open"),K.removeChild(H),k.el.removeEventListener("mousedown",P)};k.el.addEventListener("mousedown",P,!1)}};z.appendChild(w);w=A.createElement("div");w.innerHTML='<input type="number" class="pk_val pk_q" min="1" max="50" value="'+
u.q+'">';w.getElementsByClassName("pk_q")[0].onchange=function(D){this.value||(this.value=1);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);n(k,u,{q:this.value/1},1);y(u)};w.getElementsByClassName("pk_q")[0].onfocus=function(D){if(!this.hasAttribute("data-open")){var G=this,K=this.parentNode,H=document.createElement("div");H.className="pk_pgeq_freq pk_q";H.innerHTML='<div class="pk_arr"></div><input type="range" min="1" max="50" class="pk_horiz pk_q" step="0.1" value="'+
u.q+'">';H.getElementsByClassName("pk_horiz")[0].oninput=function(Q){G.value!=this.value&&(G.value=this.value,G.onchange())};K.appendChild(H);this.setAttribute("data-open","1");var P=function(Q){if(!Q.target.classList.contains("pk_q")||Q.target.type===G.type&&Q.target!==G)G.removeAttribute("data-open"),K.removeChild(H),k.el.removeEventListener("mousedown",P)};k.el.addEventListener("mousedown",P,!1)}};z.appendChild(w);w=A.createElement("div");w.className="pk_del";w.innerHTML='<a style="cursor:pointer">DELETE</a>';
w.getElementsByTagName("a")[0].onclick=function(D){k.Remove(u)};z.appendChild(w);x.appendChild(z);return z}function c(k,u){return"peaking"===k.type&&"peaking"!==u.type?-1:"peaking"===u.type&&"peaking"!==k.type?1:0}var l=this,d=0,g=!1,p=!1;l.act=null;l.ranges=[];l.ui={};this.Callback=function(){};this.Init=function(k){this.el=k;var u=A.createElement("div");u.className="pk_row";k=A.createElement("canvas");var w=A.createElement("canvas");k.className="pk_peq2";w.className="pk_peq";k.width=225;k.height=
112;w.width=450;w.height=225;var x=k.getContext("2d",{alpha:!0,antialias:!1}),z=w.getContext("2d",{alpha:!0,antialias:!1});x.fillStyle="#365457";z.strokeStyle="#FF0000";z.shadowColor="#FF2222";z.shadowBlur=0;var C=A.createElement("div");C.className="pk_peq3 pk_noselect";C.innerHTML='<span>32</span><span style="position:absolute;left:3.5%">500<span></span></span><span style="position:absolute;left:9%">1k<span></span></span><span style="position:absolute;left:19%">2k<span></span></span><span style="position:absolute;left:38%">4k<span></span></span><span style="position:absolute;left:50%">5k<span></span></span><span style="position:absolute;left:59%">8k<span></span></span><span style="position:absolute;left:72%">12k<span></span></span><span style="position:absolute;left:85%">16k<span></span></span><span style="float:right">20k</span>';
var B=A.createElement("div");B.className="pk_peq4 pk_noselect";B.innerHTML='<span style="top:0">35</span><span style="top:10%">28<span></span></span><span style="top:20%">21<span></span></span><span style="top:30%">14<span></span></span><span style="top:40%">7<span></span></span><span>0<span></span></span><span style="top:60%">-7<span></span></span><span style="top:70%">-14<span></span></span><span style="top:80%">-21<span></span></span><span style="top:90%">-28<span></span></span><span style="top:100%">35</span>';
u.appendChild(k);u.appendChild(w);u.appendChild(C);u.appendChild(B);this.el.appendChild(u);u=document.createElement("div");u.className="pk_row pk_noselect pk_pglst";u.innerHTML='<div class="pk_pgeq_els"><span class="pk_txlft"> #</span><span>type</span><span>gain</span><span>freq</span><span>Q</span></div>';this.el.appendChild(u);this.ui.ctx_bars=x;this.ui.ctx_eq=z;this.ui.canvas_bars=k;this.ui.canvas_eq=w;this.ui.el_list=u;t(this);this.Render()};this.Add=function(k,u,w,x,z,C,B){k={id:++d,type:k?k:
"peaking",freq:w||0,gain:x||0,q:z||5,_on:u,_hov:!1,_el:null,_coords:{x:C||0,y:B||0},_arr:[]};this.ranges.push(k);this.ranges.sort(c);this.act&&this.act.el.classList.remove("pk_act");this.act=k;y(k);k.el=v(this,k," pk_act");this.Callback&&this.Callback();this.Render()};this.Remove=function(k){for(var u=this.ranges.length;0<u--;)if(this.ranges[u]===k){this.ranges.splice(u,1);break}k.el&&(k.el.parentNode.removeChild(k.el),k.el=null);this.act&&this.act===k&&(this.act=null);this.Render()};var q=function(){g=
!1;var k=l.ui.ctx_eq,u=l.ui.canvas_eq,w=u.width,x=u.height;u=x/2;k.clearRect(0,0,w,x);k.fillStyle="#d9d955";if(0===l.ranges.length)k.beginPath(),k.moveTo(0,u),k.lineTo(w,u),k.stroke();else{var z=!0;for(x=0;x<f;++x);for(var C=0;C<l.ranges.length;++C){var B=l.ranges[C];if(B._on)if(z)for(z=!1,x=0;x<f;++x)e[x]=B._arr[x];else for(x=0;x<f;++x)e[x]+=B._arr[x]}if(z)k.beginPath(),k.moveTo(0,u),k.lineTo(w,u);else{k.beginPath();k.moveTo(0,u-u/35*e[0]);for(x=0;x<f/4;x+=1)z=e[x],C=w/f*x*2,z=u-u/35*z,k.lineTo(C,
z);B=0;for(x=f/4;x<f;x+=3)z=e[x],B+=2,C=w/f*(f/2+B),z=u-u/35*z,k.lineTo(C,z)}k.stroke();for(C=0;C<l.ranges.length;++C)B=l.ranges[C],w=B._coords.x,u=B._coords.y,k.beginPath(),k.arc(w,u,6,0,2*Math.PI,!1),B===l.act?(k.shadowBlur=24,k.fillStyle=B._on?"#fff":"#686868",k.stroke(),k.fill(),k.shadowBlur=0,k.fillStyle="#d9d955"):B._hov?(k.fillStyle=B._on?"blue":"darkblue",k.stroke(),k.fill(),k.fillStyle="#d9d955"):B._on?k.fill():(k.fillStyle="#555",k.fill(),k.fillStyle="#d9d955")}};this.Render=function(){g||
(g=!0,requestAnimationFrame(q))};this.RenderBars=function(k,u){var w=this;p||(p=!0,requestAnimationFrame(function(){p=!1;if(u){var x=w.ui.ctx_bars,z=w.ui.canvas_bars,C=z.width;z=z.height;x.clearRect(0,0,C,z);C=(C/234).toFixed(1)/1;for(var B,D=0,G=0;117>G;++G)B=u[G],B=B/256*z>>0,x.fillRect(D,z-B,C,B),D+=C;for(G=0;117>G;++G)B=u[117+(3.34*G>>0)],B=B/256*z>>0,x.fillRect(D,z-B,C,B),D+=C}}))};var e=Array(1E3),a=null,b=2E4,f=1E3,m=b/f>>0}PKAudioEditor._deps.FxEQ=function(n,h){n.fireEvent("RequestSelect",
1);var y=new r,t=function(c,l){y.RenderBars(c,l)},v=function(){if(y){for(var c=[],l=y.ranges,d=0;d<l.length;++d){var g=l[d];g._on&&c.push({type:g.type,freq:g.freq,val:g.gain,q:g.q})}return c}};(new PKAudioFXModal({id:"paragraphic_eq",title:"Paragraphic EQ",ondestroy:function(c){n.stopListeningFor("DidAudioProcess",t);n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc");y=null},preview:function(c){n.fireEvent("RequestActionFX_PREVIEW_PARAMEQ",v())},body:"",presets:[{name:"Old Telephone",
val:"1,highpass,0,5800,5.8,1,lowpass,0,7060,5"}],custom_pres:h.Get("paragraphic_eq"),onpreset:function(c){for(var l=y.ranges.length;0<l--;)y.Remove(y.ranges[l]);var d=y.ui.canvas_eq;l=d.width;d=d.height;c=c.split(",");for(var g=c.length/5>>0,p=0;p<g;++p){var q=[],e=5*p;q[0]=!!(c[e+0]/1);q[1]=c[e+1];q[2]=c[e+2]/1;q[3]=c[e+3]/1;q[4]=c[e+4]/1;e=5E3>q[3]?q[3]/5E3*(l/2):(l/2+(q[3]-5E3)/15E3*(l/2)).toFixed(1)/1;var a="peaking"===q[1]?((1-(q[2]/1+35)/70)*d).toFixed(1)/1:(d/2).toFixed(1)/1;y.Add(q[1],!!q[0],
q[3]/1,q[2]/1,q[4]/1,e,a)}},buttons:[{title:"Apply EQ",clss:"pk_modal_a_accpt",callback:function(c){n.fireEvent("RequestActionFX_PARAMEQ",v());c.Destroy()}}],setup:function(c){y.Init(c.el_body);y.Callback=function(){n.fireEvent("RequestActionFX_UPDATE_PREVIEW",v())};n.listenFor("DidAudioProcess",t);n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(l){n.ui.InteractionHandler.check("modalfx")&&c.Destroy()},[27])}},n)).Show()};
PKAudioEditor._deps.FxTMP=function(n){n.fireEvent("RequestSelect",1);var h=1,y=null,t=function(c,l){function d(G){var K=G.body.getElementsByClassName("pk_horiz")[0],H=G.body.getElementsByClassName("pk_val")[0],P=G.body.getElementsByClassName("pk_horiz")[1],Q=G.body.getElementsByClassName("pk_val")[1],X=G.body.getElementsByClassName("pk_check")[0];K.oninput=function(){q=K.value/1;H.innerHTML=q;b=60/q*1E3>>0};P.oninput=function(){var aa=P.value/1;w=aa;Q.innerHTML=(100*aa>>0)+"%"};X.oninput=function(){x=
X.checked};var Y=G.body.getElementsByClassName("pk_modal_a_bottom")[0],L=G.body.getElementsByClassName("pk_modal_a_bottom")[1],V=G.body.getElementsByClassName("pk_modal_a_bottom")[2];Y.onclick=function(){if(e)clearTimeout(e),e=null,a=0,G.app.fireEvent("DidStopMetro");else{var aa=function(){e=setTimeout(function(){e&&(0===++a%4?g(1):g(0),aa())},b)};a=0;u||(f=new (window.AudioContext||window.webkitAudioContext),m=f.createOscillator(),k=f.createGain(),k.gain.value=0,m.connect(k),k.connect(f.destination),
m.start(0),u=!0);G.app.fireEvent("DidStartMetro");g(1);aa()}};D=function(){Y.classList.remove("pk_act")};B=function(){Y.classList.add("pk_act")};G.app.listenFor("DidStartMetro",B);G.app.listenFor("DidStopMetro",D);L.onclick=function(){PKAudioEditor.engine.wavesurfer.isPlaying()?G.app.fireEvent("RequestStop"):G.app.fireEvent("RequestPlay")};PKAudioEditor.engine.wavesurfer.isReady||(L.className+=" pk_inact",V.className+=" pk_inact");PKAudioEditor.engine.wavesurfer.isPlaying()&&(L.className+=" pk_act");
z=function(){L.classList.remove("pk_act");L.innerText="Play Track"};C=function(){L.classList.add("pk_act");L.innerText="Stop Track"};G.app.listenFor("DidStopPlay",z);G.app.listenFor("DidPlay",C);V.onclick=function(){if(e)Y.onclick();if(PKAudioEditor.engine.wavesurfer.isPlaying())L.onclick();setTimeout(function(){e||PKAudioEditor.engine.wavesurfer.isPlaying()||(L.onclick(),setTimeout(function(){Y.onclick()},0))},66)}}function g(G){m.frequency.value=1===G&&x?880:440;k.gain.setValueAtTime(k.gain.value,
f.currentTime);k.gain.linearRampToValueAtTime(w,f.currentTime+.01);k.gain.linearRampToValueAtTime(0,f.currentTime+.12)}var p=this;p.app=c;var q=120,e=null,a=0,b=60/q*1E3>>0,f=null,m=null,k=null,u=!1,w=.5,x=!0,z=null,C=null,B=null,D=null;p.Init=function(G){this.el=G;G=A.createElement("div");G.className="pk_row";G.innerHTML='<div class="pk_row"><label>BPM</label><input type="range" min="20" max="300" class="pk_horiz" step="1" value="120" /><span class="pk_val">120</span></div><div class="pk_row"><label>Volume</label><input type="range" min="0.0" max="1.0" class="pk_horiz" step="0.1" value="0.5" /><span class="pk_val">50%</span></div><div class="pk_row"><input type="checkbox" id="xxcjgs" class="pk_check" checked name="metroAccent"><label for="xxcjgs">Accentuate metronome click</label></div><div class="pk_row"><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Metronome</a><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Play Track</a><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Play Both</a></div>';
this.body=G;this.el.appendChild(G);d(this)};p.Destroy=function(){p.app.stopListeningFor("DidStopPlay",z);p.app.stopListeningFor("DidPlay",C);p.app.stopListeningFor("DidStartMetro",B);p.app.stopListeningFor("DidStopMetro",D);D=B=C=z=null;u&&(e&&(clearTimeout(e),e=null),f&&(m.stop(f.currentTime),k.disconnect(),m.disconnect(),f=null,u=!1));p.body&&(p.body.parentNode.removeChild(p.body),p.body=null);p.app=null}},v=function(c,l){function d(b){var f=b.body.querySelectorAll("#pk_tmp_tap")[0],m=b.body.querySelectorAll("#pk_tmp_tap3")[0],
k=b.body.getElementsByClassName("pk_modal_a_bottom")[0],u=b.body.getElementsByClassName("pk_modal_a_bottom")[1],w=b.body.getElementsByClassName("pk_modal_a_bottom")[2],x=b.body.getElementsByTagName("canvas")[0],z=x.getContext("2d",{alpha:!1,antialias:!1}),C=document.createElement("canvas");C.width=1E3;C.height=200;var B=C.getContext("2d",{alpha:!1,antialias:!1});z.imageSmoothingEnabled=!0;B.imageSmoothingEnabled=!0;var D=b.body.getElementsByClassName("pk_val"),G=f.getElementsByClassName("pk_obj2");
m.getElementsByTagName("span");var K=D[0],H=D[1],P=D[2],Q=0,X=0,Y=0,L=0,V=0,aa=0,ba=!0,da=!1,fa=function(M){ba&&(G[1].style.opacity="0");aa=L=0;ba=!0;setTimeout(function(){ba&&(G[0].style.opacity="0.5",M||(k.className+=" pk_act",setTimeout(function(){k.classList.remove("pk_act")},140)),setTimeout(function(){ba?(G[0].style.opacity="0",G[1].style.opacity="0.5"):(G[0].style.opacity="0",G[1].style.opacity="0")},M?490:874))},M?0:150);if(M){K.value="-";H.value="-";P.value="-";for(var S=f.parentNode.getElementsByClassName("pk_obj"),
J=S.length;0<J--;)S[J]&&S[J].parentNode.removeChild(S[J])}};k.onclick=function(){fa(!0)};u.onclick=function(){PKAudioEditor.engine.wavesurfer.isPlaying()?b.app.fireEvent("RequestStop"):b.app.fireEvent("RequestPlay")};PKAudioEditor.engine.wavesurfer.isReady||(u.className+=" pk_inact",w.className+=" pk_inact");PKAudioEditor.engine.wavesurfer.isPlaying()&&(u.className+=" pk_act");p=function(){da=!1;u.classList.remove("pk_act");u.innerText="Play Track"};q=function(){da=!0;u.classList.add("pk_act");u.innerText=
"Stop Track"};b.app.listenFor("DidStopPlay",p);b.app.listenFor("DidPlay",q);var ja=-999999,ea=[],U=0;a=function(){var M=PKAudioEditor.engine.wavesurfer,S=M.backend.buffer,J=S.getChannelData(0),T=S.sampleRate,Z=M.getCurrentTime(),I=500,N=0;S=M=0;var O=Z-1.5,R=Z+1.5;Z=!1;var W=O*T>>0,ca=(((O+3)*T>>0)-W)/500>>0;if(O<ja&&(S=(R-ja)/3*500,M=Math.round(S),S=(1E3*S>>0)/1E3,0<=M)){if(0===M)return;I=M;W=ja*T>>0;ca=((R*T>>0)-W)/M>>0;ea=ea.slice(2*M);N=500-M;Z=!0}ja=R;for(T=0;T<I;++T){var ha=W+ca*T;R=O=0;if(0<=
ha)for(var ia=0;ia<ca;ia+=3)J[ha+ia]>O?O=J[ha+ia]:J[ha+ia]<R&&(R=J[ha+ia]);ea[2*(T+N)]=O;ea[2*(T+N)+1]=R}Z&&B.drawImage(x,0,0);z.fillStyle="#000";z.fillRect(0,0,1E3,200);z.fillStyle="#99c2c6";if(Z){J=Math.round(2*S);U+=J-2*S;1<U&&(--J,U=0);z.translate(-J,0);z.drawImage(C,0,0);z.setTransform(1,0,0,1,0,0);z.beginPath();J=ea[2*(500-M-2)];J=Math.round(100*J);z.moveTo(2*(500-M-2),100-J);for(T=500-M-1;500>T;++T)J=ea[2*T],J=Math.round(100*J),z.lineTo(2*T,100-J);for(T=499;T>=500-M-1;--T)J=ea[2*T+1],J=Math.round(100*
J),z.lineTo(2*T,100-J)}else{z.beginPath();z.moveTo(0,100);for(T=0;500>T;++T)J=ea[2*T],J=Math.round(100*J),z.lineTo(2*T,100-J);for(T=499;0<=T;--T)J=ea[2*T+1],J=Math.round(100*J),z.lineTo(2*T,100-J)}z.closePath();z.fill()};b.app.listenFor("DidAudioProcess",a);PKAudioEditor.engine.wavesurfer.regions.list[0]&&PKAudioEditor.engine.wavesurfer.regions.list[0].loop&&(w.className+=" pk_act");w.onclick=function(){b.app.fireEvent("RequestSetLoop")};e=function(M){M?w.classList.add("pk_act"):w.classList.remove("pk_act")};
b.app.listenFor("DidSetLoop",e);f.parentNode.addEventListener("transitionend",function(M){f&&(M=M.target,"DIV"===M.tagName&&(M.parentNode.removeChild(M),--aa,0===aa&&(da?setTimeout(function(){0===aa&&fa()},1100):fa())))});m.onclick=function(M){M&&(M.preventDefault(),M.stopPropagation());ba&&(ba=!1,G[1].style.opacity="0");Q=Date.now();3E3<Q-X&&(L=0);0===L?(Y=Q,L=1,K.value="First Beat",H.value="First Beat"):(V=6E4*L/(Q-Y),++L,K.value=Math.round(100*V)/100,H.value=Math.round(V));P.value=L;var S=document.createElement("div");
S.className="pk_obj";da?x.parentNode.appendChild(S):f.appendChild(S);++aa;m.classList.add("pk_act");requestAnimationFrame(function(){S.style.transform="translate3d(-10%,0,0)";setTimeout(function(){m.classList.remove("pk_act")},56)});X=Q};c.ui.KeyHandler.addCallback("tmpTap",function(M,S,J){c.ui.InteractionHandler.check("modalfx")&&(J.preventDefault(),J.stopPropagation(),m.onclick(null))},[32])}var g=this;g.app=c;var p=null,q=null,e=null,a=null;g.Init=function(b){this.el=b;b=A.createElement("div");
b.className="pk_row";b.innerHTML='<div class="pk_row pk_pgeq_els"><span>Average BPM</span><input style="margin-left:2px;min-width:64px;max-width:64px" type="text" class="pk_val pk_gain" value="-"></div><div class="pk_row pk_pgeq_els"><span>Nearest BPM</span><input style="margin-left:2px;min-width:64px;max-width:64px" type="text" class="pk_val pk_gain" value="-"></div><div class="pk_row pk_pgeq_els"><span>Timing Taps</span><input style="margin-left:2px;min-width:64px;max-width:64px" type="text" class="pk_val pk_gain" value="-"><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Reset</a><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Play Track</a><a class="pk_modal_a_bottom" style="display:inline-block;float:none">Loop</a></div><div><div id="pk_tmp_tap"><span style="opacity:0" class="pk_obj2">CLEARED...</span><span class="pk_obj2">STAND BY...</span></div><div id="pk_tmp_tap2" style="position:relative"><canvas width="1000" height="200" style="image-rendering:pixelated;width:500px;height:100px;display:block;background:#000"></canvas><span style="z-index:3;background:red;position:absolute;display:block;width:2px;height:100px;left:50%;margin-left:-1px;top:0"></span></div></div><div id="pk_tmp_tap3"><span style="position:absolute;top:50%;display:block;width:80%;left:10%;font-size:12px;margin-top:-20px;user-select:none;text-align:center;pointer-events:none;color:#ccc">Tap in this area, or hit [SPACE] rhythmically, to measure BPM.</span></div>';
this.body=b;this.el.appendChild(b);d(this)};g.Destroy=function(){g.app.stopListeningFor("DidStopPlay",p);g.app.stopListeningFor("DidPlay",q);g.app.stopListeningFor("DidSetLoop",e);g.app.stopListeningFor("DidAudioProcess",a);a=e=q=p=null;g.app.ui.KeyHandler.removeCallback("tmpTap");g.body&&(g.body.parentNode.removeChild(g.body),g.body=null);g.app=null}};(new PKAudioFXModal({id:"tempo_tools",title:"Tempo & Rhythm Tools",ondestroy:function(c){n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc");
y.Destroy();y=null;n.fireEvent("RequestStop")},body:'<div class="pk_tbs"><a class="pk_tbsa pk_inact">Tempo Estimation</a><a class="pk_tbsa">Tempo Tap</a><a class="pk_tbsa">Metronome</a></div>',setup:function(c){var l=c.el_body.getElementsByClassName("pk_tbsa"),d=function(){y&&(y.Destroy(),y=null,l[h].classList.remove("pk_act"))},g=function(){0!==h&&(1===h?(l[1].className+=" pk_act",y=new v(n,c)):2===h&&(l[2].className+=" pk_act",y=new t(n,c)),y&&y.Init(c.el_body))};l[1].onclick=function(){1!==h&&
(d(),h=1,g())};l[2].onclick=function(){2!==h&&(d(),h=2,g())};g();n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(p){n.ui.InteractionHandler.check("modalfx")&&c.Destroy()},[27])}},n)).Show()};PKAudioEditor._deps.FxREC=function(n){var h=null,y=null,t=null,v=null,c=[],l=null,d=44100,g=function(){h&&(h.getTracks().forEach(function(p){p.stop()}),t&&(t.onaudioprocess=null),v&&v.disconnect(),t&&t.disconnect(),y=h=v=null)};(new PKAudioFXModal({id:"rec_tools",
title:"New Recording",ondestroy:function(p){g();c=[];l=null;n.ui.InteractionHandler.on=!1;n.ui.KeyHandler.removeCallback("modalfxesc");n.fireEvent("RequestStop")},body:'<div class="pk_rec" style="user-select:none"><div class="pk_row"><label>Devices:</label><select style="max-width:220px"></select></div><div class="pk_row"><div style="float:left"><label>Volume</label><canvas width="200" height="40"></canvas></div><div style="float:left;margin-left:20px;"><label>Time</label><span style="font-size: 24px;line-height: 50px;">0.0</span></div><div style="clear:both;height:10px"></div><div><label>Waveform</label><canvas width="1000" height="200" style="image-rendering:pixelated;width:500px;height:100px;display:block;background:#000"></canvas></div></div><div class="pk_row"><a class="pk_tbsa pk_inact" style="text-align: center;">START RECORDING</a><a class="pk_tbsa pk_inact" style="margin-left: 24px; text-align: center;">PAUSE</a></div><div class="pk_row"><a class="pk_tbsa" style="float:left;display:none;text-align:center;box-shadow:0 0 7px #3a6b79 inset;">OPEN RECORDING</a><a class="pk_tbsa" style="float:left;display:none;margin-left: 24px; text-align: center;">APPEND TO EXISTING</a></div></div>',
setup:function(p){var q=!1,e=!1,a=!1,b=!1,f=p.el_body.getElementsByClassName("pk_tbsa"),m=f[0],k=f[1],u=f[2],w=f[3],x=p.el_body.getElementsByTagName("span")[0],z=p.el_body.getElementsByTagName("select")[0],C=p.el_body.getElementsByTagName("canvas")[0].getContext("2d",{alpha:!1,antialias:!1}),B=p.el_body.getElementsByTagName("canvas")[1],D=B.getContext("2d",{alpha:!1,antialias:!1}),G=document.createElement("canvas");G.width=1E3;G.height=200;var K=G.getContext("2d",{alpha:!1,antialias:!1}),H=12,P=-1,
Q=0,X=0,Y=!1,L=-999999,V=[],aa=0,ba=!1;c=[];l=null;var da=function(){C.fillStyle="#000";C.fillRect(0,0,200,40);e&&(C.fillStyle="green",C.fillRect(0,0,334*Q,40),x.innerText=(10*X>>0)/10,window.requestAnimationFrame(da))},fa=function(U){if(0<H)--H;else if(!a){U=U.inputBuffer.getChannelData(0).slice(0);c[++P]=U;for(var M=0,S,J=0;2048>J;J+=2)S=U[J],M+=S*S;Q=Math.max(Math.sqrt(M/1024),.9*Q);X=J=2048*P/d;S=500;var T=0;M=U=0;var Z=J-3,I=!1,N=Z*d>>0,O=(Z+3)*d>>0;O=(O-N)/500>>0;if(Z<L&&(M=(J-L)/3*500,U=Math.round(M),
M=(1E3*M>>0)/1E3,0<=U)){if(0===U)return;S=U;N=L*d>>0;O=J*d>>0;O=(O-N)/U>>0;V=V.slice(2*U);T=500-U;I=!0}L=J;for(J=0;J<S;++J){var R=N+O*J;var W=Z=0;if(0<=R)for(var ca=0;ca<O;ca+=3){var ha=R+ca,ia=ha/2048>>0;ha%=2048;c[ia]&&(c[ia][ha]>Z?Z=c[ia][ha]:c[ia][ha]<W&&(W=c[ia][ha]))}V[2*(J+T)]=Z;V[2*(J+T)+1]=W}I&&K.drawImage(B,0,0);D.fillStyle="#000";D.fillRect(0,0,1E3,200);D.fillStyle="#99c2c6";if(I){J=Math.round(2*M);aa+=J-2*M;1<aa&&(--J,aa=0);D.translate(-J,0);D.drawImage(G,0,0);D.setTransform(1,0,0,1,0,
0);D.beginPath();M=V[2*(500-U-2)];M=Math.round(100*M);D.moveTo(2*(500-U-2),100-M);for(J=500-U-1;500>J;++J)M=V[2*J],M=Math.round(100*M),D.lineTo(2*J,100-M);for(J=499;J>=500-U-1;--J)M=V[2*J+1],M=Math.round(100*M),D.lineTo(2*J,100-M)}else{D.beginPath();D.moveTo(0,100);for(J=0;500>J;++J)M=V[2*J],M=Math.round(100*M),D.lineTo(2*J,100-M);for(J=499;0<=J;--J)M=V[2*J+1],M=Math.round(100*M),D.lineTo(2*J,100-M)}D.closePath();D.fill()}};navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(U){U.getTracks().forEach(function(M){M.stop()});
ja()})["catch"](function(U){alert("no microphone permissions found!")});var ja=function(){navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(U){U=U.filter(function(T){return"audioinput"===T.kind});Y=!0;for(var M=U.length,S=0;S<M;++S){var J=document.createElement("option");J.value=U[S].deviceId;J.innerText=U[S].label;z.appendChild(J)}q=!0;m.classList.remove("pk_inact")}):(z.parentNode.style.display="none",Y=!1,q=!0,m.classList.remove("pk_inact"))},ea=function(){g();
a=e=!1;H=10;++P;var U=-1;l=new Float32Array(2048*P);for(var M=0;M<P;++M)for(var S=0;2048>S;++S)l[++U]=c[M][S];P=-1;c=[];u.style.display="block";n.engine.is_ready&&(w.style.display="block");b=!0};m.onclick=function(){if(q&&!ba&&(ba=!0,setTimeout(function(){ba=!1},260),!b||window.confirm("Are you sure? This will discard the current recording.")))if(e)ea(),k.classList.add("pk_inact"),m.innerText="START RECORDING",m.style.boxShadow="none";else{P=-1;c=[];l=null;Q=0;u.style.display="none";w.style.display=
"none";y=new (window.AudioContext||window.webkitAudioContext);d=y.sampleRate;var U=!0;Y&&(U={deviceId:z.value});navigator.mediaDevices.getUserMedia({audio:U}).then(function(M){h=M;v=y.createMediaStreamSource(M);t=y.createScriptProcessor(2048,1,1);v.connect(t);t.connect(y.destination);e=!0;k.classList.remove("pk_inact");m.innerText="FINISH RECORDING";m.style.boxShadow="#992222 0px 0px 6px inset";t.onaudioprocess=fa;da()})["catch"](function(M){})}};k.onclick=function(){q&&e&&(a=!a,k.innerText=a?"UN-PAUSE":
"PAUSE")};u.onclick=function(){ba||(ba=!0,setTimeout(function(){ba=!1},150),n.engine.wavesurfer.backend._add=0,n.engine.LoadDB({samplerate:d,data:[l.buffer]}),p.Destroy())};w.onclick=function(){ba||(ba=!0,setTimeout(function(){ba=!1},150),n.engine.wavesurfer.backend._add=1,n.engine.LoadDB({samplerate:d,data:[l.buffer]}),p.Destroy())};n.fireEvent("RequestPause");n.ui.InteractionHandler.checkAndSet("modalfx");n.ui.KeyHandler.addCallback("modalfxesc",function(U){n.ui.InteractionHandler.check("modalfx")&&
p.Destroy()},[27])}},n)).Show()}})(window,document,PKAudioEditor);
(function(F,A,E){var r=0,n=0;PKAudioEditor._deps.FxAUT=function(h,y,t,v){function c(g,p){return g.x>p.x?1:-1}function l(g,p){var q=g.wv.regions.list[0],e=0,a=p.duration;q&&(e=q.start,a=q.end-q.start);q=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,8E3*a>>0,8E3);var b=q.createBuffer(1,a*p.sampleRate,p.sampleRate);b.getChannelData(0).set(p.getChannelData(0).slice(e*p.sampleRate/4,(e+a)*p.sampleRate/4));e=q.createBufferSource();e.buffer=b;e.connect(q.destination);e.start(0);var f=
function(m){g.rbuff=m;debugger;g.Render()};(e=q.startRendering())?e.then(f)["catch"](function(m){console.log("Rendering failed: "+m)}):q.oncomplete=function(m){f(m.renderedBuffer)}}var d=this;d.modal=y;d.app=h;d.wv=h.engine.wavesurfer;d.points={};d.act=null;d.act_point=null;d.in_auto=!1;d.rbuff=null;d.btn_auto=function(g){var p=A.createElement("a");p.className="pk_modal_a_bottom";p.innerHTML="AUTOMATE";p.onclick=function(){g.in_auto=!g.in_auto;g.in_auto?p.classList.add("pk_act"):p.classList.remove("pk_act")};
g.modal.el_body.appendChild(p);return p}(d);d.GetValue=function(){for(var g=[],p=d.modal.el_body.getElementsByTagName("input"),q=0;q<p.length;++q){var e=p[q];if(d.points[e.id]){for(var a=[],b=d.points[e.id],f=0;f<b.length;++f){var m={time:b[f].time,val:b[f].val};a.push(m);t&&t(m,e)}g.push(a)}else m={val:e.value},g.push(m),t&&t(m,e)}return g};d.cw=500;d.ch=200;h=function(g){var p=document.createElement("canvas");p.width=500;p.height=200;p.style.background="#000";var q=p.getContext("2d");g.modal.el_body.appendChild(p);
var e=g.wv.backend.buffer,a=new Image;a.onload=function(){q.drawImage(a,0,0)};var b=g.wv.regions.list[0];if(b){var f=b.start*e.sampleRate>>0;var m=b.end*e.sampleRate>>0}l(g,e);a.src=g.app.engine.GetWave(e,500,200,f,m);return[p,q]}(d,d.cw,d.ch);d.canvas=h[0];d.ctx=h[1];d.Render=function(){var g=d.ctx,p=d.cw,q=d.ch;d.rbuff&&d.app.engine.GetWave(d.rbuff,500,200,null,null,d.canvas,d.ctx);g.fillStyle="#d9d955";g.strokeStyle="#FF0000";if(d.act){g.beginPath();g.moveTo(0,q/2);var e=q/2;for(q=0;q<d.points[d.act.id].length;++q){e=
d.points[d.act.id][q];var a=e.ax,b=e.ay;g.lineTo(a,b);e=b}g.lineTo(p,e);g.stroke();for(q=0;q<d.points[d.act.id].length;++q)e=d.points[d.act.id][q],a=e.ax,b=e.ay,g.beginPath(),g.arc(a,b,6,0,2*Math.PI,!1),e===d.act_point?(g.shadowBlur=24,g.fillStyle=e._on?"#fff":"#686868",g.stroke(),g.fill(),g.shadowBlur=0,g.fillStyle="#d9d955"):e._hov?(g.fillStyle=e._on?"blue":"darkblue",g.stroke(),g.fill(),g.fillStyle="#d9d955"):e._on?g.fill():(g.fillStyle="#555",g.fill(),g.fillStyle="#d9d955")}};(function(g){var p=
0;g.canvas.addEventListener("click",function(b){if(g.act){if(260>b.timeStamp-p){var f=g.canvas.getBoundingClientRect(),m=g.cw,k=g.ch,u=(b.clientX-f.left)/m;f=(b.clientY-f.top)/k;g.points[g.act.id]||(g.points[g.act.id]=[]);var w=(w=g.wv.regions.list[0])?w.end-w.start:g.wv.getDuration();g.points[g.act.id].push({id:++r,x:u,y:f,ax:u*m,ay:f*k,time:w*u,val:(1-f)*(g.act.max-g.act.min)+g.act.min,_on:!0,_hov:!1});g.points[g.act.id].sort(c);g.act_point=g.points[g.act.id][g.points[g.act.id].length-1];g.Render()}p=
b.timeStamp}},!1);var q=!1,e=3;g.canvas.addEventListener("mousemove",function(b){if(q&&g.act_point){if(b.touches){if(1<b.touches.length)return;var f=b.touches[0].clientX;b=b.touches[0].clientY}else f=b.clientX,b=b.clientY;var m=g.canvas.getBoundingClientRect();f-=m.left;var k=b-m.top;b=f/g.cw;m=k/g.ch;g.act_point.ax=f;g.act_point.ay=k;g.act_point.x=b;g.act_point.y=m;f=(f=g.wv.regions.list[0])?f.end-f.start:g.wv.getDuration();g.act_point.time=f*b;g.act_point.val=(1-m)*g.act.max-g.act.min+g.act.min;
g.Render();0===--e&&(e=4,l(g,g.wv.backend.buffer))}});g.canvas.addEventListener("mousedown",function(b){q=!1;if(g.act){var f=g.canvas.getBoundingClientRect(),m=b.clientX-f.left;f=b.clientY-f.top;var k=b.is_touch?20:10;b=b.is_touch?20:9;g.points[g.act.id]||(g.points[g.act.id]=[]);for(var u=0;u<g.points[g.act.id].length;++u){var w=g.points[g.act.id][u];if(Math.abs(w.ax-m)<k&&Math.abs(w.ay-f)<b){q=!0;g.act_point=w;g.Render();break}}q||(g.act_point=null,g.Render())}});g.canvas.addEventListener("mouseup",
function(b){q=!1});var a=null;g.modal.el_body.addEventListener("mouseover",function(b){g.in_auto&&"INPUT"===b.target.tagName&&b.target.classList.add("pk_aut")});g.modal.el_body.addEventListener("mouseout",function(b){g.in_auto&&"INPUT"===b.target.tagName&&b.target.classList.remove("pk_aut")});g.modal.el_body.addEventListener("click",function(b){g.in_auto&&b.target.classList.contains("pk_aut")&&(a&&(a.classList.remove("pk_aut_act"),a=null),b.target.classList.add("pk_aut_act"),a=b.target,b.target.id||
(b.target.id="pk"+ ++n),g.act={id:b.target.id,el:b.target,type:b.target.range,min:b.target.min/1,max:b.target.max/1,step:b.target.step/1},g.points[g.act.id]||(g.points[g.act.id]=[]),g.Render())})})(d)}})(window,document,PKAudioEditor);
(function(F,A,E){var r,n={l4z:{ready:!1,loading:!1,compress:null,decompress:null,init:function(h){var y=this;y.loading=!0;var t;lz4BlockCodec.createInstance("wasm").then(function(v){t=v;y.ready=!0;y.loading=!1;y.compress=function(c,l){return t?t.encodeBlock(c,0):c instanceof ArrayBuffer?new Uint8Array(c):c};y.decompress=function(c,l,d){return t?t.decodeBlock(c,0,d):c instanceof ArrayBuffer?new Uint8Array(c):c};h&&h()})}}};PKAudioEditor._deps.fls=function(h){var y=this;y.on=!1;this.Init=function(t){if(y.on)t&&
t();else if(window.indexedDB){var v=indexedDB.open("audiomass",1);v.onerror=function(c){t&&t("err")};v.onupgradeneeded=function(c){c.target.result.createObjectStore("sessions",{keyPath:"id"})};v.onsuccess=function(c){r=c.target.result;r.onerror=function(l){console.log(l)};setTimeout(function(){y.on=!0;t&&t();h.fireEvent("DidOpenDB",y)},120)}}else t&&t("err")};this.SaveSession=function(t,v,c){var l=this,d=n.l4z;if(d.loading||d.ready){for(var g=t.numberOfChannels,p=[],q=[],e,a=t.sampleRate,b=0;b<g;++b)e=
t.getChannelData(b),q.push(e.buffer.byteLength),e=d.compress(e.buffer,0),p.push(e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset));e=null;var f={id:v,name:c,created:(new Date).getTime(),data:p,data2:q,durr:t.duration.toFixed(3)/1,chans:g,comp:"l4z",thumb:PKAudioEditor.engine.GetWave(t),samplerate:a};d=r.transaction(["sessions"],"readwrite");d.objectStore("sessions").add(f).onerror=function(m){h.fireEvent("ErrorDB",m);console.log("error storing data");console.error(m)};d.oncomplete=function(m){h.fireEvent("DidStoreDB",
f,m)}}else d.init(function(){l.SaveSession(t,v,c)})};this.GetSession=function(t,v){r.transaction(["sessions"],"readonly").objectStore("sessions").get(t).onsuccess=function(c){var l=c.target.result;if(l&&l.comp){var d=n.l4z;if(!d.loading&&!d.ready){d.init(function(){for(var q=[],e,a=0;a<l.data.length;++a)e=d.decompress(l.data[a],0,l.data2[a]),q.push(e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset));l.data=q;v&&v(l)});return}c=[];for(var g=null,p=0;p<l.data.length;++p)g=d.decompress(l.data[p],
0,l.data2[p]),c.push(g.buffer.slice(g.byteOffset,g.byteLength+g.byteOffset));g=null;l.data=c}v&&v(l)}};this.DelSession=function(t,v){r.transaction(["sessions"],"readwrite").objectStore("sessions")["delete"](t).onsuccess=function(c){v&&v(t)}};this.ListSessions=function(t){var v=r.transaction(["sessions"],"readonly").objectStore("sessions").openCursor(),c=[];v.onerror=function(l){console.err("error fetching data")};v.onsuccess=function(l){(l=l.target.result)?(c.push(l.value),l["continue"]()):(l=c.sort(function(d,
g){return d.created>g.created?-1:d.created<g.created?1:0}),t&&t(l))}}}})(window,document,PKAudioEditor);
(function(F,A,E){function r(m){switch(m){case 0:var k="iso-8859-1";break;case 1:k="utf-16";break;case 2:k="utf-16be";break;case 3:k="utf-8"}return k}function n(m,k,u,w){var x=g(m,k,!0);if(0==x)return w();var z=d(m,k+4,4);-1<["moov","udta","meta","ilst"].indexOf(z)?("meta"==z&&(k+=4),n(m,k+8,x-8,w)):n(m,k+x,u,w)}function h(m,k,u,w,x){x=void 0===x?"":x+"  ";for(var z=u;z<u+w;){var C=k.getInt32(z);if(0==C)break;var B=d(k,z+4,4);if("meta"===B){z+=4;h(m,k,z+8,C-8,x);break}if("moov"===B||"udta"===B||"ilst"===
B){h(m,k,z+8,C-8,x);break}if(f.atom[B]){var D=p(k,z+16+1,!0),G=f.atom[B];D=f.types[D];if("trkn"===B)m[G[0]]=k.getUint8(z+16+11),m.count=k.getUint8(z+16+13);else{B=z+16+4+4;var K=C-16-4-4;switch(D){case "text":var H=v(k,B,K,"UTF-8");break;case "uint8":H=k;D=B;H=(H.getUint8(D+1)<<8)+H.getUint8(D);0>H&&(H+=65536);break;case "jpeg":case "png":H={format:"image/"+D,data:t(k,B,K)}}m[G[0]]="comment"===G[0]?{text:H}:H}}z+=C}}var y={readUTF16String:function(m,k,u){var w=0,x=1,z=0;u=Math.min(u||m.length,m.length);
254==m[0]&&255==m[1]?(k=!0,w=2):255==m[0]&&254==m[1]&&(k=!1,w=2);k&&(x=0,z=1);k=[];for(var C=0;w<u;C++){var B=m[w+x],D=(B<<8)+m[w+z];w+=2;if(0==D)break;else 216>B||224<=B?k[C]=String.fromCharCode(D):(B=(m[w+x]<<8)+m[w+z],w+=2,k[C]=String.fromCharCode(D,B))}m=new String(k.join(""));m.bytesReadCount=w;return m},readUTF8String:function(m,k){var u=0;k=Math.min(k||m.length,m.length);239==m[0]&&187==m[1]&&191==m[2]&&(u=3);for(var w=[],x=0;u<k;x++){var z=m[u++];if(0==z)break;else if(128>z)w[x]=String.fromCharCode(z);
else if(194<=z&&224>z){var C=m[u++];w[x]=String.fromCharCode(((z&31)<<6)+(C&63))}else if(224<=z&&240>z){C=m[u++];var B=m[u++];w[x]=String.fromCharCode(((z&255)<<12)+((C&63)<<6)+(B&63))}else if(240<=z&&245>z){C=m[u++];B=m[u++];var D=m[u++];z=((z&7)<<18)+((C&63)<<12)+((B&63)<<6)+(D&63)-65536;w[x]=String.fromCharCode((z>>10)+55296,(z&1023)+56320)}}w=new String(w.join(""));w.bytesReadCount=u;return w},readNullTerminatedString:function(m,k){var u=[];k=k||m.length;for(var w=0;w<k;){var x=m[w++];if(0==x)break;
u[w-1]=String.fromCharCode(x)}u=new String(u.join(""));u.bytesReadCount=w;return u}},t=function(m,k,u){for(var w=Array(u),x=0;x<u;x++)w[x]=m.getUint8(k+x);return w},v=function(m,k,u,w){m=t(m,k,u);switch(w.toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":w=y.readUTF16String(m,w);break;case "utf-8":w=y.readUTF8String(m);break;default:w=y.readNullTerminatedString(m)}return w},c={readFrameData:{},frames:{BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",
CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",
TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",
TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",
WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",
OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVAD:"Relative volume adjustment",RVRB:"Reverb",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIT1:"Content group description",
TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMED:"Media type",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",
TPOS:"Part of a set",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",
WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"}},l="32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. lable side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";"),
d=function(m,k,u){for(var w=[],x=k,z=0;x<k+u;x++,z++)w[z]=String.fromCharCode(m.getUint8(x));return w.join("")},g=function(m,k,u){var w=m.getUint8(k),x=m.getUint8(k+1),z=m.getUint8(k+2);m=m.getUint8(k+3);u=u?(((w<<8)+x<<8)+z<<8)+m:(((m<<8)+z<<8)+x<<8)+w;0>u&&(u+=4294967296);return u},p=function(m,k,u){var w=m.getUint8(k),x=m.getUint8(k+1);m=m.getUint8(k+2);u=u?((w<<8)+x<<8)+m:((m<<8)+x<<8)+w;0>u&&(u+=16777216);return u},q=function(m,k,u){return 0!=(m.getUint8(k)&1<<u)},e=function(m,k){var u=k.getUint8(m),
w=k.getUint8(m+1),x=k.getUint8(m+2);return k.getUint8(m+3)&127|(x&127)<<7|(w&127)<<14|(u&127)<<21},a={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]},b=["title","artist","album","track"];c.readFrameData.APIC=function(m,k,u,w,x){x=x||"3";w=m;var z=r(u.getUint8(m));switch(x){case "2":var C=d(u,m+1,3);m+=4;break;case "3":case "4":C=v(u,m+1,k-(m-w),""),m+=
1+C.bytesReadCount}x=u.getUint8(m,1);x=l[x];z=v(u,m+1,k-(m-w),z);m+=1+z.bytesReadCount;return{format:C.toString(),type:x,description:z.toString(),data:t(u,m,w+k-m)}};c.readFrameData.COMM=function(m,k,u){var w=m,x=r(u.getUint8(m)),z=d(u,m+1,3),C=v(u,m+4,k-4,x);m+=4+C.bytesReadCount;m=v(u,m,w+k-m,x);return{language:z,short_description:C.toString(),text:m.toString()}};c.readFrameData.COM=c.readFrameData.COMM;c.readFrameData.PIC=function(m,k,u,w){return c.readFrameData.APIC(m,k,u,w,"2")};c.readFrameData.PCNT=
function(m,k,u){return u.getInteger32At(m)};c.readFrameData.CNT=c.readFrameData.PCNT;c.readFrameData["T*"]=function(m,k,u){var w=r(u.getUint8(m));return v(u,m+1,k-1,w).toString()};c.readFrameData.TCON=function(m,k,u){return c.readFrameData["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};c.readFrameData.TCO=c.readFrameData.TCON;c.readFrameData.USLT=function(m,k,u){var w=m,x=r(u.getUint8(m)),z=d(u,m+1,3),C=v(u,m+4,k-4,x);m+=4+C.bytesReadCount;m=v(u,m,w+k-m,x);return{language:z,descriptor:C.toString(),
lyrics:m.toString()}};c.readFrameData.ULT=c.readFrameData.USLT;c.ReadTags=function(m){var k=new DataView(m),u=0;m=k.getUint8(u+3);if(4<m)return{version:">2.4"};var w=k.getUint8(u+4),x=q(k,u+5,7),z=q(k,u+5,6),C=q(k,u+5,5),B=e(u+6,k);u+=10;if(z){var D=k.getInt32(u,!0);u+=D+4}m={version:"2."+m+"."+w,major:m,revision:w,flags:{unsynchronisation:x,extended_header:z,experimental_indicator:C},size:B};if(x)var G={};else{B-=10;x={};w=m.major;z=b;C=[];D=0;for(var K;K=z[D];D++)C=C.concat(a[K]||[K]);for(z=C;u<
B;){C=null;D=k;K=u;var H=null;switch(w){case 2:G=d(D,K,3);var P=p(D,K+3,!0),Q=6;break;case 3:G=d(D,K,4);P=g(D,K+4,!0);Q=10;break;case 4:G=d(D,K,4),P=e(K+4,D),Q=10}if(""==G)break;u+=Q+P;if(!(0>z.indexOf(G))){if(2<w){H=D;var X=K+8;H={message:{tag_alter_preservation:q(H,X,6),file_alter_preservation:q(H,X,5),read_only:q(H,X,4)},format:{grouping_identity:q(H,X+1,7),compression:q(H,X+1,3),encription:q(H,X+1,2),unsynchronisation:q(H,X+1,1),data_length_indicator:q(H,X+1,0)}}}K+=Q;H&&H.format.data_length_indicator&&
(e(K,D),K+=4,P-=4);H&&H.format.unsynchronisation||(G in c.readFrameData?C=c.readFrameData[G]:"T"==G[0]&&(C=c.readFrameData["T*"]),C=C?C(K,P,D,H):void 0,C={id:G,size:P,description:G in c.frames?c.frames[G]:"Unknown",data:C},G in x?(x[G].id&&(x[G]=[x[G]]),x[G].push(C)):x[G]=C)}}G=x}for(var Y in a)if(a.hasOwnProperty(Y)){a:{Q=a[Y];"string"==typeof Q&&(Q=[Q]);for(u=0;P=Q[u];u++)if(P in G){k=G[P].data;break a}k=void 0}k&&(m[Y]=k)}for(var L in G)G.hasOwnProperty(L)&&(m[L]=G[L]);return m};F.ID3v2=c;var f=
{types:{0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},atom:{"\u00a9alb":["album"],"\u00a9art":["artist"],"\u00a9ART":["artist"],aART:["artist"],"\u00a9day":["year"],"\u00a9nam":["title"],"\u00a9gen":["genre"],trkn:["track"],"\u00a9wrt":["composer"],"\u00a9too":["encoder"],cprt:["copyright"],covr:["picture"],"\u00a9grp":["grouping"],keyw:["keyword"],"\u00a9lyr":["lyrics"],"\u00a9cmt":["comment"],tmpo:["tempo"],cpil:["compilation"],disk:["disc"]},loadData:function(m,k){var u=new DataView(m);n(u,
0,u.byteLength,k)},ReadTags:function(m){m=new DataView(m);var k={};h(k,m,0,m.byteLength);return k}};F.ID4=f})(window,document,PKAudioEditor);"use strict";
(function(F){var A=function(){var n=document.currentScript.src,h=/[^\/]+$/.exec(n);return null!==h?n.slice(0,h.index):""}(),E=function(){if(F.LZ4BlockWASM instanceof Function){var n=new F.LZ4BlockWASM;return n.init().then(function(){return n})}return null===F.LZ4BlockWASM?Promise.resolve(null):new Promise(function(h,y){var t=document.createElement("script");t.src=A+"lz4-block-codec-wasm.js";t.addEventListener("load",function(){if(!1===F.LZ4BlockWASM instanceof Function)F.LZ4BlockWASM=null,F.LZ4BlockWASM=
void 0,h(null);else{var v=new F.LZ4BlockWASM;v.init().then(function(){h(v)})["catch"](function(c){y(c)})}});t.addEventListener("error",function(){F.LZ4BlockWASM=null;h(null)});document.head.appendChild(t);t&&null!==t.parentNode&&t.parentNode.removeChild(t)})},r=function(){if(F.LZ4BlockJS instanceof Function){var n=new F.LZ4BlockJS;return n.init().then(function(){return n})}return null===F.LZ4BlockJS?Promise.resolve(null):new Promise(function(h,y){var t=document.createElement("script");t.src=A+"lz4-block-codec-js.js";
t.addEventListener("load",function(){if(!1===F.LZ4BlockJS instanceof Function)F.LZ4BlockJS=null,h(null);else{var v=new F.LZ4BlockJS;v.init().then(function(){h(v)})["catch"](function(c){y(c)})}});t.addEventListener("error",function(){F.LZ4BlockJS=null;h(null)});document.head.appendChild(t);t&&null!==t.parentNode&&t.parentNode.removeChild(t)})};F.lz4BlockCodec={createInstance:function(n){return("wasm"===n?E:"js"===n?r:E||r)().then(function(h){return h?h:void 0===n?r():null})["catch"](function(){return void 0===
n?r():null})},reset:function(){F.LZ4BlockWASM=void 0;F.LZ4BlockJS=void 0}}})(this||self);